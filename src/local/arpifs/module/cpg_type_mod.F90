MODULE CPG_TYPE_MOD

USE FIELD_MODULE
USE FIELD_REGISTRY_MOD
USE PARKIND1, ONLY : JPRB, JPIM, JPIB

IMPLICIT NONE

TYPE CPG_XYBDER_TYPE
  LOGICAL :: LOWNED = .FALSE.
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ZVIEW (:,:,:) => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ZDATA (:,:,:,:) => NULL ()
  TYPE (FIELD_4D), POINTER :: F_DATA => NULL ()
  INTEGER (KIND=JPIM) :: IP_LNPRL = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: LNPRL (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: LNPRL (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_LNPRL => NULL ()
  INTEGER (KIND=JPIM) :: IP_LNPRM = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: LNPRM (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: LNPRM (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_LNPRM => NULL ()
  INTEGER (KIND=JPIM) :: IP_ALPHL = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ALPHL (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: ALPHL (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_ALPHL => NULL ()
  INTEGER (KIND=JPIM) :: IP_ALPHM = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ALPHM (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: ALPHM (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_ALPHM => NULL ()
  INTEGER (KIND=JPIM) :: IP_ALPHPLL = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ALPHPLL (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: ALPHPLL (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_ALPHPLL => NULL ()
  INTEGER (KIND=JPIM) :: IP_ALPHPLM = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ALPHPLM (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: ALPHPLM (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_ALPHPLM => NULL ()
  INTEGER (KIND=JPIM) :: IP_COEFD = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: COEFD (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: COEFD (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_COEFD => NULL ()
  INTEGER (KIND=JPIM) :: IP_COEFA = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: COEFA (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: COEFA (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_COEFA => NULL ()
  INTEGER (KIND=JPIM) :: IP_COEFAPL = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: COEFAPL (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: COEFAPL (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_COEFAPL => NULL ()

CONTAINS
  PROCEDURE :: INIT => CPG_XYBDER_TYPE_INIT
  PROCEDURE :: UPDATE_VIEW => CPG_XYBDER_TYPE_UPDATE_VIEW
  PROCEDURE :: FINAL => CPG_XYBDER_TYPE_FINAL
END TYPE CPG_XYBDER_TYPE

TYPE CPG_XYB_TYPE
  LOGICAL :: LOWNED = .FALSE.
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ZVIEW (:,:,:) => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ZDATA (:,:,:,:) => NULL ()
  TYPE (FIELD_4D), POINTER :: F_DATA => NULL ()
  INTEGER (KIND=JPIM) :: IP_DELP = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DELP (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: DELP (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_DELP => NULL ()
  INTEGER (KIND=JPIM) :: IP_RDELP = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: RDELP (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: RDELP (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_RDELP => NULL ()
  INTEGER (KIND=JPIM) :: IP_LNPR = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: LNPR (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: LNPR (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_LNPR => NULL ()
  INTEGER (KIND=JPIM) :: IP_ALPH = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ALPH (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: ALPH (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_ALPH => NULL ()
  INTEGER (KIND=JPIM) :: IP_RTGR = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: RTGR (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: RTGR (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_RTGR => NULL ()
  INTEGER (KIND=JPIM) :: IP_RPRE = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: RPRE (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: RPRE (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_RPRE => NULL ()
  INTEGER (KIND=JPIM) :: IP_RPP = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: RPP (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: RPP (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_RPP => NULL ()

CONTAINS
  PROCEDURE :: INIT => CPG_XYB_TYPE_INIT
  PROCEDURE :: UPDATE_VIEW => CPG_XYB_TYPE_UPDATE_VIEW
  PROCEDURE :: FINAL => CPG_XYB_TYPE_FINAL
END TYPE CPG_XYB_TYPE

TYPE CPG_HWIND_TYPE
  LOGICAL :: LOWNED = .FALSE.
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ZVIEW (:,:,:) => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ZDATA (:,:,:,:) => NULL ()
  TYPE (FIELD_4D), POINTER :: F_DATA => NULL ()
  INTEGER (KIND=JPIM) :: IP_UH = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: UH (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: UH (NPROMA, 0:NLEV)
  TYPE (FIELD_3D), POINTER :: F_UH => NULL ()
  INTEGER (KIND=JPIM) :: IP_VH = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: VH (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: VH (NPROMA, 0:NLEV)
  TYPE (FIELD_3D), POINTER :: F_VH => NULL ()
  INTEGER (KIND=JPIM) :: IP_WWI = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: WWI (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: WWI (NPROMA, 0:NLEV)
  TYPE (FIELD_3D), POINTER :: F_WWI => NULL ()

CONTAINS
  PROCEDURE :: INIT => CPG_HWIND_TYPE_INIT
  PROCEDURE :: UPDATE_VIEW => CPG_HWIND_TYPE_UPDATE_VIEW
  PROCEDURE :: FINAL => CPG_HWIND_TYPE_FINAL
END TYPE CPG_HWIND_TYPE

TYPE CPG_RCP_TYPE
  LOGICAL :: LOWNED = .FALSE.
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ZVIEW (:,:,:) => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ZDATA (:,:,:,:) => NULL ()
  TYPE (FIELD_4D), POINTER :: F_DATA => NULL ()
  INTEGER (KIND=JPIM) :: IP_CP = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: CP (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: CP (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_CP => NULL ()
  INTEGER (KIND=JPIM) :: IP_R = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: R (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: R (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_R => NULL ()
  INTEGER (KIND=JPIM) :: IP_KAP = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: KAP (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: KAP (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_KAP => NULL ()

CONTAINS
  PROCEDURE :: INIT => CPG_RCP_TYPE_INIT
  PROCEDURE :: UPDATE_VIEW => CPG_RCP_TYPE_UPDATE_VIEW
  PROCEDURE :: FINAL => CPG_RCP_TYPE_FINAL
END TYPE CPG_RCP_TYPE

TYPE CPG_CTY_TYPE
  LOGICAL :: LOWNED = .FALSE.
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ZVIEW (:,:,:) => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ZDATA (:,:,:,:) => NULL ()
  TYPE (FIELD_4D), POINTER :: F_DATA => NULL ()
  INTEGER (KIND=JPIM) :: IP_EVEL = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: EVEL (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: EVEL (NPROMA, 0:NLEV)
  TYPE (FIELD_3D), POINTER :: F_EVEL => NULL ()
  INTEGER (KIND=JPIM) :: IP_VVEL = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: VVEL (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: VVEL (NPROMA, 0:NLEV)
  TYPE (FIELD_3D), POINTER :: F_VVEL => NULL ()
  INTEGER (KIND=JPIM) :: IP_PSDIV = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: PSDIV (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: PSDIV (NPROMA, 0:NLEV)
  TYPE (FIELD_3D), POINTER :: F_PSDIV => NULL ()
  INTEGER (KIND=JPIM) :: IP_PSDVBC = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: PSDVBC (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: PSDVBC (NPROMA, 0:NLEV)
  TYPE (FIELD_3D), POINTER :: F_PSDVBC => NULL ()
  INTEGER (KIND=JPIM) :: IP_DIVDP = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DIVDP (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: DIVDP (NPROMA, 0:NLEV)
  TYPE (FIELD_3D), POINTER :: F_DIVDP => NULL ()

CONTAINS
  PROCEDURE :: INIT => CPG_CTY_TYPE_INIT
  PROCEDURE :: UPDATE_VIEW => CPG_CTY_TYPE_UPDATE_VIEW
  PROCEDURE :: FINAL => CPG_CTY_TYPE_FINAL
END TYPE CPG_CTY_TYPE

TYPE CPG_TND_TYPE
  LOGICAL :: LOWNED = .FALSE.
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ZVIEW (:,:,:) => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ZDATA (:,:,:,:) => NULL ()
  TYPE (FIELD_4D), POINTER :: F_DATA => NULL ()
  INTEGER (KIND=JPIM) :: IP_TNDU = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: TNDU (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: TNDU (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_TNDU => NULL ()
  INTEGER (KIND=JPIM) :: IP_TNDV = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: TNDV (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: TNDV (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_TNDV => NULL ()
  INTEGER (KIND=JPIM) :: IP_TNDU_NOC = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: TNDU_NOC (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: TNDU_NOC (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_TNDU_NOC => NULL ()
  INTEGER (KIND=JPIM) :: IP_TNDV_NOC = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: TNDV_NOC (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: TNDV_NOC (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_TNDV_NOC => NULL ()
  INTEGER (KIND=JPIM) :: IP_TNDT = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: TNDT (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: TNDT (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_TNDT => NULL ()
  INTEGER (KIND=JPIM) :: IP_TNDPD = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: TNDPD (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: TNDPD (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_TNDPD => NULL ()
  INTEGER (KIND=JPIM) :: IP_TNDVD = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: TNDVD (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: TNDVD (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_TNDVD => NULL ()
  INTEGER (KIND=JPIM) :: IP_TNDGW = -1
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: TNDGW (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: TNDGW (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_TNDGW => NULL ()

CONTAINS
  PROCEDURE :: INIT => CPG_TND_TYPE_INIT
  PROCEDURE :: UPDATE_VIEW => CPG_TND_TYPE_UPDATE_VIEW
  PROCEDURE :: FINAL => CPG_TND_TYPE_FINAL
END TYPE CPG_TND_TYPE

TYPE CPG_GPAR_TYPE
  LOGICAL :: LOWNED = .FALSE.
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ZVIEW (:,:) => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ZDATA (:,:,:) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_DATA => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: INPRR (:) => NULL ()
!>REAL (KIND=JPRB)                      :: INPRR (NPROMA)
  TYPE (FIELD_2D), POINTER :: F_INPRR => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: INPRS (:) => NULL ()
!>REAL (KIND=JPRB)                      :: INPRS (NPROMA)
  TYPE (FIELD_2D), POINTER :: F_INPRS => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: INPRG (:) => NULL ()
!>REAL (KIND=JPRB)                      :: INPRG (NPROMA)
  TYPE (FIELD_2D), POINTER :: F_INPRG => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ACPRR (:) => NULL ()
!>REAL (KIND=JPRB)                      :: ACPRR (NPROMA)
  TYPE (FIELD_2D), POINTER :: F_ACPRR => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ACPRS (:) => NULL ()
!>REAL (KIND=JPRB)                      :: ACPRS (NPROMA)
  TYPE (FIELD_2D), POINTER :: F_ACPRS => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ACPRG (:) => NULL ()
!>REAL (KIND=JPRB)                      :: ACPRG (NPROMA)
  TYPE (FIELD_2D), POINTER :: F_ACPRG => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ALBDIR (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: ALBDIR (NPROMA, 1:YDCPG_OPTS%KSW)
  TYPE (FIELD_3D), POINTER :: F_ALBDIR => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ALBSCA (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: ALBSCA (NPROMA, 1:YDCPG_OPTS%KSW)
  TYPE (FIELD_3D), POINTER :: F_ALBSCA => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: RAIN (:) => NULL ()
!>REAL (KIND=JPRB)                      :: RAIN (NPROMA)
  TYPE (FIELD_2D), POINTER :: F_RAIN => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: SNOW (:) => NULL ()
!>REAL (KIND=JPRB)                      :: SNOW (NPROMA)
  TYPE (FIELD_2D), POINTER :: F_SNOW => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: GZ0 (:) => NULL ()
!>REAL (KIND=JPRB)                      :: GZ0 (NPROMA)
  TYPE (FIELD_2D), POINTER :: F_GZ0 => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: GZ0H (:) => NULL ()
!>REAL (KIND=JPRB)                      :: GZ0H (NPROMA)
  TYPE (FIELD_2D), POINTER :: F_GZ0H => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: VQS (:) => NULL ()
!>REAL (KIND=JPRB)                      :: VQS (NPROMA)
  TYPE (FIELD_2D), POINTER :: F_VQS => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: VTS (:) => NULL ()
!>REAL (KIND=JPRB)                      :: VTS (NPROMA)
  TYPE (FIELD_2D), POINTER :: F_VTS => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: VEMIS (:) => NULL ()
!>REAL (KIND=JPRB)                      :: VEMIS (NPROMA)
  TYPE (FIELD_2D), POINTER :: F_VEMIS => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: SWDIR (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: SWDIR (NPROMA, 1:YDCPG_OPTS%KSW)
  TYPE (FIELD_3D), POINTER :: F_SWDIR => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: SWDIF (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: SWDIF (NPROMA, 1:YDCPG_OPTS%KSW)
  TYPE (FIELD_3D), POINTER :: F_SWDIF => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: LSM (:) => NULL ()
!>REAL (KIND=JPRB)                      :: LSM (NPROMA)
  TYPE (FIELD_2D), POINTER :: F_LSM => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: CD (:) => NULL ()
!>REAL (KIND=JPRB)                      :: CD (NPROMA)
  TYPE (FIELD_2D), POINTER :: F_CD => NULL ()

CONTAINS
  PROCEDURE :: INIT => CPG_GPAR_TYPE_INIT
  PROCEDURE :: UPDATE_VIEW => CPG_GPAR_TYPE_UPDATE_VIEW
  PROCEDURE :: FINAL => CPG_GPAR_TYPE_FINAL
END TYPE CPG_GPAR_TYPE

TYPE CPG_DYN_TYPE

  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: OROGL (:) => NULL ()
!>REAL (KIND=JPRB)                      :: OROGL (NPROMA)
  TYPE (FIELD_2D), POINTER :: F_OROGL => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: OROGM (:) => NULL ()
!>REAL (KIND=JPRB)                      :: OROGM (NPROMA)
  TYPE (FIELD_2D), POINTER :: F_OROGM => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: PHI (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: PHI (NPROMA, 0:NLEV)
  TYPE (FIELD_3D), POINTER :: F_PHI => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: PRE (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: PRE (NPROMA, 0:NLEV)
  TYPE (FIELD_3D), POINTER :: F_PRE => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: PHIF (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: PHIF (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_PHIF => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: PREF (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: PREF (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_PREF => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: WRL (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: WRL (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_WRL => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: PREL (:) => NULL ()
!>REAL (KIND=JPRB)                      :: PREL (NPROMA)
  TYPE (FIELD_2D), POINTER :: F_PREL => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: PREM (:) => NULL ()
!>REAL (KIND=JPRB)                      :: PREM (NPROMA)
  TYPE (FIELD_2D), POINTER :: F_PREM => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: NHY (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: NHY (NPROMA, 0:NLEV)
  TYPE (FIELD_3D), POINTER :: F_NHY => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: GWFT (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: GWFT (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_GWFT => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: KENE (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: KENE (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_KENE => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: NHX (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: NHX (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_NHX => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: PHIFL (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: PHIFL (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_PHIFL => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: PHIFM (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: PHIFM (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_PHIFM => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: RTL (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: RTL (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_RTL => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: RTM (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: RTM (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_RTM => NULL ()
  TYPE (CPG_RCP_TYPE) :: RCP
  TYPE (CPG_CTY_TYPE) :: CTY
  TYPE (CPG_HWIND_TYPE) :: UVH
  TYPE (CPG_XYB_TYPE) :: XYB
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DBBC (:) => NULL ()
!>REAL (KIND=JPRB)                      :: DBBC (NPROMA)
  TYPE (FIELD_2D), POINTER :: F_DBBC => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: GWS (:) => NULL ()
!>REAL (KIND=JPRB)                      :: GWS (NPROMA)
  TYPE (FIELD_2D), POINTER :: F_GWS => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: GWFL (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: GWFL (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_GWFL => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: GWFM (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: GWFM (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_GWFM => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: GWT (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: GWT (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_GWT => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: NHPREF (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: NHPREF (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_NHPREF => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: NHPREH (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: NHPREH (NPROMA, 0:NLEV)
  TYPE (FIELD_3D), POINTER :: F_NHPREH => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: QCHAL (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: QCHAL (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_QCHAL => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: QCHAM (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: QCHAM (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_QCHAM => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: RDPHI (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: RDPHI (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_RDPHI => NULL ()

CONTAINS
  PROCEDURE :: INIT => CPG_DYN_TYPE_INIT
  PROCEDURE :: UPDATE_VIEW => CPG_DYN_TYPE_UPDATE_VIEW
  PROCEDURE :: FINAL => CPG_DYN_TYPE_FINAL
END TYPE CPG_DYN_TYPE

TYPE CPG_PHY_TYPE

  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: PRE (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: PRE (NPROMA, 0:NLEV)
  TYPE (FIELD_3D), POINTER :: F_PRE => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: PREF (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: PREF (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_PREF => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: PREHYD (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: PREHYD (NPROMA, 0:NLEV)
  TYPE (FIELD_3D), POINTER :: F_PREHYD => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: PREHYDF (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: PREHYDF (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_PREHYDF => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: WL (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: WL (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_WL => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: WM (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: WM (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_WM => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: W (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: W (NPROMA, 1:NLEV)
  TYPE (FIELD_3D), POINTER :: F_W => NULL ()
  TYPE (CPG_XYB_TYPE) :: XYB

CONTAINS
  PROCEDURE :: INIT => CPG_PHY_TYPE_INIT
  PROCEDURE :: UPDATE_VIEW => CPG_PHY_TYPE_UPDATE_VIEW
  PROCEDURE :: FINAL => CPG_PHY_TYPE_FINAL
END TYPE CPG_PHY_TYPE

TYPE CPG_MISC_TYPE

  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: NEB (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: NEB (NPROMA, 1:YDCPG_OPTS%KFLEVG)
  TYPE (FIELD_3D), POINTER :: F_NEB => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: QLI (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: QLI (NPROMA, 1:YDCPG_OPTS%KFLEVG)
  TYPE (FIELD_3D), POINTER :: F_QLI => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: QICE (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: QICE (NPROMA, 1:YDCPG_OPTS%KFLEVG)
  TYPE (FIELD_3D), POINTER :: F_QICE => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: QRAIN (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: QRAIN (NPROMA, 1:YDCPG_OPTS%KFLEVG)
  TYPE (FIELD_3D), POINTER :: F_QRAIN => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: QSNOW (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: QSNOW (NPROMA, 1:YDCPG_OPTS%KFLEVG)
  TYPE (FIELD_3D), POINTER :: F_QSNOW => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: QGRAUPEL (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: QGRAUPEL (NPROMA, 1:YDCPG_OPTS%KFLEVG)
  TYPE (FIELD_3D), POINTER :: F_QGRAUPEL => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: RH (:, :) => NULL ()
!>REAL (KIND=JPRB)                      :: RH (NPROMA, 1:YDCPG_OPTS%KFLEVG)
  TYPE (FIELD_3D), POINTER :: F_RH => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: QS (:) => NULL ()
!>REAL (KIND=JPRB)                      :: QS (NPROMA)
  TYPE (FIELD_2D), POINTER :: F_QS => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: QSOL (:) => NULL ()
!>REAL (KIND=JPRB)                      :: QSOL (NPROMA)
  TYPE (FIELD_2D), POINTER :: F_QSOL => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DHSF (:) => NULL ()
!>REAL (KIND=JPRB)                      :: DHSF (NPROMA)
  TYPE (FIELD_2D), POINTER :: F_DHSF => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: CLCT (:) => NULL ()
!>REAL (KIND=JPRB)                      :: CLCT (NPROMA)
  TYPE (FIELD_2D), POINTER :: F_CLCT => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: LSM (:) => NULL ()
!>REAL (KIND=JPRB)                      :: LSM (NPROMA)
  TYPE (FIELD_2D), POINTER :: F_LSM => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: TSOL (:) => NULL ()
!>REAL (KIND=JPRB)                      :: TSOL (NPROMA)
  TYPE (FIELD_2D), POINTER :: F_TSOL => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: FTCNS (:, :, :) => NULL ()
!>REAL (KIND=JPRB)                      :: FTCNS (NPROMA, 0:YDCPG_OPTS%KFLEVG, 1:6)
  TYPE (FIELD_4D), POINTER :: F_FTCNS => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: KOZO (:, :, :) => NULL ()
!>REAL (KIND=JPRB)                      :: KOZO (NPROMA, 1:YDCPG_OPTS%KFLEVG, 1:YDCPG_OPTS%KVCLIS)
  TYPE (FIELD_4D), POINTER :: F_KOZO => NULL ()

CONTAINS
  PROCEDURE :: INIT => CPG_MISC_TYPE_INIT
  PROCEDURE :: UPDATE_VIEW => CPG_MISC_TYPE_UPDATE_VIEW
  PROCEDURE :: FINAL => CPG_MISC_TYPE_FINAL
END TYPE CPG_MISC_TYPE

TYPE CPG_DDH_TYPE
  REAL(KIND=JPRB), POINTER, CONTIGUOUS :: AUX3D (:,:,:) => NULL ()
  TYPE (FIELD_4D), POINTER :: F_AUX3D => NULL ()
  
  REAL(KIND=JPRB), POINTER, CONTIGUOUS :: AUX2D (:,:) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_AUX2D => NULL ()

  REAL(KIND=JPRB), POINTER, CONTIGUOUS :: DHCV  (:,:,:) => NULL ()
  TYPE (FIELD_4D), POINTER :: F_DHCV => NULL ()
  REAL(KIND=JPRB), POINTER, CONTIGUOUS :: AUXSM (:,:,:,:) => NULL ()
  TYPE (FIELD_5D), POINTER :: F_AUXSM => NULL ()
  INTEGER(KIND=JPIM), POINTER, CONTIGUOUS :: DDHI (:) => NULL ()
  TYPE (FIELD_INT2D), POINTER :: F_DDHI => NULL ()
CONTAINS
  PROCEDURE :: INIT => CPG_DDH_TYPE_INIT
  PROCEDURE :: UPDATE_VIEW => CPG_DDH_TYPE_UPDATE_VIEW
  PROCEDURE :: FINAL => CPG_DDH_TYPE_FINAL
END TYPE CPG_DDH_TYPE





TYPE CPG_SL1_2D_TYPE
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: P (:) => NULL ()
  TYPE (FIELD_2D), POINTER :: F_P => NULL ()

  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: P_F (:) => NULL ()
  TYPE (FIELD_2D), POINTER :: F_P_F => NULL ()

  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: P_SPF (:) => NULL ()
  TYPE (FIELD_2D), POINTER :: F_P_SPF => NULL ()

  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: P_SP (:) => NULL ()
  TYPE (FIELD_2D), POINTER :: F_P_SP => NULL ()

  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: P_P (:) => NULL ()
  TYPE (FIELD_2D), POINTER :: F_P_P => NULL ()

END TYPE

TYPE CPG_SL1_3D_TYPE
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: P (:,:) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_P => NULL ()

  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: P_F (:,:) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_P_F => NULL ()

  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: P_SPF (:,:) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_P_SPF => NULL ()

  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: P_SP (:,:) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_P_SP => NULL ()

  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: P_P (:,:) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_P_P => NULL ()

END TYPE

TYPE CPG_SL1_TYPE
  LOGICAL :: LOWNED = .FALSE.
  INTEGER (KIND=JPIM) :: NLEV = -1
  INTEGER (KIND=JPIB) :: ISIZE = 0
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ZVIEW (:,:) => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ZDATA (:,:,:) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_DATA => NULL ()
  TYPE (CPG_SL1_3D_TYPE) :: U9
  TYPE (CPG_SL1_3D_TYPE) :: V9
  TYPE (CPG_SL1_3D_TYPE) :: T9
  TYPE (CPG_SL1_3D_TYPE) :: PD9
  TYPE (CPG_SL1_3D_TYPE) :: VD9
  TYPE (CPG_SL1_3D_TYPE) :: NHX9
  TYPE (CPG_SL1_3D_TYPE) :: UR0
  TYPE (CPG_SL1_3D_TYPE) :: VR0
  TYPE (CPG_SL1_3D_TYPE) :: ZR0
  TYPE (CPG_SL1_3D_TYPE) :: WR0
  TYPE (CPG_SL1_3D_TYPE) :: UR00
  TYPE (CPG_SL1_3D_TYPE) :: VR00
  TYPE (CPG_SL1_3D_TYPE) :: ZR00
  TYPE (CPG_SL1_3D_TYPE) :: WR00
  TYPE (CPG_SL1_3D_TYPE) :: WRA
  TYPE (CPG_SL1_3D_TYPE) :: UR9
  TYPE (CPG_SL1_3D_TYPE) :: VR9
  TYPE (CPG_SL1_3D_TYPE) :: DBBC9
  TYPE (CPG_SL1_3D_TYPE) :: DPHI9
  TYPE (CPG_SL1_2D_TYPE) :: GWS9
  TYPE (CPG_SL1_3D_TYPE) :: U0
  TYPE (CPG_SL1_3D_TYPE) :: V0
  TYPE (CPG_SL1_3D_TYPE) :: T0
  TYPE (CPG_SL1_3D_TYPE) :: PD0
  TYPE (CPG_SL1_3D_TYPE) :: VD0
  TYPE (CPG_SL1_3D_TYPE) :: C9
  TYPE (CPG_SL1_2D_TYPE) :: SP9
  TYPE (CPG_SL1_2D_TYPE) :: SP0
  TYPE (CPG_SL1_3D_TYPE) :: C0
  TYPE (CPG_SL1_3D_TYPE) :: UP9
  TYPE (CPG_SL1_3D_TYPE) :: VP9
  TYPE (CPG_SL1_3D_TYPE) :: TP9
  TYPE (CPG_SL1_3D_TYPE) :: U9_SI
  TYPE (CPG_SL1_3D_TYPE) :: V9_SI
  TYPE (CPG_SL1_3D_TYPE) :: T9_SI
  TYPE (CPG_SL1_3D_TYPE) :: PD9_SI
  TYPE (CPG_SL1_3D_TYPE) :: VD9_SI
  TYPE (CPG_SL1_3D_TYPE) :: C9_SI
  TYPE (CPG_SL1_3D_TYPE) :: UF9
  TYPE (CPG_SL1_3D_TYPE) :: VF9
  TYPE (CPG_SL1_3D_TYPE) :: TF9
  TYPE (CPG_SL1_3D_TYPE) :: VDF9
  TYPE (CPG_SL1_3D_TYPE) :: U9_NL
  TYPE (CPG_SL1_3D_TYPE) :: V9_NL
  TYPE (CPG_SL1_3D_TYPE) :: T9_NL
  TYPE (CPG_SL1_3D_TYPE) :: PD9_NL
  TYPE (CPG_SL1_3D_TYPE) :: VD9_NL
  TYPE (CPG_SL1_3D_TYPE) :: C9_NL

  TYPE (CPG_SL1_3D_TYPE) :: Q
  TYPE (CPG_SL1_3D_TYPE) :: I
  TYPE (CPG_SL1_3D_TYPE) :: L
  TYPE (CPG_SL1_3D_TYPE) :: LCONV
  TYPE (CPG_SL1_3D_TYPE) :: ICONV
  TYPE (CPG_SL1_3D_TYPE) :: RCONV
  TYPE (CPG_SL1_3D_TYPE) :: SCONV
  TYPE (CPG_SL1_3D_TYPE) :: IRAD
  TYPE (CPG_SL1_3D_TYPE) :: LRAD
  TYPE (CPG_SL1_3D_TYPE) :: S
  TYPE (CPG_SL1_3D_TYPE) :: R
  TYPE (CPG_SL1_3D_TYPE) :: G
  TYPE (CPG_SL1_3D_TYPE) :: H
  TYPE (CPG_SL1_3D_TYPE) :: TKE
  TYPE (CPG_SL1_3D_TYPE) :: TTE
  TYPE (CPG_SL1_3D_TYPE) :: EFB1
  TYPE (CPG_SL1_3D_TYPE) :: EFB2
  TYPE (CPG_SL1_3D_TYPE) :: EFB3
  TYPE (CPG_SL1_3D_TYPE) :: A
  TYPE (CPG_SL1_3D_TYPE) :: O3
  TYPE (CPG_SL1_3D_TYPE) :: SRC
  TYPE (CPG_SL1_3D_TYPE) :: MXL
  TYPE (CPG_SL1_3D_TYPE) :: SHTUR
  TYPE (CPG_SL1_3D_TYPE) :: FQTUR
  TYPE (CPG_SL1_3D_TYPE) :: FSTUR
  TYPE (CPG_SL1_3D_TYPE) :: CPF
  TYPE (CPG_SL1_3D_TYPE) :: SPF
  TYPE (CPG_SL1_3D_TYPE) :: CVGQ
  TYPE (CPG_SL1_3D_TYPE) :: QVA
  TYPE (CPG_SL1_3D_TYPE), ALLOCATABLE :: GHG (:)
  TYPE (CPG_SL1_3D_TYPE), ALLOCATABLE :: CHEM (:)
  TYPE (CPG_SL1_3D_TYPE), ALLOCATABLE :: AERO (:)
  TYPE (CPG_SL1_3D_TYPE) :: LRCH4
  TYPE (CPG_SL1_3D_TYPE), ALLOCATABLE :: FORC (:)
  TYPE (CPG_SL1_3D_TYPE), ALLOCATABLE :: EZDIAG (:)
  TYPE (CPG_SL1_3D_TYPE), ALLOCATABLE :: ERA40 (:)
  TYPE (CPG_SL1_3D_TYPE), ALLOCATABLE :: NOGW (:)
  TYPE (CPG_SL1_3D_TYPE), ALLOCATABLE :: EDRP (:)
  TYPE (CPG_SL1_3D_TYPE), ALLOCATABLE :: SLDIA (:)
  TYPE (CPG_SL1_3D_TYPE), ALLOCATABLE :: AERAOT (:)
  TYPE (CPG_SL1_3D_TYPE), ALLOCATABLE :: AERLISI (:)
  TYPE (CPG_SL1_3D_TYPE), ALLOCATABLE :: AEROUT (:)
  TYPE (CPG_SL1_3D_TYPE), ALLOCATABLE :: AEROCLIM (:)
  TYPE (CPG_SL1_3D_TYPE), ALLOCATABLE :: UVP (:)
  TYPE (CPG_SL1_3D_TYPE), ALLOCATABLE :: PHYS (:)
  TYPE (CPG_SL1_3D_TYPE) :: PHYCTY
  TYPE (CPG_SL1_3D_TYPE) :: RSPEC
  TYPE (CPG_SL1_3D_TYPE) :: SDSAT
  TYPE (CPG_SL1_3D_TYPE) :: CVV
  TYPE (CPG_SL1_3D_TYPE) :: RKTH
  TYPE (CPG_SL1_3D_TYPE) :: RKTQV
  TYPE (CPG_SL1_3D_TYPE) :: RKTQC
  TYPE (CPG_SL1_3D_TYPE) :: UOM
  TYPE (CPG_SL1_3D_TYPE) :: UAL
  TYPE (CPG_SL1_3D_TYPE) :: DOM
  TYPE (CPG_SL1_3D_TYPE) :: DAL
  TYPE (CPG_SL1_3D_TYPE) :: UEN
  TYPE (CPG_SL1_3D_TYPE) :: UNEBH
  TYPE (CPG_SL1_3D_TYPE), ALLOCATABLE :: CRM (:)
  TYPE (CPG_SL1_3D_TYPE), ALLOCATABLE :: LIMA (:)
  TYPE (CPG_SL1_3D_TYPE) :: FSD
  TYPE (CPG_SL1_3D_TYPE), ALLOCATABLE :: EXT (:)
CONTAINS
  PROCEDURE :: INIT => CPG_SL1_TYPE_INIT
  PROCEDURE :: UPDATE_VIEW => CPG_SL1_TYPE_UPDATE_VIEW
  PROCEDURE :: FINAL => CPG_SL1_TYPE_FINAL
END TYPE CPG_SL1_TYPE

TYPE CPG_SL2_TYPE
  LOGICAL :: LOWNED = .FALSE.
  INTEGER (KIND=JPIM) :: NLEV = -1
  INTEGER (KIND=JPIB) :: ISIZE = 0
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ZVIEW (:,:) => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: ZDATA (:,:,:) => NULL ()
  TYPE (FIELD_3D), POINTER :: F_DATA => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DBBC1 (:) => NULL ()
!>REAL (KIND=JPRB)                      :: DBBC1 (NPROMA)
  TYPE (FIELD_2D), POINTER :: F_DBBC1 => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: DPHI1 (:) => NULL ()
!>REAL (KIND=JPRB)                      :: DPHI1 (NPROMA)
  TYPE (FIELD_2D), POINTER :: F_DPHI1 => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: USI (:,:) => NULL ()
!>REAL (KIND=JPRB)                      :: USI (NPROMA, 0:NLEV+1)
  TYPE (FIELD_3D), POINTER :: F_USI => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: VSI (:,:) => NULL ()
!>REAL (KIND=JPRB)                      :: VSI (NPROMA, 0:NLEV+1)
  TYPE (FIELD_3D), POINTER :: F_VSI => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: TSI (:,:) => NULL ()
!>REAL (KIND=JPRB)                      :: TSI (NPROMA, 0:NLEV+1)
  TYPE (FIELD_3D), POINTER :: F_TSI => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: PDSI (:,:) => NULL ()
!>REAL (KIND=JPRB)                      :: PDSI (NPROMA, 0:NLEV+1)
  TYPE (FIELD_3D), POINTER :: F_PDSI => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: VDSI (:,:) => NULL ()
!>REAL (KIND=JPRB)                      :: VDSI (NPROMA, 0:NLEV+1)
  TYPE (FIELD_3D), POINTER :: F_VDSI => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: SPSI (:) => NULL ()
!>REAL (KIND=JPRB)                      :: SPSI (NPROMA)
  TYPE (FIELD_2D), POINTER :: F_SPSI => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: VVEL (:,:) => NULL ()
!>REAL (KIND=JPRB)                      :: VVEL (NPROMA, 0:NLEV+1)
  TYPE (FIELD_3D), POINTER :: F_VVEL => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: URL (:,:) => NULL ()
!>REAL (KIND=JPRB)                      :: URL (NPROMA, 0:NLEV+1)
  TYPE (FIELD_3D), POINTER :: F_URL => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: VRL (:,:) => NULL ()
!>REAL (KIND=JPRB)                      :: VRL (NPROMA, 0:NLEV+1)
  TYPE (FIELD_3D), POINTER :: F_VRL => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: WRL (:,:) => NULL ()
!>REAL (KIND=JPRB)                      :: WRL (NPROMA, 0:NLEV+1)
  TYPE (FIELD_3D), POINTER :: F_WRL => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: URL5 (:,:) => NULL ()
!>REAL (KIND=JPRB)                      :: URL5 (NPROMA, 0:NLEV+1)
  TYPE (FIELD_3D), POINTER :: F_URL5 => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: VRL5 (:,:) => NULL ()
!>REAL (KIND=JPRB)                      :: VRL5 (NPROMA, 0:NLEV+1)
  TYPE (FIELD_3D), POINTER :: F_VRL5 => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: WRL5 (:,:) => NULL ()
!>REAL (KIND=JPRB)                      :: WRL5 (NPROMA, 0:NLEV+1)
  TYPE (FIELD_3D), POINTER :: F_WRL5 => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: USI5 (:,:) => NULL ()
!>REAL (KIND=JPRB)                      :: USI5 (NPROMA, 0:NLEV+1)
  TYPE (FIELD_3D), POINTER :: F_USI5 => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: VSI5 (:,:) => NULL ()
!>REAL (KIND=JPRB)                      :: VSI5 (NPROMA, 0:NLEV+1)
  TYPE (FIELD_3D), POINTER :: F_VSI5 => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: U15 (:,:) => NULL ()
!>REAL (KIND=JPRB)                      :: U15 (NPROMA, 0:NLEV+1)
  TYPE (FIELD_3D), POINTER :: F_U15 => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: V15 (:,:) => NULL ()
!>REAL (KIND=JPRB)                      :: V15 (NPROMA, 0:NLEV+1)
  TYPE (FIELD_3D), POINTER :: F_V15 => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: T15 (:,:) => NULL ()
!>REAL (KIND=JPRB)                      :: T15 (NPROMA, 0:NLEV+1)
  TYPE (FIELD_3D), POINTER :: F_T15 => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: Q15 (:,:) => NULL ()
!>REAL (KIND=JPRB)                      :: Q15 (NPROMA, 0:NLEV+1)
  TYPE (FIELD_3D), POINTER :: F_Q15 => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: KAPPA (:,:) => NULL ()
!>REAL (KIND=JPRB)                      :: KAPPA (NPROMA, 0:NLEV+1)
  TYPE (FIELD_3D), POINTER :: F_KAPPA => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: KAPPAT (:,:) => NULL ()
!>REAL (KIND=JPRB)                      :: KAPPAT (NPROMA, 0:NLEV+1)
  TYPE (FIELD_3D), POINTER :: F_KAPPAT => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: KAPPAM (:,:) => NULL ()
!>REAL (KIND=JPRB)                      :: KAPPAM (NPROMA, 0:NLEV+1)
  TYPE (FIELD_3D), POINTER :: F_KAPPAM => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: KAPPAH (:,:) => NULL ()
!>REAL (KIND=JPRB)                      :: KAPPAH (NPROMA, 0:NLEV+1)
  TYPE (FIELD_3D), POINTER :: F_KAPPAH => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: KAPPA5 (:,:) => NULL ()
!>REAL (KIND=JPRB)                      :: KAPPA5 (NPROMA, 0:NLEV+1)
  TYPE (FIELD_3D), POINTER :: F_KAPPA5 => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: KAPPAT5 (:,:) => NULL ()
!>REAL (KIND=JPRB)                      :: KAPPAT5 (NPROMA, 0:NLEV+1)
  TYPE (FIELD_3D), POINTER :: F_KAPPAT5 => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: GWF (:,:) => NULL ()
!>REAL (KIND=JPRB)                      :: GWF (NPROMA, 0:NLEV+1)
  TYPE (FIELD_3D), POINTER :: F_GWF => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: GDW (:,:) => NULL ()
!>REAL (KIND=JPRB)                      :: GDW (NPROMA, 0:NLEV+1)
  TYPE (FIELD_3D), POINTER :: F_GDW => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: GWS (:,:) => NULL ()
!>REAL (KIND=JPRB)                      :: GWS (NPROMA, 0:NLEV+1)
  TYPE (FIELD_3D), POINTER :: F_GWS => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: STDDISU (:,:) => NULL ()
!>REAL (KIND=JPRB)                      :: STDDISU (NPROMA, 0:NLEV+1)
  TYPE (FIELD_3D), POINTER :: F_STDDISU => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: STDDISV (:,:) => NULL ()
!>REAL (KIND=JPRB)                      :: STDDISV (NPROMA, 0:NLEV+1)
  TYPE (FIELD_3D), POINTER :: F_STDDISV => NULL ()
  REAL (KIND=JPRB), POINTER, CONTIGUOUS :: STDDISW (:,:) => NULL ()
!>REAL (KIND=JPRB)                      :: STDDISW (NPROMA, 0:NLEV+1)
  TYPE (FIELD_3D), POINTER :: F_STDDISW => NULL ()

CONTAINS
  PROCEDURE :: INIT => CPG_SL2_TYPE_INIT
  PROCEDURE :: UPDATE_VIEW => CPG_SL2_TYPE_UPDATE_VIEW
  PROCEDURE :: FINAL => CPG_SL2_TYPE_FINAL
END TYPE CPG_SL2_TYPE

REAL(KIND=JPRB),    PRIVATE, SAVE, TARGET :: ZDUM1 (1), ZDUM2 (1, 1), ZDUM3 (1,1,1)
INTEGER(KIND=JPIM), PRIVATE, SAVE, TARGET :: IDUM1 (1), IDUM2 (1, 1), IDUM3 (1,1,1)

CONTAINS

SUBROUTINE CPG_XYBDER_TYPE_INIT (SELF, REGISTRY, NLEV, YDTXYBDER, PERSISTENT, PTXYBDER)

USE INTDYN_MOD, ONLY : TXYBDER
USE OML_MOD, ONLY: OML_MAX_THREADS

CLASS (CPG_XYBDER_TYPE)                          :: SELF
TYPE (FIELD_REGISTRY),              INTENT (INOUT) :: REGISTRY
INTEGER (KIND=JPIM),                INTENT (IN)    :: NLEV
TYPE (TXYBDER),                    INTENT (IN)    :: YDTXYBDER
LOGICAL, OPTIONAL,                  INTENT (IN)    :: PERSISTENT
REAL (KIND=JPRB), OPTIONAL, TARGET, INTENT (IN)    :: PTXYBDER (:, :, :, :)

LOGICAL :: LLPERSISTENT

LLPERSISTENT = .FALSE.
IF (PRESENT (PERSISTENT)) LLPERSISTENT = PERSISTENT

IF (PRESENT (PTXYBDER)) THEN
  SELF%ZDATA => PTXYBDER
  SELF%LOWNED = .FALSE.
  LLPERSISTENT = .TRUE.
ELSEIF (LLPERSISTENT) THEN
  ALLOCATE (SELF%ZDATA (REGISTRY%GEOM%YRDIM%NPROMA, NLEV, YDTXYBDER%NDIM, REGISTRY%GEOM%YRDIM%NGPBLKS))
  SELF%LOWNED = .TRUE.
ELSE
  ALLOCATE (SELF%ZDATA (REGISTRY%GEOM%YRDIM%NPROMA, NLEV, YDTXYBDER%NDIM, OML_MAX_THREADS ()))
  SELF%LOWNED = .TRUE.
ENDIF

SELF%F_DATA => CREATE_FIELD_WRAP (SELF%ZDATA, PERSISTENT=LLPERSISTENT)

SELF%F_LNPRL => CREATE_FIELD_WRAP (SELF%ZDATA (:, :, YDTXYBDER%M_LNPRL, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1, 1, 1, 1])
SELF%F_LNPRM => CREATE_FIELD_WRAP (SELF%ZDATA (:, :, YDTXYBDER%M_LNPRM, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1, 1, 1, 1])
SELF%F_ALPHL => CREATE_FIELD_WRAP (SELF%ZDATA (:, :, YDTXYBDER%M_ALPHL, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1, 1, 1, 1])
SELF%F_ALPHM => CREATE_FIELD_WRAP (SELF%ZDATA (:, :, YDTXYBDER%M_ALPHM, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1, 1, 1, 1])
SELF%F_ALPHPLL => CREATE_FIELD_WRAP (SELF%ZDATA (:, :, YDTXYBDER%M_ALPHPLL, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1, 1, 1, 1])
SELF%F_ALPHPLM => CREATE_FIELD_WRAP (SELF%ZDATA (:, :, YDTXYBDER%M_ALPHPLM, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1, 1, 1, 1])
SELF%F_COEFD => CREATE_FIELD_WRAP (SELF%ZDATA (:, :, YDTXYBDER%M_COEFD, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1, 1, 1, 1])
SELF%F_COEFA => CREATE_FIELD_WRAP (SELF%ZDATA (:, :, YDTXYBDER%M_COEFA, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1, 1, 1, 1])
SELF%F_COEFAPL => CREATE_FIELD_WRAP (SELF%ZDATA (:, :, YDTXYBDER%M_COEFAPL, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1, 1, 1, 1])

END SUBROUTINE CPG_XYBDER_TYPE_INIT

SUBROUTINE CPG_XYBDER_TYPE_UPDATE_VIEW (SELF, BLOCK_INDEX)

CLASS (CPG_XYBDER_TYPE)         :: SELF
INTEGER(KIND=JPIM), INTENT (IN)   :: BLOCK_INDEX

IF (ASSOCIATED (SELF%F_DATA)) THEN

  SELF%ZVIEW => SELF%F_DATA%GET_VIEW (BLOCK_INDEX)

  IF (ASSOCIATED (SELF%F_LNPRL)) THEN
    IF ((.NOT. SELF%F_LNPRL%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%LNPRL))) THEN
      SELF%LNPRL  => SELF%F_LNPRL%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%LNPRL)) THEN
    SELF%LNPRL  => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_LNPRM)) THEN
    IF ((.NOT. SELF%F_LNPRM%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%LNPRM))) THEN
      SELF%LNPRM  => SELF%F_LNPRM%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%LNPRM)) THEN
    SELF%LNPRM  => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_ALPHL)) THEN
    IF ((.NOT. SELF%F_ALPHL%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%ALPHL))) THEN
      SELF%ALPHL  => SELF%F_ALPHL%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%ALPHL)) THEN
    SELF%ALPHL  => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_ALPHM)) THEN
    IF ((.NOT. SELF%F_ALPHM%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%ALPHM))) THEN
      SELF%ALPHM  => SELF%F_ALPHM%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%ALPHM)) THEN
    SELF%ALPHM  => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_ALPHPLL)) THEN
    IF ((.NOT. SELF%F_ALPHPLL%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%ALPHPLL))) THEN
      SELF%ALPHPLL  => SELF%F_ALPHPLL%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%ALPHPLL)) THEN
    SELF%ALPHPLL  => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_ALPHPLM)) THEN
    IF ((.NOT. SELF%F_ALPHPLM%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%ALPHPLM))) THEN
      SELF%ALPHPLM  => SELF%F_ALPHPLM%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%ALPHPLM)) THEN
    SELF%ALPHPLM  => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_COEFD)) THEN
    IF ((.NOT. SELF%F_COEFD%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%COEFD))) THEN
      SELF%COEFD  => SELF%F_COEFD%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%COEFD)) THEN
    SELF%COEFD  => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_COEFA)) THEN
    IF ((.NOT. SELF%F_COEFA%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%COEFA))) THEN
      SELF%COEFA  => SELF%F_COEFA%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%COEFA)) THEN
    SELF%COEFA  => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_COEFAPL)) THEN
    IF ((.NOT. SELF%F_COEFAPL%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%COEFAPL))) THEN
      SELF%COEFAPL  => SELF%F_COEFAPL%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%COEFAPL)) THEN
    SELF%COEFAPL  => ZDUM2
  ENDIF

ELSE

  SELF%ZVIEW => ZDUM3

  IF (.NOT. ASSOCIATED (SELF%LNPRL)) SELF%LNPRL  => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%LNPRM)) SELF%LNPRM  => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%ALPHL)) SELF%ALPHL  => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%ALPHM)) SELF%ALPHM  => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%ALPHPLL)) SELF%ALPHPLL  => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%ALPHPLM)) SELF%ALPHPLM  => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%COEFD)) SELF%COEFD  => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%COEFA)) SELF%COEFA  => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%COEFAPL)) SELF%COEFAPL  => ZDUM2

ENDIF

END SUBROUTINE CPG_XYBDER_TYPE_UPDATE_VIEW

SUBROUTINE CPG_XYBDER_TYPE_FINAL (SELF)
CLASS (CPG_XYBDER_TYPE)          :: SELF

IF (ASSOCIATED (SELF%F_DATA)) CALL DELETE_TEMPORARY (SELF%F_DATA)
SELF%F_DATA => NULL ()

IF (SELF%LOWNED) THEN
  DEALLOCATE (SELF%ZDATA)
ENDIF

SELF%ZDATA => NULL ()
SELF%ZVIEW => NULL ()

IF (ASSOCIATED (SELF%F_LNPRL)) THEN
  CALL DELETE_TEMPORARY (SELF%F_LNPRL) 
  SELF%F_LNPRL => NULL ()
  SELF%LNPRL => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_LNPRM)) THEN
  CALL DELETE_TEMPORARY (SELF%F_LNPRM) 
  SELF%F_LNPRM => NULL ()
  SELF%LNPRM => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_ALPHL)) THEN
  CALL DELETE_TEMPORARY (SELF%F_ALPHL) 
  SELF%F_ALPHL => NULL ()
  SELF%ALPHL => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_ALPHM)) THEN
  CALL DELETE_TEMPORARY (SELF%F_ALPHM) 
  SELF%F_ALPHM => NULL ()
  SELF%ALPHM => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_ALPHPLL)) THEN
  CALL DELETE_TEMPORARY (SELF%F_ALPHPLL) 
  SELF%F_ALPHPLL => NULL ()
  SELF%ALPHPLL => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_ALPHPLM)) THEN
  CALL DELETE_TEMPORARY (SELF%F_ALPHPLM) 
  SELF%F_ALPHPLM => NULL ()
  SELF%ALPHPLM => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_COEFD)) THEN
  CALL DELETE_TEMPORARY (SELF%F_COEFD) 
  SELF%F_COEFD => NULL ()
  SELF%COEFD => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_COEFA)) THEN
  CALL DELETE_TEMPORARY (SELF%F_COEFA) 
  SELF%F_COEFA => NULL ()
  SELF%COEFA => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_COEFAPL)) THEN
  CALL DELETE_TEMPORARY (SELF%F_COEFAPL) 
  SELF%F_COEFAPL => NULL ()
  SELF%COEFAPL => NULL ()
ENDIF

END SUBROUTINE CPG_XYBDER_TYPE_FINAL

SUBROUTINE CPG_XYB_TYPE_INIT (SELF, REGISTRY, NLEV, YDTXYB, PERSISTENT, PTXYB)

USE INTDYN_MOD, ONLY : TXYB
USE OML_MOD, ONLY: OML_MAX_THREADS

CLASS (CPG_XYB_TYPE)                          :: SELF
TYPE (FIELD_REGISTRY),              INTENT (INOUT) :: REGISTRY
INTEGER (KIND=JPIM),                INTENT (IN)    :: NLEV
TYPE (TXYB),                    INTENT (IN)    :: YDTXYB
LOGICAL, OPTIONAL,                  INTENT (IN)    :: PERSISTENT
REAL (KIND=JPRB), OPTIONAL, TARGET, INTENT (IN)    :: PTXYB (:, :, :, :)

LOGICAL :: LLPERSISTENT

LLPERSISTENT = .FALSE.
IF (PRESENT (PERSISTENT)) LLPERSISTENT = PERSISTENT

IF (PRESENT (PTXYB)) THEN
  SELF%ZDATA => PTXYB
  SELF%LOWNED = .FALSE.
  LLPERSISTENT = .TRUE.
ELSEIF (LLPERSISTENT) THEN
  ALLOCATE (SELF%ZDATA (REGISTRY%GEOM%YRDIM%NPROMA, NLEV, YDTXYB%NDIM, REGISTRY%GEOM%YRDIM%NGPBLKS))
  SELF%LOWNED = .TRUE.
ELSE
  ALLOCATE (SELF%ZDATA (REGISTRY%GEOM%YRDIM%NPROMA, NLEV, YDTXYB%NDIM, OML_MAX_THREADS ()))
  SELF%LOWNED = .TRUE.
ENDIF

SELF%F_DATA => CREATE_FIELD_WRAP (SELF%ZDATA, PERSISTENT=LLPERSISTENT)

SELF%F_DELP => CREATE_FIELD_WRAP (SELF%ZDATA (:, :, YDTXYB%M_DELP, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1, 1, 1, 1])
SELF%F_RDELP => CREATE_FIELD_WRAP (SELF%ZDATA (:, :, YDTXYB%M_RDELP, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1, 1, 1, 1])
SELF%F_LNPR => CREATE_FIELD_WRAP (SELF%ZDATA (:, :, YDTXYB%M_LNPR, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1, 1, 1, 1])
SELF%F_ALPH => CREATE_FIELD_WRAP (SELF%ZDATA (:, :, YDTXYB%M_ALPH, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1, 1, 1, 1])
SELF%F_RTGR => CREATE_FIELD_WRAP (SELF%ZDATA (:, :, YDTXYB%M_RTGR, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1, 1, 1, 1])
SELF%F_RPRE => CREATE_FIELD_WRAP (SELF%ZDATA (:, :, YDTXYB%M_RPRE, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1, 1, 1, 1])
SELF%F_RPP => CREATE_FIELD_WRAP (SELF%ZDATA (:, :, YDTXYB%M_RPP, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1, 1, 1, 1])

END SUBROUTINE CPG_XYB_TYPE_INIT

SUBROUTINE CPG_XYB_TYPE_UPDATE_VIEW (SELF, BLOCK_INDEX)

CLASS (CPG_XYB_TYPE)         :: SELF
INTEGER(KIND=JPIM), INTENT (IN)   :: BLOCK_INDEX

IF (ASSOCIATED (SELF%F_DATA)) THEN

  SELF%ZVIEW => SELF%F_DATA%GET_VIEW (BLOCK_INDEX)

  IF (ASSOCIATED (SELF%F_DELP)) THEN
    IF ((.NOT. SELF%F_DELP%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DELP))) THEN
      SELF%DELP  => SELF%F_DELP%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%DELP)) THEN
    SELF%DELP  => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_RDELP)) THEN
    IF ((.NOT. SELF%F_RDELP%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%RDELP))) THEN
      SELF%RDELP  => SELF%F_RDELP%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%RDELP)) THEN
    SELF%RDELP  => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_LNPR)) THEN
    IF ((.NOT. SELF%F_LNPR%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%LNPR))) THEN
      SELF%LNPR  => SELF%F_LNPR%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%LNPR)) THEN
    SELF%LNPR  => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_ALPH)) THEN
    IF ((.NOT. SELF%F_ALPH%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%ALPH))) THEN
      SELF%ALPH  => SELF%F_ALPH%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%ALPH)) THEN
    SELF%ALPH  => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_RTGR)) THEN
    IF ((.NOT. SELF%F_RTGR%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%RTGR))) THEN
      SELF%RTGR  => SELF%F_RTGR%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%RTGR)) THEN
    SELF%RTGR  => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_RPRE)) THEN
    IF ((.NOT. SELF%F_RPRE%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%RPRE))) THEN
      SELF%RPRE  => SELF%F_RPRE%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%RPRE)) THEN
    SELF%RPRE  => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_RPP)) THEN
    IF ((.NOT. SELF%F_RPP%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%RPP))) THEN
      SELF%RPP  => SELF%F_RPP%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%RPP)) THEN
    SELF%RPP  => ZDUM2
  ENDIF

ELSE

  SELF%ZVIEW => ZDUM3

  IF (.NOT. ASSOCIATED (SELF%DELP)) SELF%DELP  => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%RDELP)) SELF%RDELP  => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%LNPR)) SELF%LNPR  => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%ALPH)) SELF%ALPH  => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%RTGR)) SELF%RTGR  => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%RPRE)) SELF%RPRE  => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%RPP)) SELF%RPP  => ZDUM2

ENDIF

END SUBROUTINE CPG_XYB_TYPE_UPDATE_VIEW

SUBROUTINE CPG_XYB_TYPE_FINAL (SELF)
CLASS (CPG_XYB_TYPE)          :: SELF

IF (ASSOCIATED (SELF%F_DATA)) CALL DELETE_TEMPORARY (SELF%F_DATA)
SELF%F_DATA => NULL ()

IF (SELF%LOWNED) THEN
  DEALLOCATE (SELF%ZDATA)
ENDIF

SELF%ZDATA => NULL ()
SELF%ZVIEW => NULL ()

IF (ASSOCIATED (SELF%F_DELP)) THEN
  CALL DELETE_TEMPORARY (SELF%F_DELP) 
  SELF%F_DELP => NULL ()
  SELF%DELP => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_RDELP)) THEN
  CALL DELETE_TEMPORARY (SELF%F_RDELP) 
  SELF%F_RDELP => NULL ()
  SELF%RDELP => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_LNPR)) THEN
  CALL DELETE_TEMPORARY (SELF%F_LNPR) 
  SELF%F_LNPR => NULL ()
  SELF%LNPR => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_ALPH)) THEN
  CALL DELETE_TEMPORARY (SELF%F_ALPH) 
  SELF%F_ALPH => NULL ()
  SELF%ALPH => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_RTGR)) THEN
  CALL DELETE_TEMPORARY (SELF%F_RTGR) 
  SELF%F_RTGR => NULL ()
  SELF%RTGR => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_RPRE)) THEN
  CALL DELETE_TEMPORARY (SELF%F_RPRE) 
  SELF%F_RPRE => NULL ()
  SELF%RPRE => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_RPP)) THEN
  CALL DELETE_TEMPORARY (SELF%F_RPP) 
  SELF%F_RPP => NULL ()
  SELF%RPP => NULL ()
ENDIF

END SUBROUTINE CPG_XYB_TYPE_FINAL

SUBROUTINE CPG_HWIND_TYPE_INIT (SELF, REGISTRY, NLEV, YDTHWIND, PERSISTENT, PTHWIND)

USE INTDYN_MOD, ONLY : THWIND
USE OML_MOD, ONLY: OML_MAX_THREADS

CLASS (CPG_HWIND_TYPE)                          :: SELF
TYPE (FIELD_REGISTRY),              INTENT (INOUT) :: REGISTRY
INTEGER (KIND=JPIM),                INTENT (IN)    :: NLEV
TYPE (THWIND),                    INTENT (IN)    :: YDTHWIND
LOGICAL, OPTIONAL,                  INTENT (IN)    :: PERSISTENT
REAL (KIND=JPRB), OPTIONAL, TARGET, INTENT (IN)    :: PTHWIND (:, :, :, :)

LOGICAL :: LLPERSISTENT

LLPERSISTENT = .FALSE.
IF (PRESENT (PERSISTENT)) LLPERSISTENT = PERSISTENT

IF (PRESENT (PTHWIND)) THEN
  SELF%ZDATA => PTHWIND
  SELF%LOWNED = .FALSE.
  LLPERSISTENT = .TRUE.
ELSEIF (LLPERSISTENT) THEN
  ALLOCATE (SELF%ZDATA (REGISTRY%GEOM%YRDIM%NPROMA, NLEV+1, YDTHWIND%NDIM, REGISTRY%GEOM%YRDIM%NGPBLKS))
  SELF%LOWNED = .TRUE.
ELSE
  ALLOCATE (SELF%ZDATA (REGISTRY%GEOM%YRDIM%NPROMA, NLEV+1, YDTHWIND%NDIM, OML_MAX_THREADS ()))
  SELF%LOWNED = .TRUE.
ENDIF

SELF%F_DATA => CREATE_FIELD_WRAP (SELF%ZDATA, PERSISTENT=LLPERSISTENT)

SELF%F_UH => CREATE_FIELD_WRAP (SELF%ZDATA (:, :, YDTHWIND%M_UH, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1, 0, 1, 1])
SELF%F_VH => CREATE_FIELD_WRAP (SELF%ZDATA (:, :, YDTHWIND%M_VH, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1, 0, 1, 1])
SELF%F_WWI => CREATE_FIELD_WRAP (SELF%ZDATA (:, :, YDTHWIND%M_WWI, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1, 0, 1, 1])

END SUBROUTINE CPG_HWIND_TYPE_INIT

SUBROUTINE CPG_HWIND_TYPE_UPDATE_VIEW (SELF, BLOCK_INDEX)

CLASS (CPG_HWIND_TYPE)         :: SELF
INTEGER(KIND=JPIM), INTENT (IN)   :: BLOCK_INDEX

IF (ASSOCIATED (SELF%F_DATA)) THEN

  SELF%ZVIEW => SELF%F_DATA%GET_VIEW (BLOCK_INDEX)

  IF (ASSOCIATED (SELF%F_UH)) THEN
    IF ((.NOT. SELF%F_UH%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%UH))) THEN
      SELF%UH  => SELF%F_UH%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%UH)) THEN
    SELF%UH  => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_VH)) THEN
    IF ((.NOT. SELF%F_VH%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%VH))) THEN
      SELF%VH  => SELF%F_VH%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%VH)) THEN
    SELF%VH  => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_WWI)) THEN
    IF ((.NOT. SELF%F_WWI%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%WWI))) THEN
      SELF%WWI  => SELF%F_WWI%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%WWI)) THEN
    SELF%WWI  => ZDUM2
  ENDIF

ELSE

  SELF%ZVIEW => ZDUM3

  IF (.NOT. ASSOCIATED (SELF%UH)) SELF%UH  => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%VH)) SELF%VH  => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%WWI)) SELF%WWI  => ZDUM2

ENDIF

END SUBROUTINE CPG_HWIND_TYPE_UPDATE_VIEW

SUBROUTINE CPG_HWIND_TYPE_FINAL (SELF)
CLASS (CPG_HWIND_TYPE)          :: SELF

IF (ASSOCIATED (SELF%F_DATA)) CALL DELETE_TEMPORARY (SELF%F_DATA)
SELF%F_DATA => NULL ()

IF (SELF%LOWNED) THEN
  DEALLOCATE (SELF%ZDATA)
ENDIF

SELF%ZDATA => NULL ()
SELF%ZVIEW => NULL ()

IF (ASSOCIATED (SELF%F_UH)) THEN
  CALL DELETE_TEMPORARY (SELF%F_UH) 
  SELF%F_UH => NULL ()
  SELF%UH => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_VH)) THEN
  CALL DELETE_TEMPORARY (SELF%F_VH) 
  SELF%F_VH => NULL ()
  SELF%VH => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_WWI)) THEN
  CALL DELETE_TEMPORARY (SELF%F_WWI) 
  SELF%F_WWI => NULL ()
  SELF%WWI => NULL ()
ENDIF

END SUBROUTINE CPG_HWIND_TYPE_FINAL

SUBROUTINE CPG_RCP_TYPE_INIT (SELF, REGISTRY, NLEV, YDTRCP, PERSISTENT, PTRCP)

USE INTDYN_MOD, ONLY : TRCP
USE OML_MOD, ONLY: OML_MAX_THREADS

CLASS (CPG_RCP_TYPE)                          :: SELF
TYPE (FIELD_REGISTRY),              INTENT (INOUT) :: REGISTRY
INTEGER (KIND=JPIM),                INTENT (IN)    :: NLEV
TYPE (TRCP),                    INTENT (IN)    :: YDTRCP
LOGICAL, OPTIONAL,                  INTENT (IN)    :: PERSISTENT
REAL (KIND=JPRB), OPTIONAL, TARGET, INTENT (IN)    :: PTRCP (:, :, :, :)

LOGICAL :: LLPERSISTENT

LLPERSISTENT = .FALSE.
IF (PRESENT (PERSISTENT)) LLPERSISTENT = PERSISTENT

IF (PRESENT (PTRCP)) THEN
  SELF%ZDATA => PTRCP
  SELF%LOWNED = .FALSE.
  LLPERSISTENT = .TRUE.
ELSEIF (LLPERSISTENT) THEN
  ALLOCATE (SELF%ZDATA (REGISTRY%GEOM%YRDIM%NPROMA, NLEV, YDTRCP%NDIM, REGISTRY%GEOM%YRDIM%NGPBLKS))
  SELF%LOWNED = .TRUE.
ELSE
  ALLOCATE (SELF%ZDATA (REGISTRY%GEOM%YRDIM%NPROMA, NLEV, YDTRCP%NDIM, OML_MAX_THREADS ()))
  SELF%LOWNED = .TRUE.
ENDIF

SELF%F_DATA => CREATE_FIELD_WRAP (SELF%ZDATA, PERSISTENT=LLPERSISTENT)

SELF%F_CP => CREATE_FIELD_WRAP (SELF%ZDATA (:, :, YDTRCP%M_CP, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1, 1, 1, 1])
SELF%F_R => CREATE_FIELD_WRAP (SELF%ZDATA (:, :, YDTRCP%M_R, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1, 1, 1, 1])
SELF%F_KAP => CREATE_FIELD_WRAP (SELF%ZDATA (:, :, YDTRCP%M_KAP, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1, 1, 1, 1])

END SUBROUTINE CPG_RCP_TYPE_INIT

SUBROUTINE CPG_RCP_TYPE_UPDATE_VIEW (SELF, BLOCK_INDEX)

CLASS (CPG_RCP_TYPE)         :: SELF
INTEGER(KIND=JPIM), INTENT (IN)   :: BLOCK_INDEX

IF (ASSOCIATED (SELF%F_DATA)) THEN

  SELF%ZVIEW => SELF%F_DATA%GET_VIEW (BLOCK_INDEX)

  IF (ASSOCIATED (SELF%F_CP)) THEN
    IF ((.NOT. SELF%F_CP%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%CP))) THEN
      SELF%CP  => SELF%F_CP%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%CP)) THEN
    SELF%CP  => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_R)) THEN
    IF ((.NOT. SELF%F_R%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%R))) THEN
      SELF%R  => SELF%F_R%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%R)) THEN
    SELF%R  => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_KAP)) THEN
    IF ((.NOT. SELF%F_KAP%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%KAP))) THEN
      SELF%KAP  => SELF%F_KAP%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%KAP)) THEN
    SELF%KAP  => ZDUM2
  ENDIF

ELSE

  SELF%ZVIEW => ZDUM3

  IF (.NOT. ASSOCIATED (SELF%CP)) SELF%CP  => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%R)) SELF%R  => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%KAP)) SELF%KAP  => ZDUM2

ENDIF

END SUBROUTINE CPG_RCP_TYPE_UPDATE_VIEW

SUBROUTINE CPG_RCP_TYPE_FINAL (SELF)
CLASS (CPG_RCP_TYPE)          :: SELF

IF (ASSOCIATED (SELF%F_DATA)) CALL DELETE_TEMPORARY (SELF%F_DATA)
SELF%F_DATA => NULL ()

IF (SELF%LOWNED) THEN
  DEALLOCATE (SELF%ZDATA)
ENDIF

SELF%ZDATA => NULL ()
SELF%ZVIEW => NULL ()

IF (ASSOCIATED (SELF%F_CP)) THEN
  CALL DELETE_TEMPORARY (SELF%F_CP) 
  SELF%F_CP => NULL ()
  SELF%CP => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_R)) THEN
  CALL DELETE_TEMPORARY (SELF%F_R) 
  SELF%F_R => NULL ()
  SELF%R => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_KAP)) THEN
  CALL DELETE_TEMPORARY (SELF%F_KAP) 
  SELF%F_KAP => NULL ()
  SELF%KAP => NULL ()
ENDIF

END SUBROUTINE CPG_RCP_TYPE_FINAL

SUBROUTINE CPG_CTY_TYPE_INIT (SELF, REGISTRY, NLEV, YDTCTY, PERSISTENT, PTCTY)

USE INTDYN_MOD, ONLY : TCTY
USE OML_MOD, ONLY: OML_MAX_THREADS

CLASS (CPG_CTY_TYPE)                          :: SELF
TYPE (FIELD_REGISTRY),              INTENT (INOUT) :: REGISTRY
INTEGER (KIND=JPIM),                INTENT (IN)    :: NLEV
TYPE (TCTY),                    INTENT (IN)    :: YDTCTY
LOGICAL, OPTIONAL,                  INTENT (IN)    :: PERSISTENT
REAL (KIND=JPRB), OPTIONAL, TARGET, INTENT (IN)    :: PTCTY (:, :, :, :)

LOGICAL :: LLPERSISTENT

LLPERSISTENT = .FALSE.
IF (PRESENT (PERSISTENT)) LLPERSISTENT = PERSISTENT

IF (PRESENT (PTCTY)) THEN
  SELF%ZDATA => PTCTY
  SELF%LOWNED = .FALSE.
  LLPERSISTENT = .TRUE.
ELSEIF (LLPERSISTENT) THEN
  ALLOCATE (SELF%ZDATA (REGISTRY%GEOM%YRDIM%NPROMA, NLEV+1, YDTCTY%NDIM, REGISTRY%GEOM%YRDIM%NGPBLKS))
  SELF%LOWNED = .TRUE.
ELSE
  ALLOCATE (SELF%ZDATA (REGISTRY%GEOM%YRDIM%NPROMA, NLEV+1, YDTCTY%NDIM, OML_MAX_THREADS ()))
  SELF%LOWNED = .TRUE.
ENDIF

SELF%F_DATA => CREATE_FIELD_WRAP (SELF%ZDATA, PERSISTENT=LLPERSISTENT)

SELF%F_EVEL => CREATE_FIELD_WRAP (SELF%ZDATA (:, :, YDTCTY%M_EVEL, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1, 0, 1, 1])
SELF%F_VVEL => CREATE_FIELD_WRAP (SELF%ZDATA (:, :, YDTCTY%M_VVEL, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1, 0, 1, 1])
SELF%F_PSDIV => CREATE_FIELD_WRAP (SELF%ZDATA (:, :, YDTCTY%M_PSDIV, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1, 0, 1, 1])
SELF%F_PSDVBC => CREATE_FIELD_WRAP (SELF%ZDATA (:, :, YDTCTY%M_PSDVBC, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1, 0, 1, 1])
SELF%F_DIVDP => CREATE_FIELD_WRAP (SELF%ZDATA (:, :, YDTCTY%M_DIVDP, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1, 0, 1, 1])

END SUBROUTINE CPG_CTY_TYPE_INIT

SUBROUTINE CPG_CTY_TYPE_UPDATE_VIEW (SELF, BLOCK_INDEX)

CLASS (CPG_CTY_TYPE)         :: SELF
INTEGER(KIND=JPIM), INTENT (IN)   :: BLOCK_INDEX

IF (ASSOCIATED (SELF%F_DATA)) THEN

  SELF%ZVIEW => SELF%F_DATA%GET_VIEW (BLOCK_INDEX)

  IF (ASSOCIATED (SELF%F_EVEL)) THEN
    IF ((.NOT. SELF%F_EVEL%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%EVEL))) THEN
      SELF%EVEL  => SELF%F_EVEL%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%EVEL)) THEN
    SELF%EVEL  => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_VVEL)) THEN
    IF ((.NOT. SELF%F_VVEL%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%VVEL))) THEN
      SELF%VVEL  => SELF%F_VVEL%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%VVEL)) THEN
    SELF%VVEL  => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_PSDIV)) THEN
    IF ((.NOT. SELF%F_PSDIV%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%PSDIV))) THEN
      SELF%PSDIV  => SELF%F_PSDIV%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%PSDIV)) THEN
    SELF%PSDIV  => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_PSDVBC)) THEN
    IF ((.NOT. SELF%F_PSDVBC%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%PSDVBC))) THEN
      SELF%PSDVBC  => SELF%F_PSDVBC%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%PSDVBC)) THEN
    SELF%PSDVBC  => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_DIVDP)) THEN
    IF ((.NOT. SELF%F_DIVDP%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DIVDP))) THEN
      SELF%DIVDP  => SELF%F_DIVDP%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%DIVDP)) THEN
    SELF%DIVDP  => ZDUM2
  ENDIF

ELSE

  SELF%ZVIEW => ZDUM3

  IF (.NOT. ASSOCIATED (SELF%EVEL)) SELF%EVEL  => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%VVEL)) SELF%VVEL  => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%PSDIV)) SELF%PSDIV  => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%PSDVBC)) SELF%PSDVBC  => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%DIVDP)) SELF%DIVDP  => ZDUM2

ENDIF

END SUBROUTINE CPG_CTY_TYPE_UPDATE_VIEW

SUBROUTINE CPG_CTY_TYPE_FINAL (SELF)
CLASS (CPG_CTY_TYPE)          :: SELF

IF (ASSOCIATED (SELF%F_DATA)) CALL DELETE_TEMPORARY (SELF%F_DATA)
SELF%F_DATA => NULL ()

IF (SELF%LOWNED) THEN
  DEALLOCATE (SELF%ZDATA)
ENDIF

SELF%ZDATA => NULL ()
SELF%ZVIEW => NULL ()

IF (ASSOCIATED (SELF%F_EVEL)) THEN
  CALL DELETE_TEMPORARY (SELF%F_EVEL) 
  SELF%F_EVEL => NULL ()
  SELF%EVEL => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_VVEL)) THEN
  CALL DELETE_TEMPORARY (SELF%F_VVEL) 
  SELF%F_VVEL => NULL ()
  SELF%VVEL => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_PSDIV)) THEN
  CALL DELETE_TEMPORARY (SELF%F_PSDIV) 
  SELF%F_PSDIV => NULL ()
  SELF%PSDIV => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_PSDVBC)) THEN
  CALL DELETE_TEMPORARY (SELF%F_PSDVBC) 
  SELF%F_PSDVBC => NULL ()
  SELF%PSDVBC => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_DIVDP)) THEN
  CALL DELETE_TEMPORARY (SELF%F_DIVDP) 
  SELF%F_DIVDP => NULL ()
  SELF%DIVDP => NULL ()
ENDIF

END SUBROUTINE CPG_CTY_TYPE_FINAL

SUBROUTINE CPG_TND_TYPE_INIT (SELF, REGISTRY, NLEV, YDTTND, PERSISTENT, PTTND)

USE INTDYN_MOD, ONLY : TTND
USE OML_MOD, ONLY: OML_MAX_THREADS

CLASS (CPG_TND_TYPE)                          :: SELF
TYPE (FIELD_REGISTRY),              INTENT (INOUT) :: REGISTRY
INTEGER (KIND=JPIM),                INTENT (IN)    :: NLEV
TYPE (TTND),                    INTENT (IN)    :: YDTTND
LOGICAL, OPTIONAL,                  INTENT (IN)    :: PERSISTENT
REAL (KIND=JPRB), OPTIONAL, TARGET, INTENT (IN)    :: PTTND (:, :, :, :)

LOGICAL :: LLPERSISTENT

LLPERSISTENT = .FALSE.
IF (PRESENT (PERSISTENT)) LLPERSISTENT = PERSISTENT

IF (PRESENT (PTTND)) THEN
  SELF%ZDATA => PTTND
  SELF%LOWNED = .FALSE.
  LLPERSISTENT = .TRUE.
ELSEIF (LLPERSISTENT) THEN
  ALLOCATE (SELF%ZDATA (REGISTRY%GEOM%YRDIM%NPROMA, NLEV, YDTTND%NDIM, REGISTRY%GEOM%YRDIM%NGPBLKS))
  SELF%LOWNED = .TRUE.
ELSE
  ALLOCATE (SELF%ZDATA (REGISTRY%GEOM%YRDIM%NPROMA, NLEV, YDTTND%NDIM, OML_MAX_THREADS ()))
  SELF%LOWNED = .TRUE.
ENDIF

SELF%F_DATA => CREATE_FIELD_WRAP (SELF%ZDATA, PERSISTENT=LLPERSISTENT)

SELF%F_TNDU => CREATE_FIELD_WRAP (SELF%ZDATA (:, :, YDTTND%M_TNDU, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1, 1, 1, 1])
SELF%F_TNDV => CREATE_FIELD_WRAP (SELF%ZDATA (:, :, YDTTND%M_TNDV, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1, 1, 1, 1])
SELF%F_TNDU_NOC => CREATE_FIELD_WRAP (SELF%ZDATA (:, :, YDTTND%M_TNDU_NOC, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1, 1, 1, 1])
SELF%F_TNDV_NOC => CREATE_FIELD_WRAP (SELF%ZDATA (:, :, YDTTND%M_TNDV_NOC, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1, 1, 1, 1])
SELF%F_TNDT => CREATE_FIELD_WRAP (SELF%ZDATA (:, :, YDTTND%M_TNDT, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1, 1, 1, 1])
SELF%F_TNDPD => CREATE_FIELD_WRAP (SELF%ZDATA (:, :, YDTTND%M_TNDPD, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1, 1, 1, 1])
SELF%F_TNDVD => CREATE_FIELD_WRAP (SELF%ZDATA (:, :, YDTTND%M_TNDVD, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1, 1, 1, 1])
SELF%F_TNDGW => CREATE_FIELD_WRAP (SELF%ZDATA (:, :, YDTTND%M_TNDGW, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1, 1, 1, 1])

END SUBROUTINE CPG_TND_TYPE_INIT

SUBROUTINE CPG_TND_TYPE_UPDATE_VIEW (SELF, BLOCK_INDEX)

CLASS (CPG_TND_TYPE)         :: SELF
INTEGER(KIND=JPIM), INTENT (IN)   :: BLOCK_INDEX

IF (ASSOCIATED (SELF%F_DATA)) THEN

  SELF%ZVIEW => SELF%F_DATA%GET_VIEW (BLOCK_INDEX)

  IF (ASSOCIATED (SELF%F_TNDU)) THEN
    IF ((.NOT. SELF%F_TNDU%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%TNDU))) THEN
      SELF%TNDU  => SELF%F_TNDU%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%TNDU)) THEN
    SELF%TNDU  => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_TNDV)) THEN
    IF ((.NOT. SELF%F_TNDV%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%TNDV))) THEN
      SELF%TNDV  => SELF%F_TNDV%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%TNDV)) THEN
    SELF%TNDV  => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_TNDU_NOC)) THEN
    IF ((.NOT. SELF%F_TNDU_NOC%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%TNDU_NOC))) THEN
      SELF%TNDU_NOC  => SELF%F_TNDU_NOC%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%TNDU_NOC)) THEN
    SELF%TNDU_NOC  => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_TNDV_NOC)) THEN
    IF ((.NOT. SELF%F_TNDV_NOC%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%TNDV_NOC))) THEN
      SELF%TNDV_NOC  => SELF%F_TNDV_NOC%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%TNDV_NOC)) THEN
    SELF%TNDV_NOC  => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_TNDT)) THEN
    IF ((.NOT. SELF%F_TNDT%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%TNDT))) THEN
      SELF%TNDT  => SELF%F_TNDT%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%TNDT)) THEN
    SELF%TNDT  => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_TNDPD)) THEN
    IF ((.NOT. SELF%F_TNDPD%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%TNDPD))) THEN
      SELF%TNDPD  => SELF%F_TNDPD%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%TNDPD)) THEN
    SELF%TNDPD  => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_TNDVD)) THEN
    IF ((.NOT. SELF%F_TNDVD%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%TNDVD))) THEN
      SELF%TNDVD  => SELF%F_TNDVD%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%TNDVD)) THEN
    SELF%TNDVD  => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_TNDGW)) THEN
    IF ((.NOT. SELF%F_TNDGW%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%TNDGW))) THEN
      SELF%TNDGW  => SELF%F_TNDGW%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%TNDGW)) THEN
    SELF%TNDGW  => ZDUM2
  ENDIF

ELSE

  SELF%ZVIEW => ZDUM3

  IF (.NOT. ASSOCIATED (SELF%TNDU)) SELF%TNDU  => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%TNDV)) SELF%TNDV  => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%TNDU_NOC)) SELF%TNDU_NOC  => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%TNDV_NOC)) SELF%TNDV_NOC  => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%TNDT)) SELF%TNDT  => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%TNDPD)) SELF%TNDPD  => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%TNDVD)) SELF%TNDVD  => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%TNDGW)) SELF%TNDGW  => ZDUM2

ENDIF

END SUBROUTINE CPG_TND_TYPE_UPDATE_VIEW

SUBROUTINE CPG_TND_TYPE_FINAL (SELF)
CLASS (CPG_TND_TYPE)          :: SELF

IF (ASSOCIATED (SELF%F_DATA)) CALL DELETE_TEMPORARY (SELF%F_DATA)
SELF%F_DATA => NULL ()

IF (SELF%LOWNED) THEN
  DEALLOCATE (SELF%ZDATA)
ENDIF

SELF%ZDATA => NULL ()
SELF%ZVIEW => NULL ()

IF (ASSOCIATED (SELF%F_TNDU)) THEN
  CALL DELETE_TEMPORARY (SELF%F_TNDU) 
  SELF%F_TNDU => NULL ()
  SELF%TNDU => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_TNDV)) THEN
  CALL DELETE_TEMPORARY (SELF%F_TNDV) 
  SELF%F_TNDV => NULL ()
  SELF%TNDV => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_TNDU_NOC)) THEN
  CALL DELETE_TEMPORARY (SELF%F_TNDU_NOC) 
  SELF%F_TNDU_NOC => NULL ()
  SELF%TNDU_NOC => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_TNDV_NOC)) THEN
  CALL DELETE_TEMPORARY (SELF%F_TNDV_NOC) 
  SELF%F_TNDV_NOC => NULL ()
  SELF%TNDV_NOC => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_TNDT)) THEN
  CALL DELETE_TEMPORARY (SELF%F_TNDT) 
  SELF%F_TNDT => NULL ()
  SELF%TNDT => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_TNDPD)) THEN
  CALL DELETE_TEMPORARY (SELF%F_TNDPD) 
  SELF%F_TNDPD => NULL ()
  SELF%TNDPD => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_TNDVD)) THEN
  CALL DELETE_TEMPORARY (SELF%F_TNDVD) 
  SELF%F_TNDVD => NULL ()
  SELF%TNDVD => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_TNDGW)) THEN
  CALL DELETE_TEMPORARY (SELF%F_TNDGW) 
  SELF%F_TNDGW => NULL ()
  SELF%TNDGW => NULL ()
ENDIF

END SUBROUTINE CPG_TND_TYPE_FINAL

SUBROUTINE CPG_GPAR_TYPE_INIT (SELF, REGISTRY, YDCPG_OPTS, YDTPARAR, PERSISTENT, PTPARAR)

USE YOMPARAR, ONLY : TPARAR
USE OML_MOD, ONLY: OML_MAX_THREADS
USE CPG_OPTS_TYPE_MOD, ONLY : CPG_OPTS_TYPE

CLASS (CPG_GPAR_TYPE)                          :: SELF
TYPE (FIELD_REGISTRY),              INTENT (INOUT) :: REGISTRY
TYPE (CPG_OPTS_TYPE),               INTENT (IN)    :: YDCPG_OPTS
TYPE (TPARAR),                    INTENT (IN)    :: YDTPARAR
LOGICAL, OPTIONAL,                  INTENT (IN)    :: PERSISTENT
REAL (KIND=JPRB), OPTIONAL, TARGET, INTENT (IN)    :: PTPARAR (:, :, :)

LOGICAL :: LLPERSISTENT

LLPERSISTENT = .FALSE.
IF (PRESENT (PERSISTENT)) LLPERSISTENT = PERSISTENT

IF (PRESENT (PTPARAR)) THEN
  SELF%ZDATA => PTPARAR
  SELF%LOWNED = .FALSE.
  LLPERSISTENT = .TRUE.
ELSEIF (LLPERSISTENT) THEN
  ALLOCATE (SELF%ZDATA (REGISTRY%GEOM%YRDIM%NPROMA, YDTPARAR%NGPAR, REGISTRY%GEOM%YRDIM%NGPBLKS))
  SELF%LOWNED = .TRUE.
ELSE
  ALLOCATE (SELF%ZDATA (REGISTRY%GEOM%YRDIM%NPROMA, YDTPARAR%NGPAR, OML_MAX_THREADS ()))
  SELF%LOWNED = .TRUE.
ENDIF

SELF%F_DATA => CREATE_FIELD_WRAP (SELF%ZDATA, PERSISTENT=LLPERSISTENT)

IF (YDTPARAR%MINPRR > 0) THEN
  SELF%F_INPRR => CREATE_FIELD_WRAP (SELF%ZDATA (:, YDTPARAR%MINPRR, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_INPRR => NULL ()
ENDIF
IF (YDTPARAR%MINPRS > 0) THEN
  SELF%F_INPRS => CREATE_FIELD_WRAP (SELF%ZDATA (:, YDTPARAR%MINPRS, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_INPRS => NULL ()
ENDIF
IF (YDTPARAR%MINPRG > 0) THEN
  SELF%F_INPRG => CREATE_FIELD_WRAP (SELF%ZDATA (:, YDTPARAR%MINPRG, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_INPRG => NULL ()
ENDIF
IF (YDTPARAR%MACPRR > 0) THEN
  SELF%F_ACPRR => CREATE_FIELD_WRAP (SELF%ZDATA (:, YDTPARAR%MACPRR, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_ACPRR => NULL ()
ENDIF
IF (YDTPARAR%MACPRS > 0) THEN
  SELF%F_ACPRS => CREATE_FIELD_WRAP (SELF%ZDATA (:, YDTPARAR%MACPRS, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_ACPRS => NULL ()
ENDIF
IF (YDTPARAR%MACPRG > 0) THEN
  SELF%F_ACPRG => CREATE_FIELD_WRAP (SELF%ZDATA (:, YDTPARAR%MACPRG, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_ACPRG => NULL ()
ENDIF
IF (YDTPARAR%MALBDIR > 0) THEN
  SELF%F_ALBDIR => CREATE_FIELD_WRAP (SELF%ZDATA (:, YDTPARAR%MALBDIR:YDTPARAR%MALBDIR+YDCPG_OPTS%KSW-1, :),&
      & PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_ALBDIR => NULL ()
ENDIF
IF (YDTPARAR%MALBSCA > 0) THEN
  SELF%F_ALBSCA => CREATE_FIELD_WRAP (SELF%ZDATA (:, YDTPARAR%MALBSCA:YDTPARAR%MALBSCA+YDCPG_OPTS%KSW-1, :),&
      & PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_ALBSCA => NULL ()
ENDIF
IF (YDTPARAR%MRAIN > 0) THEN
  SELF%F_RAIN => CREATE_FIELD_WRAP (SELF%ZDATA (:, YDTPARAR%MRAIN, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_RAIN => NULL ()
ENDIF
IF (YDTPARAR%MSNOW > 0) THEN
  SELF%F_SNOW => CREATE_FIELD_WRAP (SELF%ZDATA (:, YDTPARAR%MSNOW, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_SNOW => NULL ()
ENDIF
IF (YDTPARAR%MGZ0 > 0) THEN
  SELF%F_GZ0 => CREATE_FIELD_WRAP (SELF%ZDATA (:, YDTPARAR%MGZ0, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_GZ0 => NULL ()
ENDIF
IF (YDTPARAR%MGZ0H > 0) THEN
  SELF%F_GZ0H => CREATE_FIELD_WRAP (SELF%ZDATA (:, YDTPARAR%MGZ0H, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_GZ0H => NULL ()
ENDIF
IF (YDTPARAR%MVQS > 0) THEN
  SELF%F_VQS => CREATE_FIELD_WRAP (SELF%ZDATA (:, YDTPARAR%MVQS, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_VQS => NULL ()
ENDIF
IF (YDTPARAR%MVTS > 0) THEN
  SELF%F_VTS => CREATE_FIELD_WRAP (SELF%ZDATA (:, YDTPARAR%MVTS, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_VTS => NULL ()
ENDIF
IF (YDTPARAR%MVEMIS > 0) THEN
  SELF%F_VEMIS => CREATE_FIELD_WRAP (SELF%ZDATA (:, YDTPARAR%MVEMIS, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_VEMIS => NULL ()
ENDIF
IF (YDTPARAR%MSWDIR > 0) THEN
  SELF%F_SWDIR => CREATE_FIELD_WRAP (SELF%ZDATA (:, YDTPARAR%MSWDIR:YDTPARAR%MSWDIR+YDCPG_OPTS%KSW-1, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_SWDIR => NULL ()
ENDIF
IF (YDTPARAR%MSWDIF > 0) THEN
  SELF%F_SWDIF => CREATE_FIELD_WRAP (SELF%ZDATA (:, YDTPARAR%MSWDIF:YDTPARAR%MSWDIF+YDCPG_OPTS%KSW-1, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_SWDIF => NULL ()
ENDIF
IF (YDTPARAR%MLSM > 0) THEN
  SELF%F_LSM => CREATE_FIELD_WRAP (SELF%ZDATA (:, YDTPARAR%MLSM, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_LSM => NULL ()
ENDIF
IF (YDTPARAR%MCD > 0) THEN
  SELF%F_CD => CREATE_FIELD_WRAP (SELF%ZDATA (:, YDTPARAR%MCD, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_CD => NULL ()
ENDIF

END SUBROUTINE CPG_GPAR_TYPE_INIT

SUBROUTINE CPG_GPAR_TYPE_UPDATE_VIEW (SELF, BLOCK_INDEX)

CLASS (CPG_GPAR_TYPE)         :: SELF
INTEGER(KIND=JPIM), INTENT (IN)   :: BLOCK_INDEX

IF (ASSOCIATED (SELF%F_DATA)) THEN

  SELF%ZVIEW => SELF%F_DATA%GET_VIEW (BLOCK_INDEX)

  IF (ASSOCIATED (SELF%F_INPRR)) THEN
    IF ((.NOT. SELF%F_INPRR%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%INPRR))) THEN
      SELF%INPRR  => SELF%F_INPRR%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%INPRR)) THEN
    SELF%INPRR  => ZDUM1
  ENDIF
  IF (ASSOCIATED (SELF%F_INPRS)) THEN
    IF ((.NOT. SELF%F_INPRS%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%INPRS))) THEN
      SELF%INPRS  => SELF%F_INPRS%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%INPRS)) THEN
    SELF%INPRS  => ZDUM1
  ENDIF
  IF (ASSOCIATED (SELF%F_INPRG)) THEN
    IF ((.NOT. SELF%F_INPRG%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%INPRG))) THEN
      SELF%INPRG  => SELF%F_INPRG%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%INPRG)) THEN
    SELF%INPRG  => ZDUM1
  ENDIF
  IF (ASSOCIATED (SELF%F_ACPRR)) THEN
    IF ((.NOT. SELF%F_ACPRR%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%ACPRR))) THEN
      SELF%ACPRR  => SELF%F_ACPRR%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%ACPRR)) THEN
    SELF%ACPRR  => ZDUM1
  ENDIF
  IF (ASSOCIATED (SELF%F_ACPRS)) THEN
    IF ((.NOT. SELF%F_ACPRS%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%ACPRS))) THEN
      SELF%ACPRS  => SELF%F_ACPRS%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%ACPRS)) THEN
    SELF%ACPRS  => ZDUM1
  ENDIF
  IF (ASSOCIATED (SELF%F_ACPRG)) THEN
    IF ((.NOT. SELF%F_ACPRG%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%ACPRG))) THEN
      SELF%ACPRG  => SELF%F_ACPRG%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%ACPRG)) THEN
    SELF%ACPRG  => ZDUM1
  ENDIF
  IF (ASSOCIATED (SELF%F_ALBDIR)) THEN
    IF ((.NOT. SELF%F_ALBDIR%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%ALBDIR))) THEN
      SELF%ALBDIR  => SELF%F_ALBDIR%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%ALBDIR)) THEN
    SELF%ALBDIR  => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_ALBSCA)) THEN
    IF ((.NOT. SELF%F_ALBSCA%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%ALBSCA))) THEN
      SELF%ALBSCA  => SELF%F_ALBSCA%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%ALBSCA)) THEN
    SELF%ALBSCA  => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_RAIN)) THEN
    IF ((.NOT. SELF%F_RAIN%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%RAIN))) THEN
      SELF%RAIN  => SELF%F_RAIN%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%RAIN)) THEN
    SELF%RAIN  => ZDUM1
  ENDIF
  IF (ASSOCIATED (SELF%F_SNOW)) THEN
    IF ((.NOT. SELF%F_SNOW%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%SNOW))) THEN
      SELF%SNOW  => SELF%F_SNOW%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%SNOW)) THEN
    SELF%SNOW  => ZDUM1
  ENDIF
  IF (ASSOCIATED (SELF%F_GZ0)) THEN
    IF ((.NOT. SELF%F_GZ0%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%GZ0))) THEN
      SELF%GZ0  => SELF%F_GZ0%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%GZ0)) THEN
    SELF%GZ0  => ZDUM1
  ENDIF
  IF (ASSOCIATED (SELF%F_GZ0H)) THEN
    IF ((.NOT. SELF%F_GZ0H%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%GZ0H))) THEN
      SELF%GZ0H  => SELF%F_GZ0H%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%GZ0H)) THEN
    SELF%GZ0H  => ZDUM1
  ENDIF
  IF (ASSOCIATED (SELF%F_VQS)) THEN
    IF ((.NOT. SELF%F_VQS%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%VQS))) THEN
      SELF%VQS  => SELF%F_VQS%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%VQS)) THEN
    SELF%VQS  => ZDUM1
  ENDIF
  IF (ASSOCIATED (SELF%F_VTS)) THEN
    IF ((.NOT. SELF%F_VTS%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%VTS))) THEN
      SELF%VTS  => SELF%F_VTS%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%VTS)) THEN
    SELF%VTS  => ZDUM1
  ENDIF
  IF (ASSOCIATED (SELF%F_VEMIS)) THEN
    IF ((.NOT. SELF%F_VEMIS%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%VEMIS))) THEN
      SELF%VEMIS  => SELF%F_VEMIS%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%VEMIS)) THEN
    SELF%VEMIS  => ZDUM1
  ENDIF
  IF (ASSOCIATED (SELF%F_SWDIR)) THEN
    IF ((.NOT. SELF%F_SWDIR%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%SWDIR))) THEN
      SELF%SWDIR  => SELF%F_SWDIR%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%SWDIR)) THEN
    SELF%SWDIR  => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_SWDIF)) THEN
    IF ((.NOT. SELF%F_SWDIF%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%SWDIF))) THEN
      SELF%SWDIF  => SELF%F_SWDIF%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%SWDIF)) THEN
    SELF%SWDIF  => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_LSM)) THEN
    IF ((.NOT. SELF%F_LSM%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%LSM))) THEN
      SELF%LSM  => SELF%F_LSM%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%LSM)) THEN
    SELF%LSM  => ZDUM1
  ENDIF
  IF (ASSOCIATED (SELF%F_CD)) THEN
    IF ((.NOT. SELF%F_CD%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%CD))) THEN
      SELF%CD  => SELF%F_CD%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%CD)) THEN
    SELF%CD  => ZDUM1
  ENDIF

ELSE

  SELF%ZVIEW => ZDUM2

  IF (.NOT. ASSOCIATED (SELF%INPRR)) SELF%INPRR  => ZDUM1
  IF (.NOT. ASSOCIATED (SELF%INPRS)) SELF%INPRS  => ZDUM1
  IF (.NOT. ASSOCIATED (SELF%INPRG)) SELF%INPRG  => ZDUM1
  IF (.NOT. ASSOCIATED (SELF%ACPRR)) SELF%ACPRR  => ZDUM1
  IF (.NOT. ASSOCIATED (SELF%ACPRS)) SELF%ACPRS  => ZDUM1
  IF (.NOT. ASSOCIATED (SELF%ACPRG)) SELF%ACPRG  => ZDUM1
  IF (.NOT. ASSOCIATED (SELF%ALBDIR)) SELF%ALBDIR  => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%ALBSCA)) SELF%ALBSCA  => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%RAIN)) SELF%RAIN  => ZDUM1
  IF (.NOT. ASSOCIATED (SELF%SNOW)) SELF%SNOW  => ZDUM1
  IF (.NOT. ASSOCIATED (SELF%GZ0)) SELF%GZ0  => ZDUM1
  IF (.NOT. ASSOCIATED (SELF%GZ0H)) SELF%GZ0H  => ZDUM1
  IF (.NOT. ASSOCIATED (SELF%VQS)) SELF%VQS  => ZDUM1
  IF (.NOT. ASSOCIATED (SELF%VTS)) SELF%VTS  => ZDUM1
  IF (.NOT. ASSOCIATED (SELF%VEMIS)) SELF%VEMIS  => ZDUM1
  IF (.NOT. ASSOCIATED (SELF%SWDIR)) SELF%SWDIR  => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%SWDIF)) SELF%SWDIF  => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%LSM)) SELF%LSM  => ZDUM1
  IF (.NOT. ASSOCIATED (SELF%CD)) SELF%CD  => ZDUM1

ENDIF

END SUBROUTINE CPG_GPAR_TYPE_UPDATE_VIEW

SUBROUTINE CPG_GPAR_TYPE_FINAL (SELF)
CLASS (CPG_GPAR_TYPE)          :: SELF

IF (ASSOCIATED (SELF%F_DATA)) CALL DELETE_TEMPORARY (SELF%F_DATA)
SELF%F_DATA => NULL ()

IF (SELF%LOWNED) THEN
  DEALLOCATE (SELF%ZDATA)
ENDIF

SELF%ZDATA => NULL ()
SELF%ZVIEW => NULL ()

IF (ASSOCIATED (SELF%F_INPRR)) THEN
  CALL DELETE_TEMPORARY (SELF%F_INPRR) 
  SELF%F_INPRR => NULL ()
  SELF%INPRR => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_INPRS)) THEN
  CALL DELETE_TEMPORARY (SELF%F_INPRS) 
  SELF%F_INPRS => NULL ()
  SELF%INPRS => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_INPRG)) THEN
  CALL DELETE_TEMPORARY (SELF%F_INPRG) 
  SELF%F_INPRG => NULL ()
  SELF%INPRG => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_ACPRR)) THEN
  CALL DELETE_TEMPORARY (SELF%F_ACPRR) 
  SELF%F_ACPRR => NULL ()
  SELF%ACPRR => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_ACPRS)) THEN
  CALL DELETE_TEMPORARY (SELF%F_ACPRS) 
  SELF%F_ACPRS => NULL ()
  SELF%ACPRS => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_ACPRG)) THEN
  CALL DELETE_TEMPORARY (SELF%F_ACPRG) 
  SELF%F_ACPRG => NULL ()
  SELF%ACPRG => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_ALBDIR)) THEN
  CALL DELETE_TEMPORARY (SELF%F_ALBDIR) 
  SELF%F_ALBDIR => NULL ()
  SELF%ALBDIR => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_ALBSCA)) THEN
  CALL DELETE_TEMPORARY (SELF%F_ALBSCA) 
  SELF%F_ALBSCA => NULL ()
  SELF%ALBSCA => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_RAIN)) THEN
  CALL DELETE_TEMPORARY (SELF%F_RAIN) 
  SELF%F_RAIN => NULL ()
  SELF%RAIN => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_SNOW)) THEN
  CALL DELETE_TEMPORARY (SELF%F_SNOW) 
  SELF%F_SNOW => NULL ()
  SELF%SNOW => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_GZ0)) THEN
  CALL DELETE_TEMPORARY (SELF%F_GZ0) 
  SELF%F_GZ0 => NULL ()
  SELF%GZ0 => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_GZ0H)) THEN
  CALL DELETE_TEMPORARY (SELF%F_GZ0H) 
  SELF%F_GZ0H => NULL ()
  SELF%GZ0H => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_VQS)) THEN
  CALL DELETE_TEMPORARY (SELF%F_VQS) 
  SELF%F_VQS => NULL ()
  SELF%VQS => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_VTS)) THEN
  CALL DELETE_TEMPORARY (SELF%F_VTS) 
  SELF%F_VTS => NULL ()
  SELF%VTS => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_VEMIS)) THEN
  CALL DELETE_TEMPORARY (SELF%F_VEMIS) 
  SELF%F_VEMIS => NULL ()
  SELF%VEMIS => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_SWDIR)) THEN
  CALL DELETE_TEMPORARY (SELF%F_SWDIR) 
  SELF%F_SWDIR => NULL ()
  SELF%SWDIR => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_SWDIF)) THEN
  CALL DELETE_TEMPORARY (SELF%F_SWDIF) 
  SELF%F_SWDIF => NULL ()
  SELF%SWDIF => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_LSM)) THEN
  CALL DELETE_TEMPORARY (SELF%F_LSM) 
  SELF%F_LSM => NULL ()
  SELF%LSM => NULL ()
ENDIF
IF (ASSOCIATED (SELF%F_CD)) THEN
  CALL DELETE_TEMPORARY (SELF%F_CD) 
  SELF%F_CD => NULL ()
  SELF%CD => NULL ()
ENDIF

END SUBROUTINE CPG_GPAR_TYPE_FINAL




SUBROUTINE CPG_DYN_TYPE_INIT (SELF &
                                & , KT  &
                                & , REGISTRY &
                                & , NLEV &
                                & , PERSISTENT &
                           &, PHIF &
                           &, PREF &
                           &, PWRL &
                           &, PRCP &
                           &, PCTY &
                           &)

USE INTDYN_MOD, ONLY : YYTCTY0, YYTRCP0, YYTHW0, YYTXYB0, YYTXYB0_PHY, YYTXYBDER0
USE INTDYN_MOD, ONLY :          YYTRCP9, YYTHW9, YYTXYB9, YYTXYB9_PHY
USE INTDYN_MOD, ONLY : TRCP, TCTY, THWIND, TXYB, TXYBDER


USE YOMCT0    , ONLY : LNHDYN, LNHEE, LNHQE

CLASS (CPG_DYN_TYPE)                    :: SELF
INTEGER(KIND=JPIM),           INTENT (IN)    :: KT
TYPE (FIELD_REGISTRY),        INTENT (INOUT) :: REGISTRY
INTEGER (KIND=JPIM),          INTENT (IN)    :: NLEV
LOGICAL, OPTIONAL,            INTENT (IN)    :: PERSISTENT

REAL(KIND=JPRB),       INTENT (IN), OPTIONAL, TARGET  :: PHIF(:, :, :)
REAL(KIND=JPRB),       INTENT (IN), OPTIONAL, TARGET  :: PREF(:, :, :)
REAL(KIND=JPRB),       INTENT (IN), OPTIONAL, TARGET  :: PWRL(:, :, :)
REAL(KIND=JPRB),       INTENT (IN), OPTIONAL, TARGET  :: PRCP(:, :, :, :)
REAL(KIND=JPRB),       INTENT (IN), OPTIONAL, TARGET  :: PCTY(:, :, :, :)

LOGICAL :: LLT0

TYPE (TRCP)   , POINTER :: YLTRCP     
TYPE (TCTY)   , POINTER :: YLTCTY     
TYPE (THWIND) , POINTER :: YLTHW     
TYPE (TXYB)   , POINTER :: YLTXYB     
TYPE (TXYB)   , POINTER :: YLTXYB_PHY
TYPE (TXYBDER), POINTER :: YLTXYBDER

TYPE (TCTY),   TARGET :: YLTCTY0 
TYPE (THWIND), TARGET :: YLTHW0, YLTHW9 
TYPE (TRCP),   TARGET :: YLTRCP0, YLTRCP9 
TYPE (TXYB),   TARGET :: YLTXYB0, YLTXYB0_PHY, YLTXYB9, YLTXYB9_PHY
TYPE (TXYBDER),TARGET :: YLTXYBDER0

YLTCTY0     = YYTCTY0 
YLTHW0      = YYTHW0 
YLTHW9      = YYTHW9 
YLTRCP0     = YYTRCP0 
YLTRCP9     = YYTRCP9 
YLTXYB0     = YYTXYB0 
YLTXYB0_PHY = YYTXYB0_PHY 
YLTXYB9     = YYTXYB9 
YLTXYB9_PHY = YYTXYB9_PHY
YLTXYBDER0  = YYTXYBDER0

LLT0 = KT == 0

YLTRCP     => NULL ()
YLTCTY     => NULL ()
YLTHW      => NULL ()
YLTXYB     => NULL ()
YLTXYB_PHY => NULL ()
YLTXYBDER  => NULL ()

IF (KT == 0) THEN
  YLTRCP     => YLTRCP0
  YLTCTY     => YLTCTY0
  YLTHW      => YLTHW0
  YLTXYB     => YLTXYB0
  YLTXYB_PHY => YLTXYB0_PHY
  YLTXYBDER  => YLTXYBDER0
ELSEIF (KT == 9) THEN
  YLTRCP     => YLTRCP9
  YLTCTY     => NULL ()
  YLTHW      => YLTHW9
  YLTXYB     => YLTXYB9
  YLTXYB_PHY => YLTXYB9_PHY
ENDIF


IF (LLT0) THEN
  SELF%F_OROGL => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, PERSISTENT=PERSISTENT)
ENDIF

IF (LLT0) THEN
  SELF%F_OROGM => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, PERSISTENT=PERSISTENT)
ENDIF

SELF%F_PHI => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, NLEV=NLEV+1, NLEV0=0, PERSISTENT=PERSISTENT)

SELF%F_PRE => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, NLEV=NLEV+1, NLEV0=0, PERSISTENT=PERSISTENT)

IF (PRESENT (PHIF)) THEN
    SELF%F_PHIF => CREATE_FIELD_WRAP (PHIF, LBOUNDS=[1, 1, 1])
ELSE
  SELF%F_PHIF => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, NLEV=NLEV, NLEV0=1, PERSISTENT=PERSISTENT)
ENDIF

IF (PRESENT (PREF)) THEN
    SELF%F_PREF => CREATE_FIELD_WRAP (PREF, LBOUNDS=[1, 1, 1])
ELSE
  SELF%F_PREF => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, NLEV=NLEV, NLEV0=1, PERSISTENT=PERSISTENT)
ENDIF

IF (PRESENT (PWRL)) THEN
    SELF%F_WRL => CREATE_FIELD_WRAP (PWRL, LBOUNDS=[1, 1, 1])
ENDIF

SELF%F_PREL => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, PERSISTENT=PERSISTENT)

SELF%F_PREM => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, PERSISTENT=PERSISTENT)

SELF%F_NHY => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, NLEV=NLEV+1, NLEV0=0, PERSISTENT=PERSISTENT)

SELF%F_GWFT => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, NLEV=NLEV, NLEV0=1, PERSISTENT=PERSISTENT)

IF (LLT0) THEN
  SELF%F_KENE => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, NLEV=NLEV, NLEV0=1, PERSISTENT=PERSISTENT)
ENDIF

SELF%F_NHX => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, NLEV=NLEV, NLEV0=1, PERSISTENT=PERSISTENT)

IF (LLT0) THEN
  SELF%F_PHIFL => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, NLEV=NLEV, NLEV0=1, PERSISTENT=PERSISTENT)
ENDIF

IF (LLT0) THEN
  SELF%F_PHIFM => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, NLEV=NLEV, NLEV0=1, PERSISTENT=PERSISTENT)
ENDIF

IF (LLT0) THEN
  SELF%F_RTL => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, NLEV=NLEV, NLEV0=1, PERSISTENT=PERSISTENT)
ENDIF

IF (LLT0) THEN
  SELF%F_RTM => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, NLEV=NLEV, NLEV0=1, PERSISTENT=PERSISTENT)
ENDIF

CALL SELF%RCP%INIT (REGISTRY, NLEV, YLTRCP, PERSISTENT, PRCP)

IF (LLT0) THEN
  CALL SELF%CTY%INIT (REGISTRY, NLEV, YLTCTY, PERSISTENT, PCTY)
ENDIF

IF (LLT0) THEN
  CALL SELF%UVH%INIT (REGISTRY, NLEV, YLTHW, PERSISTENT)
ENDIF

CALL SELF%XYB%INIT (REGISTRY, NLEV, YLTXYB, PERSISTENT)

IF (LNHDYN .AND. LLT0) THEN
  SELF%F_DBBC => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, PERSISTENT=PERSISTENT)
ENDIF

IF (LNHDYN .AND. LLT0) THEN
  SELF%F_GWS => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, PERSISTENT=PERSISTENT)
ENDIF

IF (LNHDYN .AND. LLT0) THEN
  SELF%F_GWFL => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, NLEV=NLEV, NLEV0=1, PERSISTENT=PERSISTENT)
ENDIF

IF (LNHDYN .AND. LLT0) THEN
  SELF%F_GWFM => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, NLEV=NLEV, NLEV0=1, PERSISTENT=PERSISTENT)
ENDIF

IF (LNHDYN) THEN
  SELF%F_GWT => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, NLEV=NLEV, NLEV0=1, PERSISTENT=PERSISTENT)
ENDIF

IF (LNHDYN) THEN
  SELF%F_NHPREF => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, NLEV=NLEV, NLEV0=1, PERSISTENT=PERSISTENT)
ENDIF

IF (LNHDYN) THEN
  SELF%F_NHPREH => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, NLEV=NLEV+1, NLEV0=0, PERSISTENT=PERSISTENT)
ENDIF

IF (LNHDYN .AND. LLT0) THEN
  SELF%F_QCHAL => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, NLEV=NLEV, NLEV0=1, PERSISTENT=PERSISTENT)
ENDIF

IF (LNHDYN .AND. LLT0) THEN
  SELF%F_QCHAM => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, NLEV=NLEV, NLEV0=1, PERSISTENT=PERSISTENT)
ENDIF

IF (LNHDYN .AND. LLT0) THEN
  SELF%F_RDPHI => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, NLEV=NLEV, NLEV0=1, PERSISTENT=PERSISTENT)
ENDIF


END SUBROUTINE CPG_DYN_TYPE_INIT

SUBROUTINE CPG_DYN_TYPE_UPDATE_VIEW (SELF, BLOCK_INDEX)

CLASS (CPG_DYN_TYPE)         :: SELF
INTEGER(KIND=JPIM), INTENT (IN)   :: BLOCK_INDEX

IF (ASSOCIATED (SELF%F_OROGL)) THEN
  IF ((.NOT. SELF%F_OROGL%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%OROGL))) THEN
    SELF%OROGL  => SELF%F_OROGL%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%OROGL)) THEN
  SELF%OROGL  => ZDUM1
ENDIF
IF (ASSOCIATED (SELF%F_OROGM)) THEN
  IF ((.NOT. SELF%F_OROGM%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%OROGM))) THEN
    SELF%OROGM  => SELF%F_OROGM%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%OROGM)) THEN
  SELF%OROGM  => ZDUM1
ENDIF
IF (ASSOCIATED (SELF%F_PHI)) THEN
  IF ((.NOT. SELF%F_PHI%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%PHI))) THEN
    SELF%PHI  => SELF%F_PHI%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%PHI)) THEN
  SELF%PHI  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_PRE)) THEN
  IF ((.NOT. SELF%F_PRE%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%PRE))) THEN
    SELF%PRE  => SELF%F_PRE%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%PRE)) THEN
  SELF%PRE  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_PHIF)) THEN
  IF ((.NOT. SELF%F_PHIF%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%PHIF))) THEN
    SELF%PHIF  => SELF%F_PHIF%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%PHIF)) THEN
  SELF%PHIF  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_PREF)) THEN
  IF ((.NOT. SELF%F_PREF%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%PREF))) THEN
    SELF%PREF  => SELF%F_PREF%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%PREF)) THEN
  SELF%PREF  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_WRL)) THEN
  IF ((.NOT. SELF%F_WRL%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%WRL))) THEN
    SELF%WRL  => SELF%F_WRL%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%WRL)) THEN
  SELF%WRL  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_PREL)) THEN
  IF ((.NOT. SELF%F_PREL%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%PREL))) THEN
    SELF%PREL  => SELF%F_PREL%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%PREL)) THEN
  SELF%PREL  => ZDUM1
ENDIF
IF (ASSOCIATED (SELF%F_PREM)) THEN
  IF ((.NOT. SELF%F_PREM%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%PREM))) THEN
    SELF%PREM  => SELF%F_PREM%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%PREM)) THEN
  SELF%PREM  => ZDUM1
ENDIF
IF (ASSOCIATED (SELF%F_NHY)) THEN
  IF ((.NOT. SELF%F_NHY%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%NHY))) THEN
    SELF%NHY  => SELF%F_NHY%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%NHY)) THEN
  SELF%NHY  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_GWFT)) THEN
  IF ((.NOT. SELF%F_GWFT%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%GWFT))) THEN
    SELF%GWFT  => SELF%F_GWFT%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%GWFT)) THEN
  SELF%GWFT  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_KENE)) THEN
  IF ((.NOT. SELF%F_KENE%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%KENE))) THEN
    SELF%KENE  => SELF%F_KENE%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%KENE)) THEN
  SELF%KENE  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_NHX)) THEN
  IF ((.NOT. SELF%F_NHX%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%NHX))) THEN
    SELF%NHX  => SELF%F_NHX%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%NHX)) THEN
  SELF%NHX  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_PHIFL)) THEN
  IF ((.NOT. SELF%F_PHIFL%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%PHIFL))) THEN
    SELF%PHIFL  => SELF%F_PHIFL%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%PHIFL)) THEN
  SELF%PHIFL  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_PHIFM)) THEN
  IF ((.NOT. SELF%F_PHIFM%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%PHIFM))) THEN
    SELF%PHIFM  => SELF%F_PHIFM%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%PHIFM)) THEN
  SELF%PHIFM  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_RTL)) THEN
  IF ((.NOT. SELF%F_RTL%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%RTL))) THEN
    SELF%RTL  => SELF%F_RTL%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%RTL)) THEN
  SELF%RTL  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_RTM)) THEN
  IF ((.NOT. SELF%F_RTM%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%RTM))) THEN
    SELF%RTM  => SELF%F_RTM%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%RTM)) THEN
  SELF%RTM  => ZDUM2
ENDIF
CALL SELF%RCP%UPDATE_VIEW (BLOCK_INDEX)
CALL SELF%CTY%UPDATE_VIEW (BLOCK_INDEX)
CALL SELF%UVH%UPDATE_VIEW (BLOCK_INDEX)
CALL SELF%XYB%UPDATE_VIEW (BLOCK_INDEX)
IF (ASSOCIATED (SELF%F_DBBC)) THEN
  IF ((.NOT. SELF%F_DBBC%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DBBC))) THEN
    SELF%DBBC  => SELF%F_DBBC%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%DBBC)) THEN
  SELF%DBBC  => ZDUM1
ENDIF
IF (ASSOCIATED (SELF%F_GWS)) THEN
  IF ((.NOT. SELF%F_GWS%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%GWS))) THEN
    SELF%GWS  => SELF%F_GWS%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%GWS)) THEN
  SELF%GWS  => ZDUM1
ENDIF
IF (ASSOCIATED (SELF%F_GWFL)) THEN
  IF ((.NOT. SELF%F_GWFL%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%GWFL))) THEN
    SELF%GWFL  => SELF%F_GWFL%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%GWFL)) THEN
  SELF%GWFL  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_GWFM)) THEN
  IF ((.NOT. SELF%F_GWFM%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%GWFM))) THEN
    SELF%GWFM  => SELF%F_GWFM%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%GWFM)) THEN
  SELF%GWFM  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_GWT)) THEN
  IF ((.NOT. SELF%F_GWT%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%GWT))) THEN
    SELF%GWT  => SELF%F_GWT%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%GWT)) THEN
  SELF%GWT  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_NHPREF)) THEN
  IF ((.NOT. SELF%F_NHPREF%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%NHPREF))) THEN
    SELF%NHPREF  => SELF%F_NHPREF%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%NHPREF)) THEN
  SELF%NHPREF  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_NHPREH)) THEN
  IF ((.NOT. SELF%F_NHPREH%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%NHPREH))) THEN
    SELF%NHPREH  => SELF%F_NHPREH%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%NHPREH)) THEN
  SELF%NHPREH  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_QCHAL)) THEN
  IF ((.NOT. SELF%F_QCHAL%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%QCHAL))) THEN
    SELF%QCHAL  => SELF%F_QCHAL%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%QCHAL)) THEN
  SELF%QCHAL  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_QCHAM)) THEN
  IF ((.NOT. SELF%F_QCHAM%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%QCHAM))) THEN
    SELF%QCHAM  => SELF%F_QCHAM%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%QCHAM)) THEN
  SELF%QCHAM  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_RDPHI)) THEN
  IF ((.NOT. SELF%F_RDPHI%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%RDPHI))) THEN
    SELF%RDPHI  => SELF%F_RDPHI%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%RDPHI)) THEN
  SELF%RDPHI  => ZDUM2
ENDIF

END SUBROUTINE CPG_DYN_TYPE_UPDATE_VIEW

SUBROUTINE CPG_DYN_TYPE_FINAL (SELF)
CLASS (CPG_DYN_TYPE)         :: SELF

IF (ASSOCIATED (SELF%F_OROGL)) CALL DELETE_TEMPORARY (SELF%F_OROGL) 
IF (ASSOCIATED (SELF%F_OROGM)) CALL DELETE_TEMPORARY (SELF%F_OROGM) 
IF (ASSOCIATED (SELF%F_PHI)) CALL DELETE_TEMPORARY (SELF%F_PHI) 
IF (ASSOCIATED (SELF%F_PRE)) CALL DELETE_TEMPORARY (SELF%F_PRE) 
IF (ASSOCIATED (SELF%F_PHIF)) CALL DELETE_TEMPORARY (SELF%F_PHIF) 
IF (ASSOCIATED (SELF%F_PREF)) CALL DELETE_TEMPORARY (SELF%F_PREF) 
IF (ASSOCIATED (SELF%F_WRL)) CALL DELETE_TEMPORARY (SELF%F_WRL) 
IF (ASSOCIATED (SELF%F_PREL)) CALL DELETE_TEMPORARY (SELF%F_PREL) 
IF (ASSOCIATED (SELF%F_PREM)) CALL DELETE_TEMPORARY (SELF%F_PREM) 
IF (ASSOCIATED (SELF%F_NHY)) CALL DELETE_TEMPORARY (SELF%F_NHY) 
IF (ASSOCIATED (SELF%F_GWFT)) CALL DELETE_TEMPORARY (SELF%F_GWFT) 
IF (ASSOCIATED (SELF%F_KENE)) CALL DELETE_TEMPORARY (SELF%F_KENE) 
IF (ASSOCIATED (SELF%F_NHX)) CALL DELETE_TEMPORARY (SELF%F_NHX) 
IF (ASSOCIATED (SELF%F_PHIFL)) CALL DELETE_TEMPORARY (SELF%F_PHIFL) 
IF (ASSOCIATED (SELF%F_PHIFM)) CALL DELETE_TEMPORARY (SELF%F_PHIFM) 
IF (ASSOCIATED (SELF%F_RTL)) CALL DELETE_TEMPORARY (SELF%F_RTL) 
IF (ASSOCIATED (SELF%F_RTM)) CALL DELETE_TEMPORARY (SELF%F_RTM) 
CALL SELF%RCP%FINAL ()
CALL SELF%CTY%FINAL ()
CALL SELF%UVH%FINAL ()
CALL SELF%XYB%FINAL ()
IF (ASSOCIATED (SELF%F_DBBC)) CALL DELETE_TEMPORARY (SELF%F_DBBC) 
IF (ASSOCIATED (SELF%F_GWS)) CALL DELETE_TEMPORARY (SELF%F_GWS) 
IF (ASSOCIATED (SELF%F_GWFL)) CALL DELETE_TEMPORARY (SELF%F_GWFL) 
IF (ASSOCIATED (SELF%F_GWFM)) CALL DELETE_TEMPORARY (SELF%F_GWFM) 
IF (ASSOCIATED (SELF%F_GWT)) CALL DELETE_TEMPORARY (SELF%F_GWT) 
IF (ASSOCIATED (SELF%F_NHPREF)) CALL DELETE_TEMPORARY (SELF%F_NHPREF) 
IF (ASSOCIATED (SELF%F_NHPREH)) CALL DELETE_TEMPORARY (SELF%F_NHPREH) 
IF (ASSOCIATED (SELF%F_QCHAL)) CALL DELETE_TEMPORARY (SELF%F_QCHAL) 
IF (ASSOCIATED (SELF%F_QCHAM)) CALL DELETE_TEMPORARY (SELF%F_QCHAM) 
IF (ASSOCIATED (SELF%F_RDPHI)) CALL DELETE_TEMPORARY (SELF%F_RDPHI) 

END SUBROUTINE CPG_DYN_TYPE_FINAL




SUBROUTINE CPG_PHY_TYPE_INIT (SELF &
                                & , KT  &
                                & , REGISTRY &
                                & , NLEV &
                                & , PERSISTENT &
                                & , LDMF_PHYS &
                           &)

USE INTDYN_MOD, ONLY : YYTCTY0, YYTRCP0, YYTHW0, YYTXYB0, YYTXYB0_PHY, YYTXYBDER0
USE INTDYN_MOD, ONLY :          YYTRCP9, YYTHW9, YYTXYB9, YYTXYB9_PHY
USE INTDYN_MOD, ONLY : TRCP, TCTY, THWIND, TXYB, TXYBDER



CLASS (CPG_PHY_TYPE)                    :: SELF
INTEGER(KIND=JPIM),           INTENT (IN)    :: KT
TYPE (FIELD_REGISTRY),        INTENT (INOUT) :: REGISTRY
INTEGER (KIND=JPIM),          INTENT (IN)    :: NLEV
LOGICAL, OPTIONAL,            INTENT (IN)    :: PERSISTENT
LOGICAL, OPTIONAL,            INTENT (IN)    :: LDMF_PHYS


LOGICAL :: LLT0
LOGICAL :: LLMF_PHYS

TYPE (TRCP)   , POINTER :: YLTRCP     
TYPE (TCTY)   , POINTER :: YLTCTY     
TYPE (THWIND) , POINTER :: YLTHW     
TYPE (TXYB)   , POINTER :: YLTXYB     
TYPE (TXYB)   , POINTER :: YLTXYB_PHY
TYPE (TXYBDER), POINTER :: YLTXYBDER

TYPE (TCTY),   TARGET :: YLTCTY0 
TYPE (THWIND), TARGET :: YLTHW0, YLTHW9 
TYPE (TRCP),   TARGET :: YLTRCP0, YLTRCP9 
TYPE (TXYB),   TARGET :: YLTXYB0, YLTXYB0_PHY, YLTXYB9, YLTXYB9_PHY
TYPE (TXYBDER),TARGET :: YLTXYBDER0

YLTCTY0     = YYTCTY0 
YLTHW0      = YYTHW0 
YLTHW9      = YYTHW9 
YLTRCP0     = YYTRCP0 
YLTRCP9     = YYTRCP9 
YLTXYB0     = YYTXYB0 
YLTXYB0_PHY = YYTXYB0_PHY 
YLTXYB9     = YYTXYB9 
YLTXYB9_PHY = YYTXYB9_PHY
YLTXYBDER0  = YYTXYBDER0

LLT0 = KT == 0

YLTRCP     => NULL ()
YLTCTY     => NULL ()
YLTHW      => NULL ()
YLTXYB     => NULL ()
YLTXYB_PHY => NULL ()
YLTXYBDER  => NULL ()

IF (KT == 0) THEN
  YLTRCP     => YLTRCP0
  YLTCTY     => YLTCTY0
  YLTHW      => YLTHW0
  YLTXYB     => YLTXYB0
  YLTXYB_PHY => YLTXYB0_PHY
  YLTXYBDER  => YLTXYBDER0
ELSEIF (KT == 9) THEN
  YLTRCP     => YLTRCP9
  YLTCTY     => NULL ()
  YLTHW      => YLTHW9
  YLTXYB     => YLTXYB9
  YLTXYB_PHY => YLTXYB9_PHY
ENDIF

LLMF_PHYS = .FALSE.
IF (PRESENT (LDMF_PHYS)) THEN
  LLMF_PHYS = LDMF_PHYS
ENDIF

IF (LLMF_PHYS) THEN
  SELF%F_PRE => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, NLEV=NLEV+1, NLEV0=0, PERSISTENT=PERSISTENT)
ENDIF

IF (LLMF_PHYS) THEN
  SELF%F_PREF => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, NLEV=NLEV, NLEV0=1, PERSISTENT=PERSISTENT)
ENDIF

IF (LLMF_PHYS) THEN
  SELF%F_PREHYD => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, NLEV=NLEV+1, NLEV0=0, PERSISTENT=PERSISTENT)
ENDIF

IF (LLMF_PHYS) THEN
  SELF%F_PREHYDF => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, NLEV=NLEV, NLEV0=1, PERSISTENT=PERSISTENT)
ENDIF

IF (LLMF_PHYS) THEN
  SELF%F_WL => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, NLEV=NLEV, NLEV0=1, PERSISTENT=PERSISTENT)
ENDIF

IF (LLMF_PHYS) THEN
  SELF%F_WM => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, NLEV=NLEV, NLEV0=1, PERSISTENT=PERSISTENT)
ENDIF

IF (LLMF_PHYS) THEN
  SELF%F_W => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, NLEV=NLEV, NLEV0=1, PERSISTENT=PERSISTENT)
ENDIF

IF (LLMF_PHYS) THEN
  CALL SELF%XYB%INIT (REGISTRY, NLEV, YLTXYB_PHY, PERSISTENT)
ENDIF


END SUBROUTINE CPG_PHY_TYPE_INIT

SUBROUTINE CPG_PHY_TYPE_UPDATE_VIEW (SELF, BLOCK_INDEX)

CLASS (CPG_PHY_TYPE)         :: SELF
INTEGER(KIND=JPIM), INTENT (IN)   :: BLOCK_INDEX

IF (ASSOCIATED (SELF%F_PRE)) THEN
  IF ((.NOT. SELF%F_PRE%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%PRE))) THEN
    SELF%PRE  => SELF%F_PRE%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%PRE)) THEN
  SELF%PRE  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_PREF)) THEN
  IF ((.NOT. SELF%F_PREF%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%PREF))) THEN
    SELF%PREF  => SELF%F_PREF%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%PREF)) THEN
  SELF%PREF  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_PREHYD)) THEN
  IF ((.NOT. SELF%F_PREHYD%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%PREHYD))) THEN
    SELF%PREHYD  => SELF%F_PREHYD%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%PREHYD)) THEN
  SELF%PREHYD  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_PREHYDF)) THEN
  IF ((.NOT. SELF%F_PREHYDF%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%PREHYDF))) THEN
    SELF%PREHYDF  => SELF%F_PREHYDF%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%PREHYDF)) THEN
  SELF%PREHYDF  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_WL)) THEN
  IF ((.NOT. SELF%F_WL%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%WL))) THEN
    SELF%WL  => SELF%F_WL%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%WL)) THEN
  SELF%WL  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_WM)) THEN
  IF ((.NOT. SELF%F_WM%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%WM))) THEN
    SELF%WM  => SELF%F_WM%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%WM)) THEN
  SELF%WM  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_W)) THEN
  IF ((.NOT. SELF%F_W%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%W))) THEN
    SELF%W  => SELF%F_W%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%W)) THEN
  SELF%W  => ZDUM2
ENDIF
CALL SELF%XYB%UPDATE_VIEW (BLOCK_INDEX)

END SUBROUTINE CPG_PHY_TYPE_UPDATE_VIEW

SUBROUTINE CPG_PHY_TYPE_FINAL (SELF)
CLASS (CPG_PHY_TYPE)         :: SELF

IF (ASSOCIATED (SELF%F_PRE)) CALL DELETE_TEMPORARY (SELF%F_PRE) 
IF (ASSOCIATED (SELF%F_PREF)) CALL DELETE_TEMPORARY (SELF%F_PREF) 
IF (ASSOCIATED (SELF%F_PREHYD)) CALL DELETE_TEMPORARY (SELF%F_PREHYD) 
IF (ASSOCIATED (SELF%F_PREHYDF)) CALL DELETE_TEMPORARY (SELF%F_PREHYDF) 
IF (ASSOCIATED (SELF%F_WL)) CALL DELETE_TEMPORARY (SELF%F_WL) 
IF (ASSOCIATED (SELF%F_WM)) CALL DELETE_TEMPORARY (SELF%F_WM) 
IF (ASSOCIATED (SELF%F_W)) CALL DELETE_TEMPORARY (SELF%F_W) 
CALL SELF%XYB%FINAL ()

END SUBROUTINE CPG_PHY_TYPE_FINAL




SUBROUTINE CPG_MISC_TYPE_INIT (SELF &
                                & , REGISTRY &
                                & , YDCPG_OPTS &
                                & , PERSISTENT &
                           &)


USE CPG_OPTS_TYPE_MOD, ONLY : CPG_OPTS_TYPE


CLASS (CPG_MISC_TYPE)                    :: SELF
TYPE (FIELD_REGISTRY),        INTENT (INOUT) :: REGISTRY
TYPE (CPG_OPTS_TYPE),         INTENT (IN)    :: YDCPG_OPTS
LOGICAL, OPTIONAL,            INTENT (IN)    :: PERSISTENT







SELF%F_NEB => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, NLEV=YDCPG_OPTS%KFLEVG, NLEV0=1, PERSISTENT=PERSISTENT)

SELF%F_QLI => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, NLEV=YDCPG_OPTS%KFLEVG, NLEV0=1, PERSISTENT=PERSISTENT)

SELF%F_QICE => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, NLEV=YDCPG_OPTS%KFLEVG, NLEV0=1, PERSISTENT=PERSISTENT)

SELF%F_QRAIN => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, NLEV=YDCPG_OPTS%KFLEVG, NLEV0=1, PERSISTENT=PERSISTENT)

SELF%F_QSNOW => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, NLEV=YDCPG_OPTS%KFLEVG, NLEV0=1, PERSISTENT=PERSISTENT)

SELF%F_QGRAUPEL => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, NLEV=YDCPG_OPTS%KFLEVG, NLEV0=1, PERSISTENT=PERSISTENT)

SELF%F_RH => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, NLEV=YDCPG_OPTS%KFLEVG, NLEV0=1, PERSISTENT=PERSISTENT)

SELF%F_QS => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, PERSISTENT=PERSISTENT)

SELF%F_QSOL => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, PERSISTENT=PERSISTENT)

SELF%F_DHSF => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, PERSISTENT=PERSISTENT)

SELF%F_CLCT => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, PERSISTENT=PERSISTENT)

SELF%F_LSM => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, PERSISTENT=PERSISTENT)

SELF%F_TSOL => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, PERSISTENT=PERSISTENT)

SELF%F_FTCNS => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, NLEV=YDCPG_OPTS%KFLEVG+1, NLEV0=0, NDIM=6, NDIM0=1, PERSISTENT=PERSISTENT)

SELF%F_KOZO => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, NLEV=YDCPG_OPTS%KFLEVG, NLEV0=1, NDIM=YDCPG_OPTS%KVCLIS, NDIM0=1,&
    & PERSISTENT=PERSISTENT)


END SUBROUTINE CPG_MISC_TYPE_INIT

SUBROUTINE CPG_MISC_TYPE_UPDATE_VIEW (SELF, BLOCK_INDEX)

CLASS (CPG_MISC_TYPE)         :: SELF
INTEGER(KIND=JPIM), INTENT (IN)   :: BLOCK_INDEX

IF (ASSOCIATED (SELF%F_NEB)) THEN
  IF ((.NOT. SELF%F_NEB%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%NEB))) THEN
    SELF%NEB  => SELF%F_NEB%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%NEB)) THEN
  SELF%NEB  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_QLI)) THEN
  IF ((.NOT. SELF%F_QLI%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%QLI))) THEN
    SELF%QLI  => SELF%F_QLI%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%QLI)) THEN
  SELF%QLI  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_QICE)) THEN
  IF ((.NOT. SELF%F_QICE%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%QICE))) THEN
    SELF%QICE  => SELF%F_QICE%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%QICE)) THEN
  SELF%QICE  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_QRAIN)) THEN
  IF ((.NOT. SELF%F_QRAIN%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%QRAIN))) THEN
    SELF%QRAIN  => SELF%F_QRAIN%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%QRAIN)) THEN
  SELF%QRAIN  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_QSNOW)) THEN
  IF ((.NOT. SELF%F_QSNOW%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%QSNOW))) THEN
    SELF%QSNOW  => SELF%F_QSNOW%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%QSNOW)) THEN
  SELF%QSNOW  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_QGRAUPEL)) THEN
  IF ((.NOT. SELF%F_QGRAUPEL%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%QGRAUPEL))) THEN
    SELF%QGRAUPEL  => SELF%F_QGRAUPEL%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%QGRAUPEL)) THEN
  SELF%QGRAUPEL  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_RH)) THEN
  IF ((.NOT. SELF%F_RH%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%RH))) THEN
    SELF%RH  => SELF%F_RH%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%RH)) THEN
  SELF%RH  => ZDUM2
ENDIF
IF (ASSOCIATED (SELF%F_QS)) THEN
  IF ((.NOT. SELF%F_QS%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%QS))) THEN
    SELF%QS  => SELF%F_QS%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%QS)) THEN
  SELF%QS  => ZDUM1
ENDIF
IF (ASSOCIATED (SELF%F_QSOL)) THEN
  IF ((.NOT. SELF%F_QSOL%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%QSOL))) THEN
    SELF%QSOL  => SELF%F_QSOL%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%QSOL)) THEN
  SELF%QSOL  => ZDUM1
ENDIF
IF (ASSOCIATED (SELF%F_DHSF)) THEN
  IF ((.NOT. SELF%F_DHSF%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DHSF))) THEN
    SELF%DHSF  => SELF%F_DHSF%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%DHSF)) THEN
  SELF%DHSF  => ZDUM1
ENDIF
IF (ASSOCIATED (SELF%F_CLCT)) THEN
  IF ((.NOT. SELF%F_CLCT%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%CLCT))) THEN
    SELF%CLCT  => SELF%F_CLCT%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%CLCT)) THEN
  SELF%CLCT  => ZDUM1
ENDIF
IF (ASSOCIATED (SELF%F_LSM)) THEN
  IF ((.NOT. SELF%F_LSM%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%LSM))) THEN
    SELF%LSM  => SELF%F_LSM%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%LSM)) THEN
  SELF%LSM  => ZDUM1
ENDIF
IF (ASSOCIATED (SELF%F_TSOL)) THEN
  IF ((.NOT. SELF%F_TSOL%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%TSOL))) THEN
    SELF%TSOL  => SELF%F_TSOL%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%TSOL)) THEN
  SELF%TSOL  => ZDUM1
ENDIF
IF (ASSOCIATED (SELF%F_FTCNS)) THEN
  IF ((.NOT. SELF%F_FTCNS%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%FTCNS))) THEN
    SELF%FTCNS  => SELF%F_FTCNS%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%FTCNS)) THEN
  SELF%FTCNS  => ZDUM3
ENDIF
IF (ASSOCIATED (SELF%F_KOZO)) THEN
  IF ((.NOT. SELF%F_KOZO%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%KOZO))) THEN
    SELF%KOZO  => SELF%F_KOZO%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (SELF%KOZO)) THEN
  SELF%KOZO  => ZDUM3
ENDIF

END SUBROUTINE CPG_MISC_TYPE_UPDATE_VIEW

SUBROUTINE CPG_MISC_TYPE_FINAL (SELF)
CLASS (CPG_MISC_TYPE)         :: SELF

IF (ASSOCIATED (SELF%F_NEB)) CALL DELETE_TEMPORARY (SELF%F_NEB) 
IF (ASSOCIATED (SELF%F_QLI)) CALL DELETE_TEMPORARY (SELF%F_QLI) 
IF (ASSOCIATED (SELF%F_QICE)) CALL DELETE_TEMPORARY (SELF%F_QICE) 
IF (ASSOCIATED (SELF%F_QRAIN)) CALL DELETE_TEMPORARY (SELF%F_QRAIN) 
IF (ASSOCIATED (SELF%F_QSNOW)) CALL DELETE_TEMPORARY (SELF%F_QSNOW) 
IF (ASSOCIATED (SELF%F_QGRAUPEL)) CALL DELETE_TEMPORARY (SELF%F_QGRAUPEL) 
IF (ASSOCIATED (SELF%F_RH)) CALL DELETE_TEMPORARY (SELF%F_RH) 
IF (ASSOCIATED (SELF%F_QS)) CALL DELETE_TEMPORARY (SELF%F_QS) 
IF (ASSOCIATED (SELF%F_QSOL)) CALL DELETE_TEMPORARY (SELF%F_QSOL) 
IF (ASSOCIATED (SELF%F_DHSF)) CALL DELETE_TEMPORARY (SELF%F_DHSF) 
IF (ASSOCIATED (SELF%F_CLCT)) CALL DELETE_TEMPORARY (SELF%F_CLCT) 
IF (ASSOCIATED (SELF%F_LSM)) CALL DELETE_TEMPORARY (SELF%F_LSM) 
IF (ASSOCIATED (SELF%F_TSOL)) CALL DELETE_TEMPORARY (SELF%F_TSOL) 
IF (ASSOCIATED (SELF%F_FTCNS)) CALL DELETE_TEMPORARY (SELF%F_FTCNS) 
IF (ASSOCIATED (SELF%F_KOZO)) CALL DELETE_TEMPORARY (SELF%F_KOZO) 

END SUBROUTINE CPG_MISC_TYPE_FINAL

SUBROUTINE CPG_DDH_TYPE_INIT (SELF, REGISTRY, NLEV, PERSISTENT, YDMODEL, YDDDH)

USE TYPE_MODEL, ONLY : MODEL
USE DDH_MIX, ONLY : TYP_DDH

CLASS (CPG_DDH_TYPE)                             :: SELF
TYPE (FIELD_REGISTRY),            INTENT (INOUT) :: REGISTRY
INTEGER (KIND=JPIM),              INTENT (IN)    :: NLEV
LOGICAL, OPTIONAL,                INTENT (IN)    :: PERSISTENT
TYPE (MODEL),                     INTENT (IN)    :: YDMODEL
TYPE (TYP_DDH),                   INTENT (IN)    :: YDDDH


ALLOCATE (SELF%F_AUX3D)
SELF%F_AUX3D = FIELD_4D (SHAPE=[NLEV+1, YDMODEL%YRML_DIAG%YRMDDH%NDHIDH, YDDDH%NFIELDS3D_AUTO], &
                       & NBLOCKS=REGISTRY%GEOM%YRDIM%NGPBLKS, PERSISTENT=PERSISTENT)
ALLOCATE (SELF%F_AUX2D)
SELF%F_AUX2D = FIELD_3D (SHAPE=[YDMODEL%YRML_DIAG%YRMDDH%NDHIDH, YDDDH%NFIELDS2D_AUTO], &
                       & NBLOCKS=REGISTRY%GEOM%YRDIM%NGPBLKS, PERSISTENT=PERSISTENT)

SELF%F_DHCV  => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, NLEV=NLEV+1, PERSISTENT=PERSISTENT, NDIM=YDMODEL%YRML_DIAG%YRMDDH%NDHCVSUN)
SELF%F_AUXSM => CREATE_TEMPORARY (GEOM=REGISTRY%GEOM, NLEV=1, PERSISTENT=PERSISTENT, NDIM=NLEV, NDIM2=13)
SELF%F_DDHI  => CREATE_TEMPORARY_INT (GEOM=REGISTRY%GEOM, PERSISTENT=PERSISTENT)

END SUBROUTINE CPG_DDH_TYPE_INIT

SUBROUTINE CPG_DDH_TYPE_UPDATE_VIEW (SELF, BLOCK_INDEX)

CLASS (CPG_DDH_TYPE)              :: SELF
INTEGER(KIND=JPIM), INTENT (IN)   :: BLOCK_INDEX

IF (ASSOCIATED (SELF%F_AUX3D)) SELF%AUX3D (0:, 1:, 1:)  => SELF%F_AUX3D%GET_VIEW (BLOCK_INDEX)
IF (ASSOCIATED (SELF%F_AUX2D)) SELF%AUX2D               => SELF%F_AUX2D%GET_VIEW (BLOCK_INDEX)
IF (ASSOCIATED (SELF%F_DHCV )) SELF%DHCV  (1:, 0:, 1:)  => SELF%F_DHCV %GET_VIEW (BLOCK_INDEX)
IF (ASSOCIATED (SELF%F_AUXSM)) SELF%AUXSM               => SELF%F_AUXSM%GET_VIEW (BLOCK_INDEX)
IF (ASSOCIATED (SELF%F_DDHI )) SELF%DDHI                => SELF%F_DDHI %GET_VIEW (BLOCK_INDEX)

END SUBROUTINE CPG_DDH_TYPE_UPDATE_VIEW

SUBROUTINE CPG_DDH_TYPE_FINAL (SELF)

CLASS (CPG_DDH_TYPE)              :: SELF

CALL DELETE_TEMPORARY (SELF%F_AUX3D)
CALL DELETE_TEMPORARY (SELF%F_AUX2D)
CALL DELETE_TEMPORARY (SELF%F_DHCV)
CALL DELETE_TEMPORARY (SELF%F_AUXSM)
CALL DELETE_TEMPORARY (SELF%F_DDHI)

SELF%AUX3D => NULL ()
SELF%AUX2D => NULL ()
SELF%DHCV  => NULL ()
SELF%AUXSM => NULL ()
SELF%DDHI  => NULL ()

END SUBROUTINE CPG_DDH_TYPE_FINAL



SUBROUTINE CPG_SL1_TYPE_INIT (SELF, REGISTRY, NLEV, YDTPTRSLB1 &
                                & , YDMODEL &
                                & , YGFL &
                                & , PERSISTENT, PB1)

USE PTRSLB1, ONLY : TPTRSLB1
USE OML_MOD, ONLY: OML_MAX_THREADS

USE YOM_YGFL, ONLY: TYPE_GFLD
USE TYPE_MODEL, ONLY : MODEL

CLASS (CPG_SL1_TYPE)                         :: SELF
TYPE (FIELD_REGISTRY),              INTENT (INOUT) :: REGISTRY
INTEGER (KIND=JPIM),                INTENT (IN)    :: NLEV
TYPE (TPTRSLB1),              INTENT (IN)    :: YDTPTRSLB1
TYPE (TYPE_GFLD),                   INTENT (IN)    :: YGFL
TYPE (MODEL),                       INTENT (IN)    :: YDMODEL
LOGICAL, OPTIONAL,                  INTENT (IN)    :: PERSISTENT
REAL (KIND=JPRB), OPTIONAL, TARGET, INTENT (IN)    :: PB1 (:, :, :)

INTEGER (KIND=JPIM) :: JFLD
INTEGER (KIND=JPIM) :: JGFL
INTEGER (KIND=JPIM) :: ISLB1GFL9

LOGICAL :: LLPERSISTENT

LLPERSISTENT = .FALSE.
IF (PRESENT (PERSISTENT)) LLPERSISTENT = PERSISTENT

SELF%NLEV = NLEV

IF (PRESENT (PB1)) THEN
  SELF%ZDATA => PB1
  SELF%LOWNED = .FALSE.
  LLPERSISTENT = .TRUE.
ELSEIF (LLPERSISTENT) THEN
  ALLOCATE (SELF%ZDATA (REGISTRY%GEOM%YRDIM%NPROMA, YDTPTRSLB1%NFLDSLB1, REGISTRY%GEOM%YRDIM%NGPBLKS))
  SELF%LOWNED = .TRUE.
ELSE
  ALLOCATE (SELF%ZDATA (REGISTRY%GEOM%YRDIM%NPROMA, YDTPTRSLB1%NFLDSLB1, OML_MAX_THREADS ()))
  SELF%LOWNED = .TRUE.
ENDIF

SELF%F_DATA => CREATE_FIELD_WRAP (SELF%ZDATA, PERSISTENT=LLPERSISTENT)

IF (YDMODEL%YRML_DYN%YRDYN%LSPLTHOIGFL .OR. (YDMODEL%YRML_DYN%YRDYN%NSPLTHOI /= 0)) THEN
  ISLB1GFL9 = YDTPTRSLB1%MSLB1GFLF9
ELSE
  ISLB1GFL9 = YDTPTRSLB1%MSLB1GFL9
ENDIF  


IF (YDTPTRSLB1%MSLB1U9 > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1U9
  SELF%U9%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  SELF%U9%F_P => NULL ()
ENDIF
IF (YDTPTRSLB1%MSLB1V9 > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1V9
  SELF%V9%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  SELF%V9%F_P => NULL ()
ENDIF
IF (YDTPTRSLB1%MSLB1T9 > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1T9
  SELF%T9%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  SELF%T9%F_P => NULL ()
ENDIF
IF (YDTPTRSLB1%MSLB1PD9 > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1PD9
  SELF%PD9%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  SELF%PD9%F_P => NULL ()
ENDIF
IF (YDTPTRSLB1%MSLB1VD9 > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1VD9
  SELF%VD9%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  SELF%VD9%F_P => NULL ()
ENDIF
IF (YDTPTRSLB1%MSLB1NHX9 > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1NHX9
  SELF%NHX9%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  SELF%NHX9%F_P => NULL ()
ENDIF
IF (YDTPTRSLB1%MSLB1UR0 > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1UR0
  SELF%UR0%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  SELF%UR0%F_P => NULL ()
ENDIF
IF (YDTPTRSLB1%MSLB1VR0 > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1VR0
  SELF%VR0%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  SELF%VR0%F_P => NULL ()
ENDIF
IF (YDTPTRSLB1%MSLB1ZR0 > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1ZR0
  SELF%ZR0%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  SELF%ZR0%F_P => NULL ()
ENDIF
IF (YDTPTRSLB1%MSLB1WR0 > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1WR0
  SELF%WR0%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  SELF%WR0%F_P => NULL ()
ENDIF
IF (YDTPTRSLB1%MSLB1UR00 > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1UR00
  SELF%UR00%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  SELF%UR00%F_P => NULL ()
ENDIF
IF (YDTPTRSLB1%MSLB1VR00 > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1VR00
  SELF%VR00%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  SELF%VR00%F_P => NULL ()
ENDIF
IF (YDTPTRSLB1%MSLB1ZR00 > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1ZR00
  SELF%ZR00%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  SELF%ZR00%F_P => NULL ()
ENDIF
IF (YDTPTRSLB1%MSLB1WR00 > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1WR00
  SELF%WR00%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  SELF%WR00%F_P => NULL ()
ENDIF
IF (YDTPTRSLB1%MSLB1WRA > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1WRA
  SELF%WRA%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  SELF%WRA%F_P => NULL ()
ENDIF
IF (YDTPTRSLB1%MSLB1UR9 > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1UR9
  SELF%UR9%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  SELF%UR9%F_P => NULL ()
ENDIF
IF (YDTPTRSLB1%MSLB1VR9 > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1VR9
  SELF%VR9%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  SELF%VR9%F_P => NULL ()
ENDIF
IF (YDTPTRSLB1%MSLB1DBBC9 > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1DBBC9
  SELF%DBBC9%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  SELF%DBBC9%F_P => NULL ()
ENDIF
IF (YDTPTRSLB1%MSLB1DPHI9 > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1DPHI9
  SELF%DPHI9%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  SELF%DPHI9%F_P => NULL ()
ENDIF
IF (YDTPTRSLB1%MSLB1GWS9 > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1GWS9
  SELF%GWS9%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%GWS9%F_P => NULL ()
ENDIF
IF (YDTPTRSLB1%MSLB1U0 > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1U0
  SELF%U0%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  SELF%U0%F_P => NULL ()
ENDIF
IF (YDTPTRSLB1%MSLB1V0 > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1V0
  SELF%V0%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  SELF%V0%F_P => NULL ()
ENDIF
IF (YDTPTRSLB1%MSLB1T0 > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1T0
  SELF%T0%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  SELF%T0%F_P => NULL ()
ENDIF
IF (YDTPTRSLB1%MSLB1PD0 > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1PD0
  SELF%PD0%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  SELF%PD0%F_P => NULL ()
ENDIF
IF (YDTPTRSLB1%MSLB1VD0 > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1VD0
  SELF%VD0%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  SELF%VD0%F_P => NULL ()
ENDIF
IF (YDTPTRSLB1%MSLB1C9 > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1C9
  SELF%C9%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  SELF%C9%F_P => NULL ()
ENDIF
IF (YDTPTRSLB1%MSLB1SP9 > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1SP9
  SELF%SP9%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%SP9%F_P => NULL ()
ENDIF
IF (YDTPTRSLB1%MSLB1SP0 > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1SP0
  SELF%SP0%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%SP0%F_P => NULL ()
ENDIF
IF (YDTPTRSLB1%MSLB1C0 > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1C0
  SELF%C0%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  SELF%C0%F_P => NULL ()
ENDIF
IF (YDTPTRSLB1%MSLB1UP9 > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1UP9
  SELF%UP9%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  SELF%UP9%F_P => NULL ()
ENDIF
IF (YDTPTRSLB1%MSLB1VP9 > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1VP9
  SELF%VP9%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  SELF%VP9%F_P => NULL ()
ENDIF
IF (YDTPTRSLB1%MSLB1TP9 > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1TP9
  SELF%TP9%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  SELF%TP9%F_P => NULL ()
ENDIF
IF (YDTPTRSLB1%MSLB1U9_SI > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1U9_SI
  SELF%U9_SI%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  SELF%U9_SI%F_P => NULL ()
ENDIF
IF (YDTPTRSLB1%MSLB1V9_SI > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1V9_SI
  SELF%V9_SI%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  SELF%V9_SI%F_P => NULL ()
ENDIF
IF (YDTPTRSLB1%MSLB1T9_SI > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1T9_SI
  SELF%T9_SI%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  SELF%T9_SI%F_P => NULL ()
ENDIF
IF (YDTPTRSLB1%MSLB1PD9_SI > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1PD9_SI
  SELF%PD9_SI%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  SELF%PD9_SI%F_P => NULL ()
ENDIF
IF (YDTPTRSLB1%MSLB1VD9_SI > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1VD9_SI
  SELF%VD9_SI%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  SELF%VD9_SI%F_P => NULL ()
ENDIF
IF (YDTPTRSLB1%MSLB1C9_SI > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1C9_SI
  SELF%C9_SI%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  SELF%C9_SI%F_P => NULL ()
ENDIF
IF (YDTPTRSLB1%MSLB1UF9 > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1UF9
  SELF%UF9%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  SELF%UF9%F_P => NULL ()
ENDIF
IF (YDTPTRSLB1%MSLB1VF9 > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1VF9
  SELF%VF9%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  SELF%VF9%F_P => NULL ()
ENDIF
IF (YDTPTRSLB1%MSLB1TF9 > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1TF9
  SELF%TF9%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  SELF%TF9%F_P => NULL ()
ENDIF
IF (YDTPTRSLB1%MSLB1VDF9 > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1VDF9
  SELF%VDF9%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  SELF%VDF9%F_P => NULL ()
ENDIF
IF (YDTPTRSLB1%MSLB1U9_NL > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1U9_NL
  SELF%U9_NL%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  SELF%U9_NL%F_P => NULL ()
ENDIF
IF (YDTPTRSLB1%MSLB1V9_NL > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1V9_NL
  SELF%V9_NL%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  SELF%V9_NL%F_P => NULL ()
ENDIF
IF (YDTPTRSLB1%MSLB1T9_NL > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1T9_NL
  SELF%T9_NL%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  SELF%T9_NL%F_P => NULL ()
ENDIF
IF (YDTPTRSLB1%MSLB1PD9_NL > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1PD9_NL
  SELF%PD9_NL%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  SELF%PD9_NL%F_P => NULL ()
ENDIF
IF (YDTPTRSLB1%MSLB1VD9_NL > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1VD9_NL
  SELF%VD9_NL%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  SELF%VD9_NL%F_P => NULL ()
ENDIF
IF (YDTPTRSLB1%MSLB1C9_NL > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1C9_NL
  SELF%C9_NL%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  SELF%C9_NL%F_P => NULL ()
ENDIF

CALL CPG_SL1_TYPE_INIT_F3D (SELF%Q, YGFL%YQ)

CALL CPG_SL1_TYPE_INIT_F3D (SELF%I, YGFL%YI)

CALL CPG_SL1_TYPE_INIT_F3D (SELF%L, YGFL%YL)

CALL CPG_SL1_TYPE_INIT_F3D (SELF%LCONV, YGFL%YLCONV)

CALL CPG_SL1_TYPE_INIT_F3D (SELF%ICONV, YGFL%YICONV)

CALL CPG_SL1_TYPE_INIT_F3D (SELF%RCONV, YGFL%YRCONV)

CALL CPG_SL1_TYPE_INIT_F3D (SELF%SCONV, YGFL%YSCONV)

CALL CPG_SL1_TYPE_INIT_F3D (SELF%IRAD, YGFL%YIRAD)

CALL CPG_SL1_TYPE_INIT_F3D (SELF%LRAD, YGFL%YLRAD)

CALL CPG_SL1_TYPE_INIT_F3D (SELF%S, YGFL%YS)

CALL CPG_SL1_TYPE_INIT_F3D (SELF%R, YGFL%YR)

CALL CPG_SL1_TYPE_INIT_F3D (SELF%G, YGFL%YG)

CALL CPG_SL1_TYPE_INIT_F3D (SELF%H, YGFL%YH)

CALL CPG_SL1_TYPE_INIT_F3D (SELF%TKE, YGFL%YTKE)

CALL CPG_SL1_TYPE_INIT_F3D (SELF%TTE, YGFL%YTTE)

CALL CPG_SL1_TYPE_INIT_F3D (SELF%EFB1, YGFL%YEFB1)

CALL CPG_SL1_TYPE_INIT_F3D (SELF%EFB2, YGFL%YEFB2)

CALL CPG_SL1_TYPE_INIT_F3D (SELF%EFB3, YGFL%YEFB3)

CALL CPG_SL1_TYPE_INIT_F3D (SELF%A, YGFL%YA)

CALL CPG_SL1_TYPE_INIT_F3D (SELF%O3, YGFL%YO3)

CALL CPG_SL1_TYPE_INIT_F3D (SELF%SRC, YGFL%YSRC)

CALL CPG_SL1_TYPE_INIT_F3D (SELF%MXL, YGFL%YMXL)

CALL CPG_SL1_TYPE_INIT_F3D (SELF%SHTUR, YGFL%YSHTUR)

CALL CPG_SL1_TYPE_INIT_F3D (SELF%FQTUR, YGFL%YFQTUR)

CALL CPG_SL1_TYPE_INIT_F3D (SELF%FSTUR, YGFL%YFSTUR)

CALL CPG_SL1_TYPE_INIT_F3D (SELF%CPF, YGFL%YCPF)

CALL CPG_SL1_TYPE_INIT_F3D (SELF%SPF, YGFL%YSPF)

CALL CPG_SL1_TYPE_INIT_F3D (SELF%CVGQ, YGFL%YCVGQ)

CALL CPG_SL1_TYPE_INIT_F3D (SELF%QVA, YGFL%YQVA)


ALLOCATE (SELF%GHG (SIZE (YGFL%YGHG)))

DO JGFL = 1, SIZE (YGFL%YGHG)
  CALL CPG_SL1_TYPE_INIT_F3D (SELF%GHG(JGFL), YGFL%YGHG(JGFL))
ENDDO


ALLOCATE (SELF%CHEM (SIZE (YGFL%YCHEM)))

DO JGFL = 1, SIZE (YGFL%YCHEM)
  CALL CPG_SL1_TYPE_INIT_F3D (SELF%CHEM(JGFL), YGFL%YCHEM(JGFL))
ENDDO


ALLOCATE (SELF%AERO (SIZE (YGFL%YAERO)))

DO JGFL = 1, SIZE (YGFL%YAERO)
  CALL CPG_SL1_TYPE_INIT_F3D (SELF%AERO(JGFL), YGFL%YAERO(JGFL))
ENDDO

CALL CPG_SL1_TYPE_INIT_F3D (SELF%LRCH4, YGFL%YLRCH4)


ALLOCATE (SELF%FORC (SIZE (YGFL%YFORC)))

DO JGFL = 1, SIZE (YGFL%YFORC)
  CALL CPG_SL1_TYPE_INIT_F3D (SELF%FORC(JGFL), YGFL%YFORC(JGFL))
ENDDO


ALLOCATE (SELF%EZDIAG (SIZE (YGFL%YEZDIAG)))

DO JGFL = 1, SIZE (YGFL%YEZDIAG)
  CALL CPG_SL1_TYPE_INIT_F3D (SELF%EZDIAG(JGFL), YGFL%YEZDIAG(JGFL))
ENDDO


ALLOCATE (SELF%ERA40 (SIZE (YGFL%YERA40)))

DO JGFL = 1, SIZE (YGFL%YERA40)
  CALL CPG_SL1_TYPE_INIT_F3D (SELF%ERA40(JGFL), YGFL%YERA40(JGFL))
ENDDO


ALLOCATE (SELF%NOGW (SIZE (YGFL%YNOGW)))

DO JGFL = 1, SIZE (YGFL%YNOGW)
  CALL CPG_SL1_TYPE_INIT_F3D (SELF%NOGW(JGFL), YGFL%YNOGW(JGFL))
ENDDO


ALLOCATE (SELF%EDRP (SIZE (YGFL%YEDRP)))

DO JGFL = 1, SIZE (YGFL%YEDRP)
  CALL CPG_SL1_TYPE_INIT_F3D (SELF%EDRP(JGFL), YGFL%YEDRP(JGFL))
ENDDO


ALLOCATE (SELF%SLDIA (SIZE (YGFL%YSLDIA)))

DO JGFL = 1, SIZE (YGFL%YSLDIA)
  CALL CPG_SL1_TYPE_INIT_F3D (SELF%SLDIA(JGFL), YGFL%YSLDIA(JGFL))
ENDDO


ALLOCATE (SELF%AERAOT (SIZE (YGFL%YAERAOT)))

DO JGFL = 1, SIZE (YGFL%YAERAOT)
  CALL CPG_SL1_TYPE_INIT_F3D (SELF%AERAOT(JGFL), YGFL%YAERAOT(JGFL))
ENDDO


ALLOCATE (SELF%AERLISI (SIZE (YGFL%YAERLISI)))

DO JGFL = 1, SIZE (YGFL%YAERLISI)
  CALL CPG_SL1_TYPE_INIT_F3D (SELF%AERLISI(JGFL), YGFL%YAERLISI(JGFL))
ENDDO


ALLOCATE (SELF%AEROUT (SIZE (YGFL%YAEROUT)))

DO JGFL = 1, SIZE (YGFL%YAEROUT)
  CALL CPG_SL1_TYPE_INIT_F3D (SELF%AEROUT(JGFL), YGFL%YAEROUT(JGFL))
ENDDO


ALLOCATE (SELF%AEROCLIM (SIZE (YGFL%YAEROCLIM)))

DO JGFL = 1, SIZE (YGFL%YAEROCLIM)
  CALL CPG_SL1_TYPE_INIT_F3D (SELF%AEROCLIM(JGFL), YGFL%YAEROCLIM(JGFL))
ENDDO


ALLOCATE (SELF%UVP (SIZE (YGFL%YUVP)))

DO JGFL = 1, SIZE (YGFL%YUVP)
  CALL CPG_SL1_TYPE_INIT_F3D (SELF%UVP(JGFL), YGFL%YUVP(JGFL))
ENDDO


ALLOCATE (SELF%PHYS (SIZE (YGFL%YPHYS)))

DO JGFL = 1, SIZE (YGFL%YPHYS)
  CALL CPG_SL1_TYPE_INIT_F3D (SELF%PHYS(JGFL), YGFL%YPHYS(JGFL))
ENDDO

CALL CPG_SL1_TYPE_INIT_F3D (SELF%PHYCTY, YGFL%YPHYCTY)

CALL CPG_SL1_TYPE_INIT_F3D (SELF%RSPEC, YGFL%YRSPEC)

CALL CPG_SL1_TYPE_INIT_F3D (SELF%SDSAT, YGFL%YSDSAT)

CALL CPG_SL1_TYPE_INIT_F3D (SELF%CVV, YGFL%YCVV)

CALL CPG_SL1_TYPE_INIT_F3D (SELF%RKTH, YGFL%YRKTH)

CALL CPG_SL1_TYPE_INIT_F3D (SELF%RKTQV, YGFL%YRKTQV)

CALL CPG_SL1_TYPE_INIT_F3D (SELF%RKTQC, YGFL%YRKTQC)

CALL CPG_SL1_TYPE_INIT_F3D (SELF%UOM, YGFL%YUOM)

CALL CPG_SL1_TYPE_INIT_F3D (SELF%UAL, YGFL%YUAL)

CALL CPG_SL1_TYPE_INIT_F3D (SELF%DOM, YGFL%YDOM)

CALL CPG_SL1_TYPE_INIT_F3D (SELF%DAL, YGFL%YDAL)

CALL CPG_SL1_TYPE_INIT_F3D (SELF%UEN, YGFL%YUEN)

CALL CPG_SL1_TYPE_INIT_F3D (SELF%UNEBH, YGFL%YUNEBH)


ALLOCATE (SELF%CRM (SIZE (YGFL%YCRM)))

DO JGFL = 1, SIZE (YGFL%YCRM)
  CALL CPG_SL1_TYPE_INIT_F3D (SELF%CRM(JGFL), YGFL%YCRM(JGFL))
ENDDO


ALLOCATE (SELF%LIMA (SIZE (YGFL%YLIMA)))

DO JGFL = 1, SIZE (YGFL%YLIMA)
  CALL CPG_SL1_TYPE_INIT_F3D (SELF%LIMA(JGFL), YGFL%YLIMA(JGFL))
ENDDO

CALL CPG_SL1_TYPE_INIT_F3D (SELF%FSD, YGFL%YFSD)


ALLOCATE (SELF%EXT (SIZE (YGFL%YEXT)))

DO JGFL = 1, SIZE (YGFL%YEXT)
  CALL CPG_SL1_TYPE_INIT_F3D (SELF%EXT(JGFL), YGFL%YEXT(JGFL))
ENDDO


CONTAINS

SUBROUTINE CPG_SL1_TYPE_INIT_F3D (YDF3D, YDGFC)

USE YOM_YGFL, ONLY : TYPE_GFL_COMP

TYPE (CPG_SL1_3D_TYPE), INTENT (INOUT) :: YDF3D
TYPE(TYPE_GFL_COMP),    INTENT (IN)    :: YDGFC

IF (YDGFC%MP_SL1 > 0 .AND. YDGFC%MP1 > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1GFL9  + (YDGFC%MP_SL1-1)*(NLEV+2)
!WRITE (0, *) "CPG_SL1_TYPE_INIT_F3D ", JFLD, TRIM(YDGFC%CNAME)//"P"
  YDF3D%F_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  YDF3D%F_P => NULL ()
ENDIF

IF (YDMODEL%YRML_DYN%YRDYN%LSPLTHOIGFL .OR. (YDMODEL%YRML_DYN%YRDYN%NSPLTHOI /= 0)) THEN
  IF (YDGFC%MP_SL1 > 0 .AND. YDGFC%MP1 > 0) THEN
    JFLD = YDTPTRSLB1%MSLB1GFLF9 + (YDGFC%MP_SL1-1)*(NLEV+2)
    YDF3D%F_P_F => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
  ELSE
    YDF3D%F_P_F => NULL ()
  ENDIF
ENDIF

IF (YDGFC%MP_SPL > 0 .AND. YDGFC%MP1 > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1GFLSPF9  + (YDGFC%MP_SPL-1)*(NLEV+2)
  YDF3D%F_P_SPF => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  YDF3D%F_P_SPF => NULL ()
ENDIF

IF (YDGFC%MP_SPL > 0 .AND. YDGFC%MP1 > 0) THEN
  JFLD = YDTPTRSLB1%MSLB1GFLSP9  + (YDGFC%MP_SPL-1)*(NLEV+2)
  YDF3D%F_P_SP => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  YDF3D%F_P_SP => NULL ()
ENDIF

IF (YDGFC%LPHY) THEN
  JFLD = YDTPTRSLB1%MSLB1GFLP9  + (YDGFC%MGFL-1)*(NLEV+2)
  YDF3D%F_P_P => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV+1, :), PERSISTENT=LLPERSISTENT, LBOUNDS=[1,0,1])
ELSE
  YDF3D%F_P_P => NULL ()
ENDIF

END SUBROUTINE CPG_SL1_TYPE_INIT_F3D

END SUBROUTINE CPG_SL1_TYPE_INIT

SUBROUTINE CPG_SL1_TYPE_UPDATE_VIEW (SELF, BLOCK_INDEX)

CLASS (CPG_SL1_TYPE)        :: SELF
INTEGER(KIND=JPIM), INTENT (IN)   :: BLOCK_INDEX

INTEGER (KIND=JPIM) :: JGFL

IF (ASSOCIATED (SELF%F_DATA)) THEN
  SELF%ZVIEW => SELF%F_DATA%GET_VIEW (BLOCK_INDEX)
  IF (ASSOCIATED (SELF%U9%F_P)) THEN
    IF ((.NOT. SELF%U9%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%U9%P))) THEN
      SELF%U9%P => SELF%U9%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%U9%P)) THEN
    SELF%U9%P => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%V9%F_P)) THEN
    IF ((.NOT. SELF%V9%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%V9%P))) THEN
      SELF%V9%P => SELF%V9%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%V9%P)) THEN
    SELF%V9%P => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%T9%F_P)) THEN
    IF ((.NOT. SELF%T9%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%T9%P))) THEN
      SELF%T9%P => SELF%T9%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%T9%P)) THEN
    SELF%T9%P => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%PD9%F_P)) THEN
    IF ((.NOT. SELF%PD9%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%PD9%P))) THEN
      SELF%PD9%P => SELF%PD9%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%PD9%P)) THEN
    SELF%PD9%P => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%VD9%F_P)) THEN
    IF ((.NOT. SELF%VD9%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%VD9%P))) THEN
      SELF%VD9%P => SELF%VD9%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%VD9%P)) THEN
    SELF%VD9%P => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%NHX9%F_P)) THEN
    IF ((.NOT. SELF%NHX9%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%NHX9%P))) THEN
      SELF%NHX9%P => SELF%NHX9%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%NHX9%P)) THEN
    SELF%NHX9%P => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%UR0%F_P)) THEN
    IF ((.NOT. SELF%UR0%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%UR0%P))) THEN
      SELF%UR0%P => SELF%UR0%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%UR0%P)) THEN
    SELF%UR0%P => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%VR0%F_P)) THEN
    IF ((.NOT. SELF%VR0%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%VR0%P))) THEN
      SELF%VR0%P => SELF%VR0%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%VR0%P)) THEN
    SELF%VR0%P => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%ZR0%F_P)) THEN
    IF ((.NOT. SELF%ZR0%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%ZR0%P))) THEN
      SELF%ZR0%P => SELF%ZR0%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%ZR0%P)) THEN
    SELF%ZR0%P => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%WR0%F_P)) THEN
    IF ((.NOT. SELF%WR0%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%WR0%P))) THEN
      SELF%WR0%P => SELF%WR0%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%WR0%P)) THEN
    SELF%WR0%P => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%UR00%F_P)) THEN
    IF ((.NOT. SELF%UR00%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%UR00%P))) THEN
      SELF%UR00%P => SELF%UR00%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%UR00%P)) THEN
    SELF%UR00%P => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%VR00%F_P)) THEN
    IF ((.NOT. SELF%VR00%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%VR00%P))) THEN
      SELF%VR00%P => SELF%VR00%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%VR00%P)) THEN
    SELF%VR00%P => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%ZR00%F_P)) THEN
    IF ((.NOT. SELF%ZR00%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%ZR00%P))) THEN
      SELF%ZR00%P => SELF%ZR00%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%ZR00%P)) THEN
    SELF%ZR00%P => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%WR00%F_P)) THEN
    IF ((.NOT. SELF%WR00%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%WR00%P))) THEN
      SELF%WR00%P => SELF%WR00%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%WR00%P)) THEN
    SELF%WR00%P => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%WRA%F_P)) THEN
    IF ((.NOT. SELF%WRA%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%WRA%P))) THEN
      SELF%WRA%P => SELF%WRA%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%WRA%P)) THEN
    SELF%WRA%P => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%UR9%F_P)) THEN
    IF ((.NOT. SELF%UR9%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%UR9%P))) THEN
      SELF%UR9%P => SELF%UR9%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%UR9%P)) THEN
    SELF%UR9%P => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%VR9%F_P)) THEN
    IF ((.NOT. SELF%VR9%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%VR9%P))) THEN
      SELF%VR9%P => SELF%VR9%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%VR9%P)) THEN
    SELF%VR9%P => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%DBBC9%F_P)) THEN
    IF ((.NOT. SELF%DBBC9%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DBBC9%P))) THEN
      SELF%DBBC9%P => SELF%DBBC9%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%DBBC9%P)) THEN
    SELF%DBBC9%P => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%DPHI9%F_P)) THEN
    IF ((.NOT. SELF%DPHI9%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DPHI9%P))) THEN
      SELF%DPHI9%P => SELF%DPHI9%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%DPHI9%P)) THEN
    SELF%DPHI9%P => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%GWS9%F_P)) THEN
    IF ((.NOT. SELF%GWS9%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%GWS9%P))) THEN
      SELF%GWS9%P => SELF%GWS9%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%GWS9%P)) THEN
    SELF%GWS9%P => ZDUM1
  ENDIF
  IF (ASSOCIATED (SELF%U0%F_P)) THEN
    IF ((.NOT. SELF%U0%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%U0%P))) THEN
      SELF%U0%P => SELF%U0%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%U0%P)) THEN
    SELF%U0%P => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%V0%F_P)) THEN
    IF ((.NOT. SELF%V0%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%V0%P))) THEN
      SELF%V0%P => SELF%V0%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%V0%P)) THEN
    SELF%V0%P => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%T0%F_P)) THEN
    IF ((.NOT. SELF%T0%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%T0%P))) THEN
      SELF%T0%P => SELF%T0%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%T0%P)) THEN
    SELF%T0%P => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%PD0%F_P)) THEN
    IF ((.NOT. SELF%PD0%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%PD0%P))) THEN
      SELF%PD0%P => SELF%PD0%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%PD0%P)) THEN
    SELF%PD0%P => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%VD0%F_P)) THEN
    IF ((.NOT. SELF%VD0%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%VD0%P))) THEN
      SELF%VD0%P => SELF%VD0%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%VD0%P)) THEN
    SELF%VD0%P => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%C9%F_P)) THEN
    IF ((.NOT. SELF%C9%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%C9%P))) THEN
      SELF%C9%P => SELF%C9%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%C9%P)) THEN
    SELF%C9%P => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%SP9%F_P)) THEN
    IF ((.NOT. SELF%SP9%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%SP9%P))) THEN
      SELF%SP9%P => SELF%SP9%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%SP9%P)) THEN
    SELF%SP9%P => ZDUM1
  ENDIF
  IF (ASSOCIATED (SELF%SP0%F_P)) THEN
    IF ((.NOT. SELF%SP0%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%SP0%P))) THEN
      SELF%SP0%P => SELF%SP0%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%SP0%P)) THEN
    SELF%SP0%P => ZDUM1
  ENDIF
  IF (ASSOCIATED (SELF%C0%F_P)) THEN
    IF ((.NOT. SELF%C0%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%C0%P))) THEN
      SELF%C0%P => SELF%C0%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%C0%P)) THEN
    SELF%C0%P => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%UP9%F_P)) THEN
    IF ((.NOT. SELF%UP9%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%UP9%P))) THEN
      SELF%UP9%P => SELF%UP9%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%UP9%P)) THEN
    SELF%UP9%P => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%VP9%F_P)) THEN
    IF ((.NOT. SELF%VP9%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%VP9%P))) THEN
      SELF%VP9%P => SELF%VP9%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%VP9%P)) THEN
    SELF%VP9%P => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%TP9%F_P)) THEN
    IF ((.NOT. SELF%TP9%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%TP9%P))) THEN
      SELF%TP9%P => SELF%TP9%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%TP9%P)) THEN
    SELF%TP9%P => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%U9_SI%F_P)) THEN
    IF ((.NOT. SELF%U9_SI%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%U9_SI%P))) THEN
      SELF%U9_SI%P => SELF%U9_SI%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%U9_SI%P)) THEN
    SELF%U9_SI%P => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%V9_SI%F_P)) THEN
    IF ((.NOT. SELF%V9_SI%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%V9_SI%P))) THEN
      SELF%V9_SI%P => SELF%V9_SI%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%V9_SI%P)) THEN
    SELF%V9_SI%P => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%T9_SI%F_P)) THEN
    IF ((.NOT. SELF%T9_SI%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%T9_SI%P))) THEN
      SELF%T9_SI%P => SELF%T9_SI%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%T9_SI%P)) THEN
    SELF%T9_SI%P => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%PD9_SI%F_P)) THEN
    IF ((.NOT. SELF%PD9_SI%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%PD9_SI%P))) THEN
      SELF%PD9_SI%P => SELF%PD9_SI%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%PD9_SI%P)) THEN
    SELF%PD9_SI%P => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%VD9_SI%F_P)) THEN
    IF ((.NOT. SELF%VD9_SI%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%VD9_SI%P))) THEN
      SELF%VD9_SI%P => SELF%VD9_SI%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%VD9_SI%P)) THEN
    SELF%VD9_SI%P => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%C9_SI%F_P)) THEN
    IF ((.NOT. SELF%C9_SI%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%C9_SI%P))) THEN
      SELF%C9_SI%P => SELF%C9_SI%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%C9_SI%P)) THEN
    SELF%C9_SI%P => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%UF9%F_P)) THEN
    IF ((.NOT. SELF%UF9%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%UF9%P))) THEN
      SELF%UF9%P => SELF%UF9%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%UF9%P)) THEN
    SELF%UF9%P => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%VF9%F_P)) THEN
    IF ((.NOT. SELF%VF9%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%VF9%P))) THEN
      SELF%VF9%P => SELF%VF9%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%VF9%P)) THEN
    SELF%VF9%P => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%TF9%F_P)) THEN
    IF ((.NOT. SELF%TF9%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%TF9%P))) THEN
      SELF%TF9%P => SELF%TF9%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%TF9%P)) THEN
    SELF%TF9%P => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%VDF9%F_P)) THEN
    IF ((.NOT. SELF%VDF9%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%VDF9%P))) THEN
      SELF%VDF9%P => SELF%VDF9%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%VDF9%P)) THEN
    SELF%VDF9%P => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%U9_NL%F_P)) THEN
    IF ((.NOT. SELF%U9_NL%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%U9_NL%P))) THEN
      SELF%U9_NL%P => SELF%U9_NL%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%U9_NL%P)) THEN
    SELF%U9_NL%P => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%V9_NL%F_P)) THEN
    IF ((.NOT. SELF%V9_NL%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%V9_NL%P))) THEN
      SELF%V9_NL%P => SELF%V9_NL%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%V9_NL%P)) THEN
    SELF%V9_NL%P => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%T9_NL%F_P)) THEN
    IF ((.NOT. SELF%T9_NL%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%T9_NL%P))) THEN
      SELF%T9_NL%P => SELF%T9_NL%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%T9_NL%P)) THEN
    SELF%T9_NL%P => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%PD9_NL%F_P)) THEN
    IF ((.NOT. SELF%PD9_NL%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%PD9_NL%P))) THEN
      SELF%PD9_NL%P => SELF%PD9_NL%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%PD9_NL%P)) THEN
    SELF%PD9_NL%P => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%VD9_NL%F_P)) THEN
    IF ((.NOT. SELF%VD9_NL%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%VD9_NL%P))) THEN
      SELF%VD9_NL%P => SELF%VD9_NL%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%VD9_NL%P)) THEN
    SELF%VD9_NL%P => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%C9_NL%F_P)) THEN
    IF ((.NOT. SELF%C9_NL%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%C9_NL%P))) THEN
      SELF%C9_NL%P => SELF%C9_NL%F_P%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%C9_NL%P)) THEN
    SELF%C9_NL%P => ZDUM2
  ENDIF

    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%Q)

    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%I)

    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%L)

    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%LCONV)

    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%ICONV)

    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%RCONV)

    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%SCONV)

    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%IRAD)

    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%LRAD)

    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%S)

    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%R)

    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%G)

    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%H)

    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%TKE)

    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%TTE)

    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%EFB1)

    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%EFB2)

    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%EFB3)

    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%A)

    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%O3)

    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%SRC)

    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%MXL)

    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%SHTUR)

    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%FQTUR)

    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%FSTUR)

    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%CPF)

    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%SPF)

    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%CVGQ)

    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%QVA)

  DO JGFL = 1, SIZE (SELF%GHG)
    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%GHG(JGFL))
  ENDDO

  DO JGFL = 1, SIZE (SELF%CHEM)
    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%CHEM(JGFL))
  ENDDO

  DO JGFL = 1, SIZE (SELF%AERO)
    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%AERO(JGFL))
  ENDDO

    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%LRCH4)

  DO JGFL = 1, SIZE (SELF%FORC)
    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%FORC(JGFL))
  ENDDO

  DO JGFL = 1, SIZE (SELF%EZDIAG)
    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%EZDIAG(JGFL))
  ENDDO

  DO JGFL = 1, SIZE (SELF%ERA40)
    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%ERA40(JGFL))
  ENDDO

  DO JGFL = 1, SIZE (SELF%NOGW)
    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%NOGW(JGFL))
  ENDDO

  DO JGFL = 1, SIZE (SELF%EDRP)
    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%EDRP(JGFL))
  ENDDO

  DO JGFL = 1, SIZE (SELF%SLDIA)
    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%SLDIA(JGFL))
  ENDDO

  DO JGFL = 1, SIZE (SELF%AERAOT)
    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%AERAOT(JGFL))
  ENDDO

  DO JGFL = 1, SIZE (SELF%AERLISI)
    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%AERLISI(JGFL))
  ENDDO

  DO JGFL = 1, SIZE (SELF%AEROUT)
    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%AEROUT(JGFL))
  ENDDO

  DO JGFL = 1, SIZE (SELF%AEROCLIM)
    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%AEROCLIM(JGFL))
  ENDDO

  DO JGFL = 1, SIZE (SELF%UVP)
    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%UVP(JGFL))
  ENDDO

  DO JGFL = 1, SIZE (SELF%PHYS)
    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%PHYS(JGFL))
  ENDDO

    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%PHYCTY)

    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%RSPEC)

    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%SDSAT)

    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%CVV)

    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%RKTH)

    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%RKTQV)

    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%RKTQC)

    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%UOM)

    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%UAL)

    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%DOM)

    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%DAL)

    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%UEN)

    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%UNEBH)

  DO JGFL = 1, SIZE (SELF%CRM)
    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%CRM(JGFL))
  ENDDO

  DO JGFL = 1, SIZE (SELF%LIMA)
    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%LIMA(JGFL))
  ENDDO

    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%FSD)

  DO JGFL = 1, SIZE (SELF%EXT)
    CALL CPG_SL1_TYPE_UPDATE_VIEW_F3D (SELF%EXT(JGFL))
  ENDDO


ELSE
  SELF%ZVIEW => ZDUM2

  IF (.NOT. ASSOCIATED (SELF%U9%F_P)) SELF%U9%P => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%V9%F_P)) SELF%V9%P => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%T9%F_P)) SELF%T9%P => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%PD9%F_P)) SELF%PD9%P => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%VD9%F_P)) SELF%VD9%P => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%NHX9%F_P)) SELF%NHX9%P => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%UR0%F_P)) SELF%UR0%P => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%VR0%F_P)) SELF%VR0%P => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%ZR0%F_P)) SELF%ZR0%P => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%WR0%F_P)) SELF%WR0%P => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%UR00%F_P)) SELF%UR00%P => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%VR00%F_P)) SELF%VR00%P => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%ZR00%F_P)) SELF%ZR00%P => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%WR00%F_P)) SELF%WR00%P => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%WRA%F_P)) SELF%WRA%P => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%UR9%F_P)) SELF%UR9%P => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%VR9%F_P)) SELF%VR9%P => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%DBBC9%F_P)) SELF%DBBC9%P => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%DPHI9%F_P)) SELF%DPHI9%P => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%GWS9%F_P)) SELF%GWS9%P => ZDUM1
  IF (.NOT. ASSOCIATED (SELF%U0%F_P)) SELF%U0%P => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%V0%F_P)) SELF%V0%P => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%T0%F_P)) SELF%T0%P => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%PD0%F_P)) SELF%PD0%P => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%VD0%F_P)) SELF%VD0%P => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%C9%F_P)) SELF%C9%P => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%SP9%F_P)) SELF%SP9%P => ZDUM1
  IF (.NOT. ASSOCIATED (SELF%SP0%F_P)) SELF%SP0%P => ZDUM1
  IF (.NOT. ASSOCIATED (SELF%C0%F_P)) SELF%C0%P => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%UP9%F_P)) SELF%UP9%P => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%VP9%F_P)) SELF%VP9%P => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%TP9%F_P)) SELF%TP9%P => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%U9_SI%F_P)) SELF%U9_SI%P => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%V9_SI%F_P)) SELF%V9_SI%P => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%T9_SI%F_P)) SELF%T9_SI%P => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%PD9_SI%F_P)) SELF%PD9_SI%P => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%VD9_SI%F_P)) SELF%VD9_SI%P => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%C9_SI%F_P)) SELF%C9_SI%P => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%UF9%F_P)) SELF%UF9%P => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%VF9%F_P)) SELF%VF9%P => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%TF9%F_P)) SELF%TF9%P => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%VDF9%F_P)) SELF%VDF9%P => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%U9_NL%F_P)) SELF%U9_NL%P => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%V9_NL%F_P)) SELF%V9_NL%P => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%T9_NL%F_P)) SELF%T9_NL%P => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%PD9_NL%F_P)) SELF%PD9_NL%P => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%VD9_NL%F_P)) SELF%VD9_NL%P => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%C9_NL%F_P)) SELF%C9_NL%P => ZDUM2

  CALL NULLIFY_F3D (SELF%Q)
  CALL NULLIFY_F3D (SELF%I)
  CALL NULLIFY_F3D (SELF%L)
  CALL NULLIFY_F3D (SELF%LCONV)
  CALL NULLIFY_F3D (SELF%ICONV)
  CALL NULLIFY_F3D (SELF%RCONV)
  CALL NULLIFY_F3D (SELF%SCONV)
  CALL NULLIFY_F3D (SELF%IRAD)
  CALL NULLIFY_F3D (SELF%LRAD)
  CALL NULLIFY_F3D (SELF%S)
  CALL NULLIFY_F3D (SELF%R)
  CALL NULLIFY_F3D (SELF%G)
  CALL NULLIFY_F3D (SELF%H)
  CALL NULLIFY_F3D (SELF%TKE)
  CALL NULLIFY_F3D (SELF%TTE)
  CALL NULLIFY_F3D (SELF%EFB1)
  CALL NULLIFY_F3D (SELF%EFB2)
  CALL NULLIFY_F3D (SELF%EFB3)
  CALL NULLIFY_F3D (SELF%A)
  CALL NULLIFY_F3D (SELF%O3)
  CALL NULLIFY_F3D (SELF%SRC)
  CALL NULLIFY_F3D (SELF%MXL)
  CALL NULLIFY_F3D (SELF%SHTUR)
  CALL NULLIFY_F3D (SELF%FQTUR)
  CALL NULLIFY_F3D (SELF%FSTUR)
  CALL NULLIFY_F3D (SELF%CPF)
  CALL NULLIFY_F3D (SELF%SPF)
  CALL NULLIFY_F3D (SELF%CVGQ)
  CALL NULLIFY_F3D (SELF%QVA)
  DO JGFL = 1, SIZE (SELF%GHG)
    CALL NULLIFY_F3D (SELF%GHG(JGFL))
  ENDDO
  DO JGFL = 1, SIZE (SELF%CHEM)
    CALL NULLIFY_F3D (SELF%CHEM(JGFL))
  ENDDO
  DO JGFL = 1, SIZE (SELF%AERO)
    CALL NULLIFY_F3D (SELF%AERO(JGFL))
  ENDDO
  CALL NULLIFY_F3D (SELF%LRCH4)
  DO JGFL = 1, SIZE (SELF%FORC)
    CALL NULLIFY_F3D (SELF%FORC(JGFL))
  ENDDO
  DO JGFL = 1, SIZE (SELF%EZDIAG)
    CALL NULLIFY_F3D (SELF%EZDIAG(JGFL))
  ENDDO
  DO JGFL = 1, SIZE (SELF%ERA40)
    CALL NULLIFY_F3D (SELF%ERA40(JGFL))
  ENDDO
  DO JGFL = 1, SIZE (SELF%NOGW)
    CALL NULLIFY_F3D (SELF%NOGW(JGFL))
  ENDDO
  DO JGFL = 1, SIZE (SELF%EDRP)
    CALL NULLIFY_F3D (SELF%EDRP(JGFL))
  ENDDO
  DO JGFL = 1, SIZE (SELF%SLDIA)
    CALL NULLIFY_F3D (SELF%SLDIA(JGFL))
  ENDDO
  DO JGFL = 1, SIZE (SELF%AERAOT)
    CALL NULLIFY_F3D (SELF%AERAOT(JGFL))
  ENDDO
  DO JGFL = 1, SIZE (SELF%AERLISI)
    CALL NULLIFY_F3D (SELF%AERLISI(JGFL))
  ENDDO
  DO JGFL = 1, SIZE (SELF%AEROUT)
    CALL NULLIFY_F3D (SELF%AEROUT(JGFL))
  ENDDO
  DO JGFL = 1, SIZE (SELF%AEROCLIM)
    CALL NULLIFY_F3D (SELF%AEROCLIM(JGFL))
  ENDDO
  DO JGFL = 1, SIZE (SELF%UVP)
    CALL NULLIFY_F3D (SELF%UVP(JGFL))
  ENDDO
  DO JGFL = 1, SIZE (SELF%PHYS)
    CALL NULLIFY_F3D (SELF%PHYS(JGFL))
  ENDDO
  CALL NULLIFY_F3D (SELF%PHYCTY)
  CALL NULLIFY_F3D (SELF%RSPEC)
  CALL NULLIFY_F3D (SELF%SDSAT)
  CALL NULLIFY_F3D (SELF%CVV)
  CALL NULLIFY_F3D (SELF%RKTH)
  CALL NULLIFY_F3D (SELF%RKTQV)
  CALL NULLIFY_F3D (SELF%RKTQC)
  CALL NULLIFY_F3D (SELF%UOM)
  CALL NULLIFY_F3D (SELF%UAL)
  CALL NULLIFY_F3D (SELF%DOM)
  CALL NULLIFY_F3D (SELF%DAL)
  CALL NULLIFY_F3D (SELF%UEN)
  CALL NULLIFY_F3D (SELF%UNEBH)
  DO JGFL = 1, SIZE (SELF%CRM)
    CALL NULLIFY_F3D (SELF%CRM(JGFL))
  ENDDO
  DO JGFL = 1, SIZE (SELF%LIMA)
    CALL NULLIFY_F3D (SELF%LIMA(JGFL))
  ENDDO
  CALL NULLIFY_F3D (SELF%FSD)
  DO JGFL = 1, SIZE (SELF%EXT)
    CALL NULLIFY_F3D (SELF%EXT(JGFL))
  ENDDO

ENDIF

CONTAINS

SUBROUTINE NULLIFY_F3D (YDF3D)

TYPE (CPG_SL1_3D_TYPE), INTENT (INOUT) :: YDF3D

IF (.NOT. ASSOCIATED (YDF3D%F_P    )) YDF3D%P     => ZDUM2
IF (.NOT. ASSOCIATED (YDF3D%F_P_F  )) YDF3D%P_F   => ZDUM2
IF (.NOT. ASSOCIATED (YDF3D%F_P_SPF)) YDF3D%P_SPF => ZDUM2
IF (.NOT. ASSOCIATED (YDF3D%F_P_SP )) YDF3D%P_SP  => ZDUM2
IF (.NOT. ASSOCIATED (YDF3D%F_P_P  )) YDF3D%P_P   => ZDUM2

END SUBROUTINE NULLIFY_F3D

SUBROUTINE CPG_SL1_TYPE_UPDATE_VIEW_F3D (YDF3D)

TYPE (CPG_SL1_3D_TYPE), INTENT (INOUT) :: YDF3D

IF (ASSOCIATED (YDF3D%F_P)) THEN
  IF ((.NOT. YDF3D%F_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (YDF3D%P))) THEN
    YDF3D%P => YDF3D%F_P%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (YDF3D%P)) THEN
  YDF3D%P => ZDUM2
ENDIF

IF (ASSOCIATED (YDF3D%F_P_F)) THEN
  IF ((.NOT. YDF3D%F_P_F%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (YDF3D%P_F))) THEN
    YDF3D%P_F => YDF3D%F_P_F%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (YDF3D%P_F)) THEN
  YDF3D%P_F => ZDUM2
ENDIF

IF (ASSOCIATED (YDF3D%F_P_SPF)) THEN
  IF ((.NOT. YDF3D%F_P_SPF%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (YDF3D%P_SPF))) THEN
    YDF3D%P_SPF => YDF3D%F_P_SPF%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (YDF3D%P_SPF)) THEN
  YDF3D%P_SPF => ZDUM2
ENDIF

IF (ASSOCIATED (YDF3D%F_P_SP)) THEN
  IF ((.NOT. YDF3D%F_P_SP%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (YDF3D%P_SP))) THEN
    YDF3D%P_SP => YDF3D%F_P_SP%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (YDF3D%P_SP)) THEN
  YDF3D%P_SP => ZDUM2
ENDIF

IF (ASSOCIATED (YDF3D%F_P_P)) THEN
  IF ((.NOT. YDF3D%F_P_P%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (YDF3D%P_P))) THEN
    YDF3D%P_P => YDF3D%F_P_P%GET_VIEW (BLOCK_INDEX)
  ENDIF
ELSEIF (.NOT. ASSOCIATED (YDF3D%P_P)) THEN
  YDF3D%P_P => ZDUM2
ENDIF

END SUBROUTINE CPG_SL1_TYPE_UPDATE_VIEW_F3D

END SUBROUTINE CPG_SL1_TYPE_UPDATE_VIEW

SUBROUTINE CPG_SL1_TYPE_FINAL (SELF)
CLASS (CPG_SL1_TYPE)          :: SELF

INTEGER (KIND=JPIM) :: JGFL

IF (ASSOCIATED (SELF%F_DATA)) CALL DELETE_TEMPORARY (SELF%F_DATA)
SELF%F_DATA => NULL ()

IF (SELF%LOWNED) THEN
  DEALLOCATE (SELF%ZDATA)
ENDIF

SELF%ZDATA => NULL ()
SELF%ZVIEW => NULL ()

IF (ASSOCIATED (SELF%U9%F_P)) CALL DELETE_TEMPORARY (SELF%U9%F_P)
SELF%U9%F_P => NULL ()
SELF%U9%P => NULL ()
IF (ASSOCIATED (SELF%V9%F_P)) CALL DELETE_TEMPORARY (SELF%V9%F_P)
SELF%V9%F_P => NULL ()
SELF%V9%P => NULL ()
IF (ASSOCIATED (SELF%T9%F_P)) CALL DELETE_TEMPORARY (SELF%T9%F_P)
SELF%T9%F_P => NULL ()
SELF%T9%P => NULL ()
IF (ASSOCIATED (SELF%PD9%F_P)) CALL DELETE_TEMPORARY (SELF%PD9%F_P)
SELF%PD9%F_P => NULL ()
SELF%PD9%P => NULL ()
IF (ASSOCIATED (SELF%VD9%F_P)) CALL DELETE_TEMPORARY (SELF%VD9%F_P)
SELF%VD9%F_P => NULL ()
SELF%VD9%P => NULL ()
IF (ASSOCIATED (SELF%NHX9%F_P)) CALL DELETE_TEMPORARY (SELF%NHX9%F_P)
SELF%NHX9%F_P => NULL ()
SELF%NHX9%P => NULL ()
IF (ASSOCIATED (SELF%UR0%F_P)) CALL DELETE_TEMPORARY (SELF%UR0%F_P)
SELF%UR0%F_P => NULL ()
SELF%UR0%P => NULL ()
IF (ASSOCIATED (SELF%VR0%F_P)) CALL DELETE_TEMPORARY (SELF%VR0%F_P)
SELF%VR0%F_P => NULL ()
SELF%VR0%P => NULL ()
IF (ASSOCIATED (SELF%ZR0%F_P)) CALL DELETE_TEMPORARY (SELF%ZR0%F_P)
SELF%ZR0%F_P => NULL ()
SELF%ZR0%P => NULL ()
IF (ASSOCIATED (SELF%WR0%F_P)) CALL DELETE_TEMPORARY (SELF%WR0%F_P)
SELF%WR0%F_P => NULL ()
SELF%WR0%P => NULL ()
IF (ASSOCIATED (SELF%UR00%F_P)) CALL DELETE_TEMPORARY (SELF%UR00%F_P)
SELF%UR00%F_P => NULL ()
SELF%UR00%P => NULL ()
IF (ASSOCIATED (SELF%VR00%F_P)) CALL DELETE_TEMPORARY (SELF%VR00%F_P)
SELF%VR00%F_P => NULL ()
SELF%VR00%P => NULL ()
IF (ASSOCIATED (SELF%ZR00%F_P)) CALL DELETE_TEMPORARY (SELF%ZR00%F_P)
SELF%ZR00%F_P => NULL ()
SELF%ZR00%P => NULL ()
IF (ASSOCIATED (SELF%WR00%F_P)) CALL DELETE_TEMPORARY (SELF%WR00%F_P)
SELF%WR00%F_P => NULL ()
SELF%WR00%P => NULL ()
IF (ASSOCIATED (SELF%WRA%F_P)) CALL DELETE_TEMPORARY (SELF%WRA%F_P)
SELF%WRA%F_P => NULL ()
SELF%WRA%P => NULL ()
IF (ASSOCIATED (SELF%UR9%F_P)) CALL DELETE_TEMPORARY (SELF%UR9%F_P)
SELF%UR9%F_P => NULL ()
SELF%UR9%P => NULL ()
IF (ASSOCIATED (SELF%VR9%F_P)) CALL DELETE_TEMPORARY (SELF%VR9%F_P)
SELF%VR9%F_P => NULL ()
SELF%VR9%P => NULL ()
IF (ASSOCIATED (SELF%DBBC9%F_P)) CALL DELETE_TEMPORARY (SELF%DBBC9%F_P)
SELF%DBBC9%F_P => NULL ()
SELF%DBBC9%P => NULL ()
IF (ASSOCIATED (SELF%DPHI9%F_P)) CALL DELETE_TEMPORARY (SELF%DPHI9%F_P)
SELF%DPHI9%F_P => NULL ()
SELF%DPHI9%P => NULL ()
IF (ASSOCIATED (SELF%GWS9%F_P)) CALL DELETE_TEMPORARY (SELF%GWS9%F_P)
SELF%GWS9%F_P => NULL ()
SELF%GWS9%P => NULL ()
IF (ASSOCIATED (SELF%U0%F_P)) CALL DELETE_TEMPORARY (SELF%U0%F_P)
SELF%U0%F_P => NULL ()
SELF%U0%P => NULL ()
IF (ASSOCIATED (SELF%V0%F_P)) CALL DELETE_TEMPORARY (SELF%V0%F_P)
SELF%V0%F_P => NULL ()
SELF%V0%P => NULL ()
IF (ASSOCIATED (SELF%T0%F_P)) CALL DELETE_TEMPORARY (SELF%T0%F_P)
SELF%T0%F_P => NULL ()
SELF%T0%P => NULL ()
IF (ASSOCIATED (SELF%PD0%F_P)) CALL DELETE_TEMPORARY (SELF%PD0%F_P)
SELF%PD0%F_P => NULL ()
SELF%PD0%P => NULL ()
IF (ASSOCIATED (SELF%VD0%F_P)) CALL DELETE_TEMPORARY (SELF%VD0%F_P)
SELF%VD0%F_P => NULL ()
SELF%VD0%P => NULL ()
IF (ASSOCIATED (SELF%C9%F_P)) CALL DELETE_TEMPORARY (SELF%C9%F_P)
SELF%C9%F_P => NULL ()
SELF%C9%P => NULL ()
IF (ASSOCIATED (SELF%SP9%F_P)) CALL DELETE_TEMPORARY (SELF%SP9%F_P)
SELF%SP9%F_P => NULL ()
SELF%SP9%P => NULL ()
IF (ASSOCIATED (SELF%SP0%F_P)) CALL DELETE_TEMPORARY (SELF%SP0%F_P)
SELF%SP0%F_P => NULL ()
SELF%SP0%P => NULL ()
IF (ASSOCIATED (SELF%C0%F_P)) CALL DELETE_TEMPORARY (SELF%C0%F_P)
SELF%C0%F_P => NULL ()
SELF%C0%P => NULL ()
IF (ASSOCIATED (SELF%UP9%F_P)) CALL DELETE_TEMPORARY (SELF%UP9%F_P)
SELF%UP9%F_P => NULL ()
SELF%UP9%P => NULL ()
IF (ASSOCIATED (SELF%VP9%F_P)) CALL DELETE_TEMPORARY (SELF%VP9%F_P)
SELF%VP9%F_P => NULL ()
SELF%VP9%P => NULL ()
IF (ASSOCIATED (SELF%TP9%F_P)) CALL DELETE_TEMPORARY (SELF%TP9%F_P)
SELF%TP9%F_P => NULL ()
SELF%TP9%P => NULL ()
IF (ASSOCIATED (SELF%U9_SI%F_P)) CALL DELETE_TEMPORARY (SELF%U9_SI%F_P)
SELF%U9_SI%F_P => NULL ()
SELF%U9_SI%P => NULL ()
IF (ASSOCIATED (SELF%V9_SI%F_P)) CALL DELETE_TEMPORARY (SELF%V9_SI%F_P)
SELF%V9_SI%F_P => NULL ()
SELF%V9_SI%P => NULL ()
IF (ASSOCIATED (SELF%T9_SI%F_P)) CALL DELETE_TEMPORARY (SELF%T9_SI%F_P)
SELF%T9_SI%F_P => NULL ()
SELF%T9_SI%P => NULL ()
IF (ASSOCIATED (SELF%PD9_SI%F_P)) CALL DELETE_TEMPORARY (SELF%PD9_SI%F_P)
SELF%PD9_SI%F_P => NULL ()
SELF%PD9_SI%P => NULL ()
IF (ASSOCIATED (SELF%VD9_SI%F_P)) CALL DELETE_TEMPORARY (SELF%VD9_SI%F_P)
SELF%VD9_SI%F_P => NULL ()
SELF%VD9_SI%P => NULL ()
IF (ASSOCIATED (SELF%C9_SI%F_P)) CALL DELETE_TEMPORARY (SELF%C9_SI%F_P)
SELF%C9_SI%F_P => NULL ()
SELF%C9_SI%P => NULL ()
IF (ASSOCIATED (SELF%UF9%F_P)) CALL DELETE_TEMPORARY (SELF%UF9%F_P)
SELF%UF9%F_P => NULL ()
SELF%UF9%P => NULL ()
IF (ASSOCIATED (SELF%VF9%F_P)) CALL DELETE_TEMPORARY (SELF%VF9%F_P)
SELF%VF9%F_P => NULL ()
SELF%VF9%P => NULL ()
IF (ASSOCIATED (SELF%TF9%F_P)) CALL DELETE_TEMPORARY (SELF%TF9%F_P)
SELF%TF9%F_P => NULL ()
SELF%TF9%P => NULL ()
IF (ASSOCIATED (SELF%VDF9%F_P)) CALL DELETE_TEMPORARY (SELF%VDF9%F_P)
SELF%VDF9%F_P => NULL ()
SELF%VDF9%P => NULL ()
IF (ASSOCIATED (SELF%U9_NL%F_P)) CALL DELETE_TEMPORARY (SELF%U9_NL%F_P)
SELF%U9_NL%F_P => NULL ()
SELF%U9_NL%P => NULL ()
IF (ASSOCIATED (SELF%V9_NL%F_P)) CALL DELETE_TEMPORARY (SELF%V9_NL%F_P)
SELF%V9_NL%F_P => NULL ()
SELF%V9_NL%P => NULL ()
IF (ASSOCIATED (SELF%T9_NL%F_P)) CALL DELETE_TEMPORARY (SELF%T9_NL%F_P)
SELF%T9_NL%F_P => NULL ()
SELF%T9_NL%P => NULL ()
IF (ASSOCIATED (SELF%PD9_NL%F_P)) CALL DELETE_TEMPORARY (SELF%PD9_NL%F_P)
SELF%PD9_NL%F_P => NULL ()
SELF%PD9_NL%P => NULL ()
IF (ASSOCIATED (SELF%VD9_NL%F_P)) CALL DELETE_TEMPORARY (SELF%VD9_NL%F_P)
SELF%VD9_NL%F_P => NULL ()
SELF%VD9_NL%P => NULL ()
IF (ASSOCIATED (SELF%C9_NL%F_P)) CALL DELETE_TEMPORARY (SELF%C9_NL%F_P)
SELF%C9_NL%F_P => NULL ()
SELF%C9_NL%P => NULL ()

CALL CPG_SL1_TYPE_FINAL_F3D (SELF%Q)

CALL CPG_SL1_TYPE_FINAL_F3D (SELF%I)

CALL CPG_SL1_TYPE_FINAL_F3D (SELF%L)

CALL CPG_SL1_TYPE_FINAL_F3D (SELF%LCONV)

CALL CPG_SL1_TYPE_FINAL_F3D (SELF%ICONV)

CALL CPG_SL1_TYPE_FINAL_F3D (SELF%RCONV)

CALL CPG_SL1_TYPE_FINAL_F3D (SELF%SCONV)

CALL CPG_SL1_TYPE_FINAL_F3D (SELF%IRAD)

CALL CPG_SL1_TYPE_FINAL_F3D (SELF%LRAD)

CALL CPG_SL1_TYPE_FINAL_F3D (SELF%S)

CALL CPG_SL1_TYPE_FINAL_F3D (SELF%R)

CALL CPG_SL1_TYPE_FINAL_F3D (SELF%G)

CALL CPG_SL1_TYPE_FINAL_F3D (SELF%H)

CALL CPG_SL1_TYPE_FINAL_F3D (SELF%TKE)

CALL CPG_SL1_TYPE_FINAL_F3D (SELF%TTE)

CALL CPG_SL1_TYPE_FINAL_F3D (SELF%EFB1)

CALL CPG_SL1_TYPE_FINAL_F3D (SELF%EFB2)

CALL CPG_SL1_TYPE_FINAL_F3D (SELF%EFB3)

CALL CPG_SL1_TYPE_FINAL_F3D (SELF%A)

CALL CPG_SL1_TYPE_FINAL_F3D (SELF%O3)

CALL CPG_SL1_TYPE_FINAL_F3D (SELF%SRC)

CALL CPG_SL1_TYPE_FINAL_F3D (SELF%MXL)

CALL CPG_SL1_TYPE_FINAL_F3D (SELF%SHTUR)

CALL CPG_SL1_TYPE_FINAL_F3D (SELF%FQTUR)

CALL CPG_SL1_TYPE_FINAL_F3D (SELF%FSTUR)

CALL CPG_SL1_TYPE_FINAL_F3D (SELF%CPF)

CALL CPG_SL1_TYPE_FINAL_F3D (SELF%SPF)

CALL CPG_SL1_TYPE_FINAL_F3D (SELF%CVGQ)

CALL CPG_SL1_TYPE_FINAL_F3D (SELF%QVA)

DO JGFL = 1, SIZE (SELF%GHG)
  CALL CPG_SL1_TYPE_FINAL_F3D (SELF%GHG(JGFL))
ENDDO
DO JGFL = 1, SIZE (SELF%CHEM)
  CALL CPG_SL1_TYPE_FINAL_F3D (SELF%CHEM(JGFL))
ENDDO
DO JGFL = 1, SIZE (SELF%AERO)
  CALL CPG_SL1_TYPE_FINAL_F3D (SELF%AERO(JGFL))
ENDDO
CALL CPG_SL1_TYPE_FINAL_F3D (SELF%LRCH4)

DO JGFL = 1, SIZE (SELF%FORC)
  CALL CPG_SL1_TYPE_FINAL_F3D (SELF%FORC(JGFL))
ENDDO
DO JGFL = 1, SIZE (SELF%EZDIAG)
  CALL CPG_SL1_TYPE_FINAL_F3D (SELF%EZDIAG(JGFL))
ENDDO
DO JGFL = 1, SIZE (SELF%ERA40)
  CALL CPG_SL1_TYPE_FINAL_F3D (SELF%ERA40(JGFL))
ENDDO
DO JGFL = 1, SIZE (SELF%NOGW)
  CALL CPG_SL1_TYPE_FINAL_F3D (SELF%NOGW(JGFL))
ENDDO
DO JGFL = 1, SIZE (SELF%EDRP)
  CALL CPG_SL1_TYPE_FINAL_F3D (SELF%EDRP(JGFL))
ENDDO
DO JGFL = 1, SIZE (SELF%SLDIA)
  CALL CPG_SL1_TYPE_FINAL_F3D (SELF%SLDIA(JGFL))
ENDDO
DO JGFL = 1, SIZE (SELF%AERAOT)
  CALL CPG_SL1_TYPE_FINAL_F3D (SELF%AERAOT(JGFL))
ENDDO
DO JGFL = 1, SIZE (SELF%AERLISI)
  CALL CPG_SL1_TYPE_FINAL_F3D (SELF%AERLISI(JGFL))
ENDDO
DO JGFL = 1, SIZE (SELF%AEROUT)
  CALL CPG_SL1_TYPE_FINAL_F3D (SELF%AEROUT(JGFL))
ENDDO
DO JGFL = 1, SIZE (SELF%AEROCLIM)
  CALL CPG_SL1_TYPE_FINAL_F3D (SELF%AEROCLIM(JGFL))
ENDDO
DO JGFL = 1, SIZE (SELF%UVP)
  CALL CPG_SL1_TYPE_FINAL_F3D (SELF%UVP(JGFL))
ENDDO
DO JGFL = 1, SIZE (SELF%PHYS)
  CALL CPG_SL1_TYPE_FINAL_F3D (SELF%PHYS(JGFL))
ENDDO
CALL CPG_SL1_TYPE_FINAL_F3D (SELF%PHYCTY)

CALL CPG_SL1_TYPE_FINAL_F3D (SELF%RSPEC)

CALL CPG_SL1_TYPE_FINAL_F3D (SELF%SDSAT)

CALL CPG_SL1_TYPE_FINAL_F3D (SELF%CVV)

CALL CPG_SL1_TYPE_FINAL_F3D (SELF%RKTH)

CALL CPG_SL1_TYPE_FINAL_F3D (SELF%RKTQV)

CALL CPG_SL1_TYPE_FINAL_F3D (SELF%RKTQC)

CALL CPG_SL1_TYPE_FINAL_F3D (SELF%UOM)

CALL CPG_SL1_TYPE_FINAL_F3D (SELF%UAL)

CALL CPG_SL1_TYPE_FINAL_F3D (SELF%DOM)

CALL CPG_SL1_TYPE_FINAL_F3D (SELF%DAL)

CALL CPG_SL1_TYPE_FINAL_F3D (SELF%UEN)

CALL CPG_SL1_TYPE_FINAL_F3D (SELF%UNEBH)

DO JGFL = 1, SIZE (SELF%CRM)
  CALL CPG_SL1_TYPE_FINAL_F3D (SELF%CRM(JGFL))
ENDDO
DO JGFL = 1, SIZE (SELF%LIMA)
  CALL CPG_SL1_TYPE_FINAL_F3D (SELF%LIMA(JGFL))
ENDDO
CALL CPG_SL1_TYPE_FINAL_F3D (SELF%FSD)

DO JGFL = 1, SIZE (SELF%EXT)
  CALL CPG_SL1_TYPE_FINAL_F3D (SELF%EXT(JGFL))
ENDDO

CONTAINS

SUBROUTINE CPG_SL1_TYPE_FINAL_F3D (YDF3D)

TYPE (CPG_SL1_3D_TYPE), INTENT (INOUT) :: YDF3D

IF (ASSOCIATED (YDF3D%F_P)) CALL DELETE_TEMPORARY (YDF3D%F_P)
YDF3D%F_P => NULL ()
YDF3D%P => NULL ()

IF (ASSOCIATED (YDF3D%F_P_F)) CALL DELETE_TEMPORARY (YDF3D%F_P_F)
YDF3D%F_P_F => NULL ()
YDF3D%P_F => NULL ()

IF (ASSOCIATED (YDF3D%F_P_SPF)) CALL DELETE_TEMPORARY (YDF3D%F_P_SPF)
YDF3D%F_P_SPF => NULL ()
YDF3D%P_SPF => NULL ()

IF (ASSOCIATED (YDF3D%F_P_SP)) CALL DELETE_TEMPORARY (YDF3D%F_P_SP)
YDF3D%F_P_SP => NULL ()
YDF3D%P_SP => NULL ()

IF (ASSOCIATED (YDF3D%F_P_P)) CALL DELETE_TEMPORARY (YDF3D%F_P_P)
YDF3D%F_P_P => NULL ()
YDF3D%P_P => NULL ()

END SUBROUTINE CPG_SL1_TYPE_FINAL_F3D

END SUBROUTINE CPG_SL1_TYPE_FINAL

SUBROUTINE CPG_SL2_TYPE_INIT (SELF, REGISTRY, NLEV, YDTPTRSLB2 &
                                & , PERSISTENT, PB2)

USE PTRSLB2, ONLY : TPTRSLB2
USE OML_MOD, ONLY: OML_MAX_THREADS

CLASS (CPG_SL2_TYPE)                         :: SELF
TYPE (FIELD_REGISTRY),              INTENT (INOUT) :: REGISTRY
INTEGER (KIND=JPIM),                INTENT (IN)    :: NLEV
TYPE (TPTRSLB2),              INTENT (IN)    :: YDTPTRSLB2
LOGICAL, OPTIONAL,                  INTENT (IN)    :: PERSISTENT
REAL (KIND=JPRB), OPTIONAL, TARGET, INTENT (IN)    :: PB2 (:, :, :)

INTEGER (KIND=JPIM) :: JFLD

LOGICAL :: LLPERSISTENT

LLPERSISTENT = .FALSE.
IF (PRESENT (PERSISTENT)) LLPERSISTENT = PERSISTENT

SELF%NLEV = NLEV

IF (PRESENT (PB2)) THEN
  SELF%ZDATA => PB2
  SELF%LOWNED = .FALSE.
  LLPERSISTENT = .TRUE.
ELSEIF (LLPERSISTENT) THEN
  ALLOCATE (SELF%ZDATA (REGISTRY%GEOM%YRDIM%NPROMA, YDTPTRSLB2%NFLDSLB2, REGISTRY%GEOM%YRDIM%NGPBLKS))
  SELF%LOWNED = .TRUE.
ELSE
  ALLOCATE (SELF%ZDATA (REGISTRY%GEOM%YRDIM%NPROMA, YDTPTRSLB2%NFLDSLB2, OML_MAX_THREADS ()))
  SELF%LOWNED = .TRUE.
ENDIF

SELF%F_DATA => CREATE_FIELD_WRAP (SELF%ZDATA, PERSISTENT=LLPERSISTENT)


IF (YDTPTRSLB2%MSLB2DBBC1 > 0) THEN
  JFLD = YDTPTRSLB2%MSLB2DBBC1
  SELF%F_DBBC1 => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_DBBC1 => NULL ()
ENDIF
IF (YDTPTRSLB2%MSLB2DPHI1 > 0) THEN
  JFLD = YDTPTRSLB2%MSLB2DPHI1
  SELF%F_DPHI1 => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_DPHI1 => NULL ()
ENDIF
IF (YDTPTRSLB2%MSLB2USI > 0) THEN
  JFLD = YDTPTRSLB2%MSLB2USI
  SELF%F_USI => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV-1, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_USI => NULL ()
ENDIF
IF (YDTPTRSLB2%MSLB2VSI > 0) THEN
  JFLD = YDTPTRSLB2%MSLB2VSI
  SELF%F_VSI => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV-1, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_VSI => NULL ()
ENDIF
IF (YDTPTRSLB2%MSLB2TSI > 0) THEN
  JFLD = YDTPTRSLB2%MSLB2TSI
  SELF%F_TSI => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV-1, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_TSI => NULL ()
ENDIF
IF (YDTPTRSLB2%MSLB2PDSI > 0) THEN
  JFLD = YDTPTRSLB2%MSLB2PDSI
  SELF%F_PDSI => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV-1, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_PDSI => NULL ()
ENDIF
IF (YDTPTRSLB2%MSLB2VDSI > 0) THEN
  JFLD = YDTPTRSLB2%MSLB2VDSI
  SELF%F_VDSI => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV-1, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_VDSI => NULL ()
ENDIF
IF (YDTPTRSLB2%MSLB2SPSI > 0) THEN
  JFLD = YDTPTRSLB2%MSLB2SPSI
  SELF%F_SPSI => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_SPSI => NULL ()
ENDIF
IF (YDTPTRSLB2%MSLB2VVEL > 0) THEN
  JFLD = YDTPTRSLB2%MSLB2VVEL
  SELF%F_VVEL => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV-1, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_VVEL => NULL ()
ENDIF
IF (YDTPTRSLB2%MSLB2URL > 0) THEN
  JFLD = YDTPTRSLB2%MSLB2URL
  SELF%F_URL => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV-1, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_URL => NULL ()
ENDIF
IF (YDTPTRSLB2%MSLB2VRL > 0) THEN
  JFLD = YDTPTRSLB2%MSLB2VRL
  SELF%F_VRL => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV-1, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_VRL => NULL ()
ENDIF
IF (YDTPTRSLB2%MSLB2WRL > 0) THEN
  JFLD = YDTPTRSLB2%MSLB2WRL
  SELF%F_WRL => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV-1, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_WRL => NULL ()
ENDIF
IF (YDTPTRSLB2%MSLB2URL5 > 0) THEN
  JFLD = YDTPTRSLB2%MSLB2URL5
  SELF%F_URL5 => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV-1, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_URL5 => NULL ()
ENDIF
IF (YDTPTRSLB2%MSLB2VRL5 > 0) THEN
  JFLD = YDTPTRSLB2%MSLB2VRL5
  SELF%F_VRL5 => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV-1, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_VRL5 => NULL ()
ENDIF
IF (YDTPTRSLB2%MSLB2WRL5 > 0) THEN
  JFLD = YDTPTRSLB2%MSLB2WRL5
  SELF%F_WRL5 => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV-1, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_WRL5 => NULL ()
ENDIF
IF (YDTPTRSLB2%MSLB2USI5 > 0) THEN
  JFLD = YDTPTRSLB2%MSLB2USI5
  SELF%F_USI5 => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV-1, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_USI5 => NULL ()
ENDIF
IF (YDTPTRSLB2%MSLB2VSI5 > 0) THEN
  JFLD = YDTPTRSLB2%MSLB2VSI5
  SELF%F_VSI5 => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV-1, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_VSI5 => NULL ()
ENDIF
IF (YDTPTRSLB2%MSLB2U15 > 0) THEN
  JFLD = YDTPTRSLB2%MSLB2U15
  SELF%F_U15 => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV-1, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_U15 => NULL ()
ENDIF
IF (YDTPTRSLB2%MSLB2V15 > 0) THEN
  JFLD = YDTPTRSLB2%MSLB2V15
  SELF%F_V15 => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV-1, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_V15 => NULL ()
ENDIF
IF (YDTPTRSLB2%MSLB2T15 > 0) THEN
  JFLD = YDTPTRSLB2%MSLB2T15
  SELF%F_T15 => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV-1, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_T15 => NULL ()
ENDIF
IF (YDTPTRSLB2%MSLB2Q15 > 0) THEN
  JFLD = YDTPTRSLB2%MSLB2Q15
  SELF%F_Q15 => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV-1, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_Q15 => NULL ()
ENDIF
IF (YDTPTRSLB2%MSLB2KAPPA > 0) THEN
  JFLD = YDTPTRSLB2%MSLB2KAPPA
  SELF%F_KAPPA => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV-1, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_KAPPA => NULL ()
ENDIF
IF (YDTPTRSLB2%MSLB2KAPPAT > 0) THEN
  JFLD = YDTPTRSLB2%MSLB2KAPPAT
  SELF%F_KAPPAT => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV-1, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_KAPPAT => NULL ()
ENDIF
IF (YDTPTRSLB2%MSLB2KAPPAM > 0) THEN
  JFLD = YDTPTRSLB2%MSLB2KAPPAM
  SELF%F_KAPPAM => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV-1, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_KAPPAM => NULL ()
ENDIF
IF (YDTPTRSLB2%MSLB2KAPPAH > 0) THEN
  JFLD = YDTPTRSLB2%MSLB2KAPPAH
  SELF%F_KAPPAH => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV-1, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_KAPPAH => NULL ()
ENDIF
IF (YDTPTRSLB2%MSLB2KAPPA5 > 0) THEN
  JFLD = YDTPTRSLB2%MSLB2KAPPA5
  SELF%F_KAPPA5 => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV-1, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_KAPPA5 => NULL ()
ENDIF
IF (YDTPTRSLB2%MSLB2KAPPAT5 > 0) THEN
  JFLD = YDTPTRSLB2%MSLB2KAPPAT5
  SELF%F_KAPPAT5 => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV-1, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_KAPPAT5 => NULL ()
ENDIF
IF (YDTPTRSLB2%MSLB2GWF > 0) THEN
  JFLD = YDTPTRSLB2%MSLB2GWF
  SELF%F_GWF => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV-1, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_GWF => NULL ()
ENDIF
IF (YDTPTRSLB2%MSLB2GDW > 0) THEN
  JFLD = YDTPTRSLB2%MSLB2GDW
  SELF%F_GDW => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV-1, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_GDW => NULL ()
ENDIF
IF (YDTPTRSLB2%MSLB2GWS > 0) THEN
  JFLD = YDTPTRSLB2%MSLB2GWS
  SELF%F_GWS => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV-1, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_GWS => NULL ()
ENDIF
IF (YDTPTRSLB2%MSLB2STDDISU > 0) THEN
  JFLD = YDTPTRSLB2%MSLB2STDDISU
  SELF%F_STDDISU => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV-1, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_STDDISU => NULL ()
ENDIF
IF (YDTPTRSLB2%MSLB2STDDISV > 0) THEN
  JFLD = YDTPTRSLB2%MSLB2STDDISV
  SELF%F_STDDISV => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV-1, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_STDDISV => NULL ()
ENDIF
IF (YDTPTRSLB2%MSLB2STDDISW > 0) THEN
  JFLD = YDTPTRSLB2%MSLB2STDDISW
  SELF%F_STDDISW => CREATE_FIELD_WRAP (SELF%ZDATA (:, JFLD:JFLD+NLEV-1, :), PERSISTENT=LLPERSISTENT)
ELSE
  SELF%F_STDDISW => NULL ()
ENDIF

END SUBROUTINE CPG_SL2_TYPE_INIT

SUBROUTINE CPG_SL2_TYPE_UPDATE_VIEW (SELF, BLOCK_INDEX)

CLASS (CPG_SL2_TYPE)        :: SELF
INTEGER(KIND=JPIM), INTENT (IN)   :: BLOCK_INDEX

IF (ASSOCIATED (SELF%F_DATA)) THEN
  SELF%ZVIEW => SELF%F_DATA%GET_VIEW (BLOCK_INDEX)
  IF (ASSOCIATED (SELF%F_DBBC1)) THEN
    IF ((.NOT. SELF%F_DBBC1%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DBBC1))) THEN
      SELF%DBBC1 => SELF%F_DBBC1%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%DBBC1)) THEN
    SELF%DBBC1 => ZDUM1
  ENDIF
  IF (ASSOCIATED (SELF%F_DPHI1)) THEN
    IF ((.NOT. SELF%F_DPHI1%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%DPHI1))) THEN
      SELF%DPHI1 => SELF%F_DPHI1%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%DPHI1)) THEN
    SELF%DPHI1 => ZDUM1
  ENDIF
  IF (ASSOCIATED (SELF%F_USI)) THEN
    IF ((.NOT. SELF%F_USI%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%USI))) THEN
      SELF%USI => SELF%F_USI%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%USI)) THEN
    SELF%USI => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_VSI)) THEN
    IF ((.NOT. SELF%F_VSI%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%VSI))) THEN
      SELF%VSI => SELF%F_VSI%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%VSI)) THEN
    SELF%VSI => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_TSI)) THEN
    IF ((.NOT. SELF%F_TSI%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%TSI))) THEN
      SELF%TSI => SELF%F_TSI%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%TSI)) THEN
    SELF%TSI => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_PDSI)) THEN
    IF ((.NOT. SELF%F_PDSI%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%PDSI))) THEN
      SELF%PDSI => SELF%F_PDSI%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%PDSI)) THEN
    SELF%PDSI => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_VDSI)) THEN
    IF ((.NOT. SELF%F_VDSI%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%VDSI))) THEN
      SELF%VDSI => SELF%F_VDSI%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%VDSI)) THEN
    SELF%VDSI => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_SPSI)) THEN
    IF ((.NOT. SELF%F_SPSI%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%SPSI))) THEN
      SELF%SPSI => SELF%F_SPSI%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%SPSI)) THEN
    SELF%SPSI => ZDUM1
  ENDIF
  IF (ASSOCIATED (SELF%F_VVEL)) THEN
    IF ((.NOT. SELF%F_VVEL%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%VVEL))) THEN
      SELF%VVEL => SELF%F_VVEL%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%VVEL)) THEN
    SELF%VVEL => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_URL)) THEN
    IF ((.NOT. SELF%F_URL%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%URL))) THEN
      SELF%URL => SELF%F_URL%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%URL)) THEN
    SELF%URL => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_VRL)) THEN
    IF ((.NOT. SELF%F_VRL%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%VRL))) THEN
      SELF%VRL => SELF%F_VRL%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%VRL)) THEN
    SELF%VRL => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_WRL)) THEN
    IF ((.NOT. SELF%F_WRL%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%WRL))) THEN
      SELF%WRL => SELF%F_WRL%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%WRL)) THEN
    SELF%WRL => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_URL5)) THEN
    IF ((.NOT. SELF%F_URL5%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%URL5))) THEN
      SELF%URL5 => SELF%F_URL5%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%URL5)) THEN
    SELF%URL5 => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_VRL5)) THEN
    IF ((.NOT. SELF%F_VRL5%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%VRL5))) THEN
      SELF%VRL5 => SELF%F_VRL5%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%VRL5)) THEN
    SELF%VRL5 => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_WRL5)) THEN
    IF ((.NOT. SELF%F_WRL5%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%WRL5))) THEN
      SELF%WRL5 => SELF%F_WRL5%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%WRL5)) THEN
    SELF%WRL5 => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_USI5)) THEN
    IF ((.NOT. SELF%F_USI5%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%USI5))) THEN
      SELF%USI5 => SELF%F_USI5%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%USI5)) THEN
    SELF%USI5 => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_VSI5)) THEN
    IF ((.NOT. SELF%F_VSI5%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%VSI5))) THEN
      SELF%VSI5 => SELF%F_VSI5%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%VSI5)) THEN
    SELF%VSI5 => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_U15)) THEN
    IF ((.NOT. SELF%F_U15%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%U15))) THEN
      SELF%U15 => SELF%F_U15%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%U15)) THEN
    SELF%U15 => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_V15)) THEN
    IF ((.NOT. SELF%F_V15%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%V15))) THEN
      SELF%V15 => SELF%F_V15%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%V15)) THEN
    SELF%V15 => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_T15)) THEN
    IF ((.NOT. SELF%F_T15%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%T15))) THEN
      SELF%T15 => SELF%F_T15%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%T15)) THEN
    SELF%T15 => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_Q15)) THEN
    IF ((.NOT. SELF%F_Q15%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%Q15))) THEN
      SELF%Q15 => SELF%F_Q15%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%Q15)) THEN
    SELF%Q15 => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_KAPPA)) THEN
    IF ((.NOT. SELF%F_KAPPA%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%KAPPA))) THEN
      SELF%KAPPA => SELF%F_KAPPA%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%KAPPA)) THEN
    SELF%KAPPA => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_KAPPAT)) THEN
    IF ((.NOT. SELF%F_KAPPAT%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%KAPPAT))) THEN
      SELF%KAPPAT => SELF%F_KAPPAT%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%KAPPAT)) THEN
    SELF%KAPPAT => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_KAPPAM)) THEN
    IF ((.NOT. SELF%F_KAPPAM%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%KAPPAM))) THEN
      SELF%KAPPAM => SELF%F_KAPPAM%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%KAPPAM)) THEN
    SELF%KAPPAM => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_KAPPAH)) THEN
    IF ((.NOT. SELF%F_KAPPAH%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%KAPPAH))) THEN
      SELF%KAPPAH => SELF%F_KAPPAH%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%KAPPAH)) THEN
    SELF%KAPPAH => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_KAPPA5)) THEN
    IF ((.NOT. SELF%F_KAPPA5%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%KAPPA5))) THEN
      SELF%KAPPA5 => SELF%F_KAPPA5%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%KAPPA5)) THEN
    SELF%KAPPA5 => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_KAPPAT5)) THEN
    IF ((.NOT. SELF%F_KAPPAT5%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%KAPPAT5))) THEN
      SELF%KAPPAT5 => SELF%F_KAPPAT5%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%KAPPAT5)) THEN
    SELF%KAPPAT5 => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_GWF)) THEN
    IF ((.NOT. SELF%F_GWF%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%GWF))) THEN
      SELF%GWF => SELF%F_GWF%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%GWF)) THEN
    SELF%GWF => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_GDW)) THEN
    IF ((.NOT. SELF%F_GDW%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%GDW))) THEN
      SELF%GDW => SELF%F_GDW%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%GDW)) THEN
    SELF%GDW => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_GWS)) THEN
    IF ((.NOT. SELF%F_GWS%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%GWS))) THEN
      SELF%GWS => SELF%F_GWS%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%GWS)) THEN
    SELF%GWS => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_STDDISU)) THEN
    IF ((.NOT. SELF%F_STDDISU%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%STDDISU))) THEN
      SELF%STDDISU => SELF%F_STDDISU%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%STDDISU)) THEN
    SELF%STDDISU => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_STDDISV)) THEN
    IF ((.NOT. SELF%F_STDDISV%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%STDDISV))) THEN
      SELF%STDDISV => SELF%F_STDDISV%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%STDDISV)) THEN
    SELF%STDDISV => ZDUM2
  ENDIF
  IF (ASSOCIATED (SELF%F_STDDISW)) THEN
    IF ((.NOT. SELF%F_STDDISW%THREAD_BUFFER) .OR. (.NOT. ASSOCIATED (SELF%STDDISW))) THEN
      SELF%STDDISW => SELF%F_STDDISW%GET_VIEW (BLOCK_INDEX)
    ENDIF
  ELSEIF (.NOT. ASSOCIATED (SELF%STDDISW)) THEN
    SELF%STDDISW => ZDUM2
  ENDIF

ELSE
  SELF%ZVIEW => ZDUM2

  IF (.NOT. ASSOCIATED (SELF%DBBC1)) SELF%DBBC1 => ZDUM1
  IF (.NOT. ASSOCIATED (SELF%DPHI1)) SELF%DPHI1 => ZDUM1
  IF (.NOT. ASSOCIATED (SELF%USI)) SELF%USI => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%VSI)) SELF%VSI => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%TSI)) SELF%TSI => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%PDSI)) SELF%PDSI => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%VDSI)) SELF%VDSI => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%SPSI)) SELF%SPSI => ZDUM1
  IF (.NOT. ASSOCIATED (SELF%VVEL)) SELF%VVEL => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%URL)) SELF%URL => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%VRL)) SELF%VRL => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%WRL)) SELF%WRL => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%URL5)) SELF%URL5 => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%VRL5)) SELF%VRL5 => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%WRL5)) SELF%WRL5 => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%USI5)) SELF%USI5 => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%VSI5)) SELF%VSI5 => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%U15)) SELF%U15 => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%V15)) SELF%V15 => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%T15)) SELF%T15 => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%Q15)) SELF%Q15 => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%KAPPA)) SELF%KAPPA => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%KAPPAT)) SELF%KAPPAT => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%KAPPAM)) SELF%KAPPAM => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%KAPPAH)) SELF%KAPPAH => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%KAPPA5)) SELF%KAPPA5 => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%KAPPAT5)) SELF%KAPPAT5 => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%GWF)) SELF%GWF => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%GDW)) SELF%GDW => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%GWS)) SELF%GWS => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%STDDISU)) SELF%STDDISU => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%STDDISV)) SELF%STDDISV => ZDUM2
  IF (.NOT. ASSOCIATED (SELF%STDDISW)) SELF%STDDISW => ZDUM2

ENDIF

END SUBROUTINE CPG_SL2_TYPE_UPDATE_VIEW

SUBROUTINE CPG_SL2_TYPE_FINAL (SELF)
CLASS (CPG_SL2_TYPE)          :: SELF

IF (ASSOCIATED (SELF%F_DATA)) CALL DELETE_TEMPORARY (SELF%F_DATA)
SELF%F_DATA => NULL ()

IF (SELF%LOWNED) THEN
  DEALLOCATE (SELF%ZDATA)
ENDIF

SELF%ZDATA => NULL ()
SELF%ZVIEW => NULL ()

IF (ASSOCIATED (SELF%F_DBBC1)) CALL DELETE_TEMPORARY (SELF%F_DBBC1)
SELF%F_DBBC1 => NULL ()
SELF%DBBC1 => NULL ()
IF (ASSOCIATED (SELF%F_DPHI1)) CALL DELETE_TEMPORARY (SELF%F_DPHI1)
SELF%F_DPHI1 => NULL ()
SELF%DPHI1 => NULL ()
IF (ASSOCIATED (SELF%F_USI)) CALL DELETE_TEMPORARY (SELF%F_USI)
SELF%F_USI => NULL ()
SELF%USI => NULL ()
IF (ASSOCIATED (SELF%F_VSI)) CALL DELETE_TEMPORARY (SELF%F_VSI)
SELF%F_VSI => NULL ()
SELF%VSI => NULL ()
IF (ASSOCIATED (SELF%F_TSI)) CALL DELETE_TEMPORARY (SELF%F_TSI)
SELF%F_TSI => NULL ()
SELF%TSI => NULL ()
IF (ASSOCIATED (SELF%F_PDSI)) CALL DELETE_TEMPORARY (SELF%F_PDSI)
SELF%F_PDSI => NULL ()
SELF%PDSI => NULL ()
IF (ASSOCIATED (SELF%F_VDSI)) CALL DELETE_TEMPORARY (SELF%F_VDSI)
SELF%F_VDSI => NULL ()
SELF%VDSI => NULL ()
IF (ASSOCIATED (SELF%F_SPSI)) CALL DELETE_TEMPORARY (SELF%F_SPSI)
SELF%F_SPSI => NULL ()
SELF%SPSI => NULL ()
IF (ASSOCIATED (SELF%F_VVEL)) CALL DELETE_TEMPORARY (SELF%F_VVEL)
SELF%F_VVEL => NULL ()
SELF%VVEL => NULL ()
IF (ASSOCIATED (SELF%F_URL)) CALL DELETE_TEMPORARY (SELF%F_URL)
SELF%F_URL => NULL ()
SELF%URL => NULL ()
IF (ASSOCIATED (SELF%F_VRL)) CALL DELETE_TEMPORARY (SELF%F_VRL)
SELF%F_VRL => NULL ()
SELF%VRL => NULL ()
IF (ASSOCIATED (SELF%F_WRL)) CALL DELETE_TEMPORARY (SELF%F_WRL)
SELF%F_WRL => NULL ()
SELF%WRL => NULL ()
IF (ASSOCIATED (SELF%F_URL5)) CALL DELETE_TEMPORARY (SELF%F_URL5)
SELF%F_URL5 => NULL ()
SELF%URL5 => NULL ()
IF (ASSOCIATED (SELF%F_VRL5)) CALL DELETE_TEMPORARY (SELF%F_VRL5)
SELF%F_VRL5 => NULL ()
SELF%VRL5 => NULL ()
IF (ASSOCIATED (SELF%F_WRL5)) CALL DELETE_TEMPORARY (SELF%F_WRL5)
SELF%F_WRL5 => NULL ()
SELF%WRL5 => NULL ()
IF (ASSOCIATED (SELF%F_USI5)) CALL DELETE_TEMPORARY (SELF%F_USI5)
SELF%F_USI5 => NULL ()
SELF%USI5 => NULL ()
IF (ASSOCIATED (SELF%F_VSI5)) CALL DELETE_TEMPORARY (SELF%F_VSI5)
SELF%F_VSI5 => NULL ()
SELF%VSI5 => NULL ()
IF (ASSOCIATED (SELF%F_U15)) CALL DELETE_TEMPORARY (SELF%F_U15)
SELF%F_U15 => NULL ()
SELF%U15 => NULL ()
IF (ASSOCIATED (SELF%F_V15)) CALL DELETE_TEMPORARY (SELF%F_V15)
SELF%F_V15 => NULL ()
SELF%V15 => NULL ()
IF (ASSOCIATED (SELF%F_T15)) CALL DELETE_TEMPORARY (SELF%F_T15)
SELF%F_T15 => NULL ()
SELF%T15 => NULL ()
IF (ASSOCIATED (SELF%F_Q15)) CALL DELETE_TEMPORARY (SELF%F_Q15)
SELF%F_Q15 => NULL ()
SELF%Q15 => NULL ()
IF (ASSOCIATED (SELF%F_KAPPA)) CALL DELETE_TEMPORARY (SELF%F_KAPPA)
SELF%F_KAPPA => NULL ()
SELF%KAPPA => NULL ()
IF (ASSOCIATED (SELF%F_KAPPAT)) CALL DELETE_TEMPORARY (SELF%F_KAPPAT)
SELF%F_KAPPAT => NULL ()
SELF%KAPPAT => NULL ()
IF (ASSOCIATED (SELF%F_KAPPAM)) CALL DELETE_TEMPORARY (SELF%F_KAPPAM)
SELF%F_KAPPAM => NULL ()
SELF%KAPPAM => NULL ()
IF (ASSOCIATED (SELF%F_KAPPAH)) CALL DELETE_TEMPORARY (SELF%F_KAPPAH)
SELF%F_KAPPAH => NULL ()
SELF%KAPPAH => NULL ()
IF (ASSOCIATED (SELF%F_KAPPA5)) CALL DELETE_TEMPORARY (SELF%F_KAPPA5)
SELF%F_KAPPA5 => NULL ()
SELF%KAPPA5 => NULL ()
IF (ASSOCIATED (SELF%F_KAPPAT5)) CALL DELETE_TEMPORARY (SELF%F_KAPPAT5)
SELF%F_KAPPAT5 => NULL ()
SELF%KAPPAT5 => NULL ()
IF (ASSOCIATED (SELF%F_GWF)) CALL DELETE_TEMPORARY (SELF%F_GWF)
SELF%F_GWF => NULL ()
SELF%GWF => NULL ()
IF (ASSOCIATED (SELF%F_GDW)) CALL DELETE_TEMPORARY (SELF%F_GDW)
SELF%F_GDW => NULL ()
SELF%GDW => NULL ()
IF (ASSOCIATED (SELF%F_GWS)) CALL DELETE_TEMPORARY (SELF%F_GWS)
SELF%F_GWS => NULL ()
SELF%GWS => NULL ()
IF (ASSOCIATED (SELF%F_STDDISU)) CALL DELETE_TEMPORARY (SELF%F_STDDISU)
SELF%F_STDDISU => NULL ()
SELF%STDDISU => NULL ()
IF (ASSOCIATED (SELF%F_STDDISV)) CALL DELETE_TEMPORARY (SELF%F_STDDISV)
SELF%F_STDDISV => NULL ()
SELF%STDDISV => NULL ()
IF (ASSOCIATED (SELF%F_STDDISW)) CALL DELETE_TEMPORARY (SELF%F_STDDISW)
SELF%F_STDDISW => NULL ()
SELF%STDDISW => NULL ()

END SUBROUTINE CPG_SL2_TYPE_FINAL

END MODULE CPG_TYPE_MOD



